---
// Importaciones
import Layout from "../../layouts/Layout.astro";
import BlogFader from "../../components/blog/Fader";
import { blogService } from "../../services/blogService";
import type Blog from "../../models/Blog";

// 游대 Generar rutas din치micas desde la API
export async function getStaticPaths() {
  try {
    const response = await blogService.getAllBlogs();
    const blogs = response.data;

    return blogs.map((blog: Blog) => ({
      params: { articleId: blog.id.toString() },
    }));
  } catch (error) {
    console.error('Error generando rutas din치micas:', error);
    return [];
  }
}

// Obtener par치metro din치mico
const { articleId } = Astro.params;

// Obtener contenido del art칤culo desde la API
let article: Blog | null = null;
let error: string | null = null;

try {
  const response = await blogService.getBlogById(articleId!);
  article = response.data;
} catch (err) {
  console.error('Error obteniendo blog:', err);
  error = err instanceof Error ? err.message : 'Error desconocido';
}

if (!article) {
  throw new Error(`Art칤culo no encontrado: ${articleId}`);
}
---

<Layout title={article.titulo}>
  <section class="relative">
    {article.imagenesBlog && article.imagenesBlog.length > 0 ? (
      <img
        src={article.imagenesBlog[0].url}
        alt="Imagen del banner"
        class="w-full max-h-[100vh] object-cover"
      />
    ) : (
      <img
        src={article.imagenPrincipal}
        alt="Imagen del banner"
        class="w-full max-h-[100vh] object-cover"
      />
    )}
    <div class="absolute inset-0 flex flex-col justify-center items-center">
      <h1 class="text-7xl text-center Montserrat font-black text-white sombra-title">
        Blog Yuntero
      </h1>
    </div>
  </section>

  <div class="w-full bg-white text-blue-950 text-3xl font-extrabold text-center h-20 content-center">
    <h2 class="text-5xl">ART칈CULOS</h2>
  </div>

  <section class="p-24 text-white bg-gradient-to-b from-blue-900 to-indigo-950 flex flex-col">
    <div class="flex flex-col items-center">
      <h3 class="text-5xl font-bold text-center mb-[30px]">{article.titulo}</h3>
      <p class="text-center font-bold text-4xl mb-[80px]">
        {article.subTituloBlog}
      </p>

      <BlogFader title={article.titulo} client:load />

      <div class="flex flex-col items-center lg:block lg:columns-2 gap-16 max-w-[1100px]">
        {article.imagenesBlog && article.imagenesBlog.length > 1 && article.imagenesBlog.slice(1).map((imagen) => (
          <div>
            <img src={imagen.url} alt="Imagen blog" class="mt-10 mb-28 w-full rounded-xl" />
            <p class="text-justify Montserrat text-2xl py-[40px]">
              {imagen.parrafo}
            </p>
          </div>
        ))}
      </div>

      <p class="text-3xl mb-15 Montserrat font-semibold mt-[150px]">
        {article.descripcion}
      </p>

      {article.videoBlog && (
        <a href={article.videoBlog} target="_blank">
          <button class="adaptable-btn">
            {article.tituloVideoBlog || 'Ver Video'}
          </button>
        </a>
      )}
    </div>
  </section>
</Layout>