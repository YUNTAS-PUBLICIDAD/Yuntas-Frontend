---
import Layout from "../../layouts/Layout.astro";
import BlogDetail from "../../components/blog/BlogPage.jsx"; // Importa el componente React
import { blogService } from "../../services/blogService";
import type BlogAPI from "../../models/Blog";

export async function getStaticPaths() {
  try {
    const response = await blogService.getAllBlogs();
    const blogs = response.data;

    return blogs.map((blog: BlogAPI) => ({
      params: { id: blog.id.toString() },
    }));
  } catch (error) {
    console.error("Error generando rutas dinámicas:", error);
    return [];
  }
}

// Obtener parámetro dinámico
const { id } = Astro.params;

// Obtener contenido del artículo desde la API
let article: BlogAPI | null = null;
let error: string | null = null;

try {
  const response = await blogService.getBlogById(id!);
  article = response.data;
} catch (err) {
  console.error("Error obteniendo blog:", err);
  error = err instanceof Error ? err.message : "Error desconocido";
}

if (!article) {
  throw new Error(`Artículo no encontrado: ${id}`);
}
---

<Layout title={article.nombre_producto}>
  <BlogDetail client:load article={article} />
</Layout>
