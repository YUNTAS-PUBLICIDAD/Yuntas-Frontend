---
import Layout from "../../layouts/Layout.astro";
import BlogDetail from "../../components/blog/BlogPage.jsx";
import { blogService } from "../../services/blogService";
import type BlogAPI from "../../models/Blog";

// En modo SSR, las páginas se generan bajo demanda cuando se solicitan
// No necesitamos getStaticPaths, obtenemos el blog directamente por el parámetro link
const { link } = Astro.params;

if (!link) {
  return Astro.redirect("/blogs");
}

let article: BlogAPI | null = null;
let error: string | null = null;

try {
  const response = await blogService.getBlogByLink(link);
  article = response.data;
} catch (err) {
  console.error("Error obteniendo blog:", err);
  error = err instanceof Error ? err.message : "Error desconocido";
}

// Si no se encontró el artículo, redirigir a la lista de blogs
if (!article) {
  return Astro.redirect("/blogs");
}
---

<Layout title={article.nombre_producto} description={article.subtitulo || ''} canonicalUrl=`https://yuntaspublicidad.com/blogs/${link}`>
  
  <BlogDetail client:load article={article} />

</Layout>