---
import ProductoPage from "../../components/products/ProductoPage";
import Layout from "../../layouts/Layout.astro";
import { productoService } from "../../services/productoService";

// En modo SSR, las páginas se generan bajo demanda cuando se solicitan
// No necesitamos getStaticPaths, obtenemos el producto directamente por el parámetro link
const { link } = Astro.params;

if (!link) {
  return Astro.redirect("/products");
}

let producto = null;
let error = null;

try {
  // Obtener el producto por su link
  const response = await productoService.getProductoByLink(link);
  producto = response.data;
} catch (err) {
  console.error("Error obteniendo producto:", err);
  error = err instanceof Error ? err.message : "Error desconocido";
}

// Si no se encontró el producto, redirigir a la lista de productos
if (!producto) {
  return Astro.redirect("/products");
}
---

<Layout title={producto.etiqueta.meta_titulo || producto.nombre} description={producto.etiqueta.meta_descripcion || producto.descripcion} keywords="publicidad, maquinaria, diseño, decoración, carteles" canonicalUrl={`${Astro.site}products/${producto.link}`}>
  <ProductoPage client:load data={producto} />
</Layout>
