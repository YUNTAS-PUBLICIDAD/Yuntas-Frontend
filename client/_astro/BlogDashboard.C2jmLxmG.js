import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as f}from"./index.Be8AcK8B.js";import{h as w}from"./httpService.BpGFLBJP.js";import{c as C}from"./config.CJaag9Y3.js";class D{async getAllBlogs(){let r=[],a=1,s=1,n=!0;for(;n;){const c=await w.get(`${C.endpoints.blogs.list}?page=${a}`);c&&c.success&&c.data.data.length>0?(r=[...r,...c.data.data],s=c.data.last_page,a>=s?n=!1:a++):n=!1}return{success:!0,message:"Todos los blogs obtenidos exitosamente.",status:200,data:{data:r,current_page:1,last_page:1,per_page:r.length,total:r.length}}}getBlogByLink(r){return w.get(`/api/blogs/link/${r}`)}createBlog(r){const a=this.buildFormData(r,"create");return w.authenticatedPostFormData(C.endpoints.blogs.create,a)}updateBlog(r,a){const s=this.buildFormData(a,"update");return s.append("_method","PATCH"),w.authenticatedPostFormData(`/api/blogs/${r}`,s)}deleteBlog(r){return w.authenticatedDelete(`/api/blogs/${r}`)}buildFormData(r,a){const s=new FormData;return s.append("producto_id",r.producto_id||""),s.append("link",r.link||""),s.append("subtitulo",r.titulo||""),r.parrafo&&s.append("parrafos[0]",r.parrafo),r.url_video&&s.append("url_video",r.url_video),r.imagen_principal instanceof File&&s.append("imagen_principal",r.imagen_principal),r.imagenes?.length&&r.imagenes.forEach((n,c)=>{n.url_imagen instanceof File&&(s.append(`imagenes[${c}]`,n.url_imagen),s.append(`alt_imagenes[${c}]`,n.parrafo_imagen||""))}),s}generateLinkFromTitle(r){return r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim()}}const N=new D;function I(){const[y,r]=f.useState([]),[a,s]=f.useState(!0),[n,c]=f.useState(null),b=async()=>{try{s(!0),c(null);const d=await N.getAllBlogs();r(d.data)}catch(d){c(d instanceof Error?d.message:"Error desconocido al obtener blogs"),console.error("Error en useBlogs:",d)}finally{s(!1)}},u=async()=>{await b()};return f.useEffect(()=>{b()},[]),{blogs:y,loading:a,error:n,refetch:u}}function S(){const[y,r]=f.useState(!1),[a,s]=f.useState(null);return{loading:y,error:a,createBlog:async d=>{try{return r(!0),s(null),(await N.createBlog(d)).data}catch(t){const l=t instanceof Error?t.message:"Error desconocido al crear el blog";return s(l),console.error("Error creando blog:",t),null}finally{r(!1)}},updateBlog:async(d,t)=>{try{return r(!0),s(null),(await N.updateBlog(d,t)).data}catch(l){const h=l instanceof Error?l.message:"Error desconocido al actualizar el blog";return s(h),console.error("Error actualizando blog:",l),null}finally{r(!1)}},deleteBlog:async d=>{try{return r(!0),s(null),await N.deleteBlog(d),!0}catch(t){const l=t instanceof Error?t.message:"Error desconocido al eliminar el blog";return s(l),console.error("Error eliminando blog:",t),!1}finally{r(!1)}},clearError:()=>s(null)}}class L{static MAX_FILE_SIZE=10*1024*1024;static ALLOWED_MIME_TYPES=["image/jpeg","image/jpg","image/png","image/webp"];static validateImage(r){return r?this.ALLOWED_MIME_TYPES.includes(r.type)?r.size>this.MAX_FILE_SIZE?{valid:!1,error:`El archivo es demasiado grande. Tamaño máximo: ${this.formatFileSize(this.MAX_FILE_SIZE)}`}:{valid:!0}:{valid:!1,error:`Tipo de archivo no permitido. Use: ${this.ALLOWED_MIME_TYPES.join(", ")}`}:{valid:!1,error:"No se ha seleccionado ningún archivo"}}static formatFileSize(r){if(r===0)return"0 Bytes";const a=1024,s=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(r)/Math.log(a));return parseFloat((r/Math.pow(a,n)).toFixed(2))+" "+s[n]}static createPreviewUrl(r){return r&&r.type.startsWith("image/")?URL.createObjectURL(r):null}static revokePreviewUrl(r){r&&URL.revokeObjectURL(r)}static async resizeImage(r,a=1920,s=1080,n=.8){return new Promise((c,b)=>{const u=document.createElement("canvas"),d=u.getContext("2d"),t=new Image;t.onload=()=>{let{width:l,height:h}=t;if(l>a||h>s){const m=Math.min(a/l,s/h);l*=m,h*=m}u.width=l,u.height=h,d?.drawImage(t,0,0,l,h),u.toBlob(m=>{if(m){const g=new File([m],r.name,{type:r.type,lastModified:Date.now()});c(g)}else b(new Error("Error al redimensionar la imagen"))},r.type,n)},t.onerror=()=>b(new Error("Error al cargar la imagen")),t.src=URL.createObjectURL(r)})}static generateUniqueFileName(r){const a=Date.now(),s=Math.random().toString(36).substring(2,15),n=r.split(".").pop();return`${a}_${s}.${n}`}static async extractImageMetadata(r){return new Promise((a,s)=>{const n=new Image;n.onload=()=>{a({width:n.naturalWidth,height:n.naturalHeight,size:r.size,type:r.type,name:r.name})},n.onerror=()=>s(new Error("Error al cargar la imagen")),n.src=URL.createObjectURL(r)})}}const M=({isOpen:y,onClose:r,blogToEdit:a,onSuccess:s})=>{const{createBlog:n,updateBlog:c,loading:b,error:u,clearError:d}=S(),[t,l]=f.useState({titulo:"",link:"",producto_id:"",parrafo:"",descripcion:"",imagen_principal:null,titulo_blog:"",subtitulo_beneficio:"",url_video:"",titulo_video:"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]}),[h,m]=f.useState(!1);f.useEffect(()=>{a&&(l({titulo:a.titulo,link:a.link,producto_id:a.producto_id.toString(),parrafo:a.parrafo,descripcion:a.descripcion,imagen_principal:null,titulo_blog:a.tituloBlog||"",subtitulo_beneficio:a.subTituloBlog||"",url_video:a.videoBlog||"",titulo_video:a.tituloVideoBlog||"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]}),m(!0))},[a]),f.useEffect(()=>{t.titulo&&!h&&l(o=>({...o,link:N.generateLinkFromTitle(t.titulo)}))},[t.titulo,h]);const g=o=>{const{name:i,value:p}=o.target;i==="titulo"&&m(!1),i==="link"&&m(!0),l(x=>({...x,[i]:p}))},B=o=>{const{name:i,files:p}=o.target;if(p&&p[0]){const x=p[0],j=L.validateImage(x);if(!j.valid){alert(j.error);return}l(E=>({...E,[i]:x}))}},_=(o,i,p)=>{if(i==="url_imagen"&&p instanceof File){const x=L.validateImage(p);if(!x.valid){alert(x.error);return}}l(x=>({...x,imagenes:x.imagenes?.map((j,E)=>E===o?{...j,[i]:p}:j)||[]}))},k=async o=>{if(o.preventDefault(),d(),!t.titulo||!t.link||!t.parrafo||!t.descripcion){alert("Por favor, completa todos los campos obligatorios.");return}if(!t.titulo_blog||!t.subtitulo_beneficio||!t.url_video||!t.titulo_video){alert("Por favor, completa todos los campos de información adicional del blog.");return}if(!a&&!t.imagen_principal){alert("Por favor, selecciona una imagen principal.");return}if(!t.imagenes||t.imagenes.length===0||!t.imagenes[0].url_imagen){alert("Por favor, selecciona al menos una imagen adicional.");return}try{let i=null;a?i=await c(a.id,t):i=await n(t),i&&(s?.(i),v())}catch(i){console.error("Error al guardar el blog:",i)}},v=()=>{l({titulo:"",link:"",producto_id:"",parrafo:"",descripcion:"",imagen_principal:null,titulo_blog:"",subtitulo_beneficio:"",url_video:"",titulo_video:"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]}),m(!1),d(),r()};return y?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:a?"Editar Blog":"Crear Nuevo Blog"}),e.jsx("button",{onClick:v,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),u&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:u}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título *"}),e.jsx("input",{type:"text",name:"titulo",value:t.titulo,onChange:g,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Link (URL amigable) *"}),e.jsx("input",{type:"text",name:"link",value:t.link,onChange:g,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID del Producto (opcional)"}),e.jsx("input",{type:"number",name:"producto_id",value:t.producto_id,onChange:g,placeholder:"Deja vacío si no tienes productos aún",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Puedes asociar este blog a un producto específico (opcional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Párrafo *"}),e.jsx("textarea",{name:"parrafo",value:t.parrafo,onChange:g,required:!0,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción *"}),e.jsx("textarea",{name:"descripcion",value:t.descripcion,onChange:g,required:!0,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Imagen Principal ",!a&&"*"]}),e.jsx("input",{type:"file",name:"imagen_principal",onChange:B,accept:"image/*",required:!a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título del Blog *"}),e.jsx("input",{type:"text",name:"titulo_blog",value:t.titulo_blog,onChange:g,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subtítulo *"}),e.jsx("input",{type:"text",name:"subtitulo_beneficio",value:t.subtitulo_beneficio,onChange:g,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL del Video *"}),e.jsx("input",{type:"url",name:"url_video",value:t.url_video,onChange:g,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título del Video *"}),e.jsx("input",{type:"text",name:"titulo_video",value:t.titulo_video,onChange:g,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-3",children:"Imágenes Adicionales * (Al menos 1 requerida)"}),t.imagenes?.map((o,i)=>e.jsxs("div",{className:"border border-gray-200 rounded-md p-4 mb-4",children:[e.jsxs("h4",{className:"text-md font-medium text-gray-600 mb-2",children:["Imagen ",i+1]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Archivo de Imagen ",i===0?"*":""]}),e.jsx("input",{type:"file",accept:"image/*",required:i===0,onChange:p=>{const x=p.target.files?.[0];x&&_(i,"url_imagen",x)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Párrafo de la Imagen"}),e.jsx("textarea",{value:o.parrafo_imagen,onChange:p=>_(i,"parrafo_imagen",p.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]},i))]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:v,className:"px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:b,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Guardando...":a?"Actualizar":"Crear"})]})]})]})})}):null},F=()=>{const{blogs:y,loading:r,error:a,refetch:s}=I(),{deleteBlog:n,loading:c}=S(),[b,u]=f.useState(!1),[d,t]=f.useState(null),[l,h]=f.useState(""),m=y.filter(o=>o.titulo.toLowerCase().includes(l.toLowerCase())||o.descripcion.toLowerCase().includes(l.toLowerCase())),g=o=>{t(o),u(!0)},B=async o=>{window.confirm("¿Estás seguro de que quieres eliminar este blog?")&&await n(o)&&s()},_=()=>{u(!1),t(null)},k=o=>{s()},v=o=>new Date(o).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"});return r?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):a?e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:["Error cargando blogs: ",a]}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Gestión de Blogs"}),e.jsx("button",{onClick:()=>u(!0),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Crear Nuevo Blog"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Buscar blogs...",value:l,onChange:o=>h(o.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:m.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:l?"No se encontraron blogs que coincidan con tu búsqueda.":"No hay blogs disponibles."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Imagen"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Título"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(o=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("img",{src:o.imagenPrincipal,alt:o.titulo,className:"h-16 w-16 rounded-lg object-cover"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:o.titulo}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",o.id]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:o.descripcion})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:v(o.created_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>g(o),className:"text-blue-600 hover:text-blue-900 bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded",children:"Editar"}),e.jsx("button",{onClick:()=>B(o.id),disabled:c,className:"text-red-600 hover:text-red-900 bg-red-100 hover:bg-red-200 px-3 py-1 rounded disabled:opacity-50",children:c?"Eliminando...":"Eliminar"}),e.jsx("a",{href:`/blogs/${o.id}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:text-green-900 bg-green-100 hover:bg-green-200 px-3 py-1 rounded",children:"Ver"})]})})]},o.id))})]})})}),e.jsx(M,{isOpen:b,onClose:_,blogToEdit:d,onSuccess:k})]})},z=()=>e.jsx("div",{children:e.jsx(F,{})});export{z as default};
