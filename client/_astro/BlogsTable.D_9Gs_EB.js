import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as x,R as $}from"./index.Be8AcK8B.js";import{d as xe,m as he}from"./index.GK1F2SJ7.js";import{g as W,c as G}from"./config.CJaag9Y3.js";import{S as Y}from"./sweetalert2.esm.all.Bj_ZQUAw.js";import{T as ve}from"./TableContainer.C49vMdQY.js";import{d as we,S as _e,c as je,P as ie,A as ye}from"./autoplay.C5Y-zvcZ.js";/* empty css                       */import"./admin.30f82b17.l0sNRNKZ.js";import{u as Ee}from"./useDarkMode.C4HGFL6C.js";import"./iconBase.Db4UJpFa.js";const Se=({isOpen:a,setIsOpen:e,blogToEdit:r,onSuccess:n})=>{const[g,o]=x.useState([]),[h,_]=x.useState(""),[s,P]=x.useState(!1),[u,v]=x.useState(!1),[E,N]=x.useState(null),[O,c]=x.useState(null),[f,i]=x.useState(""),[j,y]=x.useState(!1),[d,S]=x.useState(""),I={producto_id:"",subtitulo:"",link:"",meta_titulo:"",meta_descripcion:"",imagen_principal:null,text_alt_principal:"",alt_imagen_card:"",imagenes_secundarias:[null,null,null],alt_imagenes_secundarias:["","",""],parrafos:["","",""],url_video:""},[l,C]=x.useState(I);x.useEffect(()=>{if(a)if(r){const m=r.producto_id?.toString()||"";C({producto_id:m,subtitulo:r.subtitulo||"",link:r.link||"",meta_titulo:r.etiqueta?.meta_titulo||"",meta_descripcion:r.etiqueta?.meta_descripcion||"",imagen_principal:null,text_alt_principal:r.text_alt_principal||"",alt_imagen_card:r.alt_imagen_card||"",imagenes_secundarias:[null,null,null],alt_imagenes_secundarias:[r.imagenes?.[0]?.text_alt||"",r.imagenes?.[1]?.text_alt||"",r.imagenes?.[2]?.text_alt||""],parrafos:[r.parrafos?.[0]?.parrafo||"",r.parrafos?.[1]?.parrafo||"",r.parrafos?.[2]?.parrafo||""],url_video:r.url_video||""}),_(r.nombre_producto||"")}else C(I),_("")},[a,r]),x.useEffect(()=>{(async()=>{if(a){P(!0);try{const p=localStorage.getItem("token"),w=await fetch(W(G.endpoints.productos.all),{method:"GET",headers:{Authorization:`Bearer ${p}`,Accept:"application/json","Content-Type":"application/json"}});if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);const k=await w.json();k.success&&Array.isArray(k.data)?o(k.data):Array.isArray(k)?o(k):o([])}catch(p){console.error("Error al obtener productos:",p),o([]),alert("❌ Error al cargar los productos. Por favor, intenta de nuevo.")}finally{P(!1)}}})()},[a]);const b=m=>{C({...l,[m.target.name]:m.target.value})},q=m=>{C({...l,[m.target.name]:m.target.value})},M=(m,p)=>{const w=m.target.files?.[0];if(w){if(w.size>2048*1024){Y.fire({icon:"warning",title:"¡Imagen muy grande!",text:"Máx. 2 MB."}),m.target&&(m.target.value="");return}C({...l,[p]:w})}},R=(m,p)=>{const w=m.target.files?.[0]||null;if(w&&w.size>2048*1024){Y.fire({icon:"warning",title:"¡Imagen muy grande!",text:"Máx. 2 MB."}),m.target&&(m.target.value="");return}const k=[...l.imagenes_secundarias];k[p]=w,C({...l,imagenes_secundarias:k})},H=(m,p)=>{const w=[...l.alt_imagenes_secundarias];w[p]=m.target.value,C({...l,alt_imagenes_secundarias:w})},K=(m,p)=>{const w=[...l.parrafos];w[p]=m.target.value,C({...l,parrafos:w})},Q=m=>{const p=document.getElementById(`parrafo-${m}`);if(!p)return;const w=p.selectionStart,k=p.selectionEnd;if(w===k){Y.fire("Selecciona texto","Selecciona una palabra o frase antes de insertar el enlace.","warning");return}const B=p.value.substring(w,k);N(m),c({start:w,end:k}),i(B),v(!0)},te=()=>{if(E===null||O===null||!d.trim())return;const m=l.parrafos[E],p=`<a href="${d}" target="_blank" rel="noopener noreferrer" title="${f}" style="color: white; font-weight: bold; font-style: italic;">${f}</a>`,w=m.slice(0,O.start)+p+m.slice(O.end),k=[...l.parrafos];k[E]=w,C({...l,parrafos:k}),N(null),c(null),i(""),S(""),v(!1)},ae=m=>{const p=document.getElementById(`parrafo-${m}`);if(!p)return;const w=p.selectionStart,k=p.selectionEnd,B=p.value.substring(w,k);if(!B){Y.fire("Selecciona texto","Selecciona una palabra o frase para enlazar a un producto.","warning");return}N(m),c({start:w,end:k}),i(B),y(!0)},re=m=>{if(E===null||O===null)return;const p=l.parrafos[E],w=m.link,k=`<a href="/products/producto/?link=${w}" style="color: white; font-weight: bold; font-style: italic;" title="${w}">${f}</a>`,B=p.slice(0,O.start)+k+p.slice(O.end),L=[...l.parrafos];L[E]=B,C({...l,parrafos:L}),N(null),c(null),i(""),y(!1)},A=()=>{e(!1),N(null),c(null),i(""),v(!1),y(!1),S(""),C(I)},D=async m=>{m.preventDefault();const p=!!r;if(!l.producto_id)return alert("⚠️ Debe seleccionar un producto.");if(!l.subtitulo.trim())return alert("⚠️ El subtítulo es obligatorio.");if(!p&&!l.imagen_principal)return alert("⚠️ La imagen principal es obligatoria para crear.");if(!l.subtitulo.trim())return alert("⚠️ El subtítulo es obligatorio.");if(!p&&!l.imagen_principal)return alert("⚠️ La imagen principal es obligatoria para crear.");const w=l.parrafos.filter(B=>B.trim());if(w.length===0)return alert("⚠️ Debe haber al menos un párrafo con contenido.");const k=/^[a-z0-Z0-9]+(?:-[a-z0-Z0-9]+)*$/;if(l.link&&!k.test(l.link))return alert("⚠️ El link debe ser URL-friendly (Solo letras, guiones y números).");try{P(!0);const B=localStorage.getItem("token"),L=new FormData;L.append("producto_id",l.producto_id),L.append("subtitulo",l.subtitulo),L.append("url_video",l.url_video),l.link?.trim()&&L.append("link",l.link.trim());const ne={meta_titulo:l.meta_titulo?.trim()||"",meta_descripcion:l.meta_descripcion?.trim()||""};(ne.meta_titulo||ne.meta_descripcion)&&L.append("etiqueta",JSON.stringify(ne)),l.text_alt_principal?.trim()&&L.append("text_alt_principal",l.text_alt_principal.trim()),l.alt_imagen_card?.trim()&&L.append("alt_imagen_card",l.alt_imagen_card.trim()),l.imagen_principal&&L.append("imagen_principal",l.imagen_principal),l.imagenes_secundarias.filter(z=>z!==null).forEach(z=>L.append("imagenes[]",z)),l.alt_imagenes_secundarias.forEach((z,V)=>{(l.imagenes_secundarias[V]!==null||p&&z.trim())&&L.append("alt_imagenes[]",z.trim())}),w.forEach(z=>L.append("parrafos[]",z.trim()));const ge=p?W(G.endpoints.blogs.update(r.id)):W(G.endpoints.blogs.create);p&&L.append("_method","PUT");const X=await fetch(ge,{method:"POST",body:L,headers:{Authorization:`Bearer ${B}`,Accept:"application/json"}});let T;try{T=await X.json()}catch{T=await X.text()}if(X.ok)alert(`✅ Blog ${p?"actualizado":"creado"} correctamente.`),A(),n?.();else if(T.errors){let z=`❌ Errores de validación:
`;Object.keys(T.errors).forEach(V=>{const be=Array.isArray(T.errors[V])?T.errors[V]:[T.errors[V]];z+=`• ${V}: ${be.join(", ")}
`}),alert(z)}else alert(`❌ Error (${X.status}): ${T.message||JSON.stringify(T)}`)}catch(B){console.error("❌ Error en la solicitud:",B),alert("❌ Error en la conexión con el servidor.")}finally{P(!1)}};return a?t.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:t.jsxs("div",{className:"bg-white text-black px-4 sm:px-6 md:px-8 py-6 rounded-lg max-h-[90vh] w-full max-w-5xl mx-2 overflow-y-auto",children:[t.jsx("h2",{className:"text-2xl font-bold mb-6 text-center md:text-left",children:r?"Editar Blog":"Añadir Blog"}),t.jsx("form",{onSubmit:D,encType:"multipart/form-data",className:"space-y-8",children:t.jsxs("div",{className:"bg-blue-50 p-4 sm:p-6 rounded-lg border border-blue-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"Información Principal & SEO"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"col-span-1 md:col-span-4",children:[t.jsxs("label",{className:"block mb-2 font-medium",children:["Producto ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("select",{name:"producto_id",value:l.producto_id,onChange:q,required:!0,className:"w-full bg-white text-black p-2 rounded-md border border-gray-300",disabled:s,children:[t.jsx("option",{value:"",children:s?"Cargando productos...":"-- Selecciona un producto --"}),g.map(m=>t.jsx("option",{value:m.id.toString(),children:m.nombre||`Producto ${m.id}`},m.id))]}),t.jsx("small",{className:"text-gray-500",children:"Selecciona el producto relacionado con este blog. Requerido."}),h&&t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Producto seleccionado: ",t.jsx("strong",{children:h})]})]}),t.jsxs("div",{className:"col-span-1 md:col-span-2",children:[t.jsxs("label",{className:"block font-medium mb-1",children:["Subtítulo ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{name:"subtitulo",value:l.subtitulo,onChange:b,className:"w-full border border-gray-300 rounded px-3 py-2",required:!0}),t.jsx("small",{className:"text-gray-500 block mt-1",children:"Máx. 120 caracteres (letras, números y espacios)."})]}),t.jsxs("div",{className:"col-span-1 md:col-span-2",children:[t.jsx("label",{className:"block font-medium mb-1",children:"Meta título"}),t.jsx("input",{type:"text",name:"meta_titulo",value:l.meta_titulo||"",onChange:b,placeholder:"Título optimizado para SEO",className:"w-full border border-gray-300 rounded px-3 py-2"}),t.jsx("small",{className:"text-gray-500 block mt-1",children:"Máx. 70 caracteres (letras, números y espacios)."})]}),t.jsxs("div",{className:"col-span-1 md:col-span-4",children:[t.jsx("label",{className:"block font-medium mb-1",children:"Meta descripción"}),t.jsx("textarea",{name:"meta_descripcion",value:l.meta_descripcion||"",onChange:b,placeholder:"Descripción optimizada para SEO",className:"w-full border border-gray-300 rounded px-3 py-2"}),t.jsx("small",{className:"text-gray-500 block mt-1",children:"Máx. 160 caracteres (letras, números y espacios)."})]}),t.jsxs("div",{className:"col-span-1 md:col-span-4",children:[t.jsx("label",{className:"block font-medium mb-1",children:"Link (URL amigable)"}),t.jsx("input",{type:"text",name:"link",value:l.link,onChange:b,placeholder:"ejemplo: mi-blog-post",className:"w-full border border-gray-300 rounded px-3 py-2"}),t.jsx("small",{className:"text-gray-500",children:"Escribe solo letras y guiones. Máx. 255 letras o números."})]})]}),t.jsxs("div",{className:"bg-green-50 p-4 sm:p-6 rounded-lg border border-green-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-4",children:"Imágenes"}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"border border-green-400 rounded p-4",children:[t.jsxs("label",{className:"block font-medium mb-2",children:["Imagen Principal"," ",!r&&t.jsx("span",{className:"text-red-500",children:"*"})]}),r?.imagen_principal&&t.jsx("img",{src:r.imagen_principal,alt:l.text_alt_principal||"Imagen principal",className:"w-full h-48 sm:h-64 object-cover rounded mb-4 border"}),t.jsx("input",{type:"file",accept:"image/*",onChange:m=>M(m,"imagen_principal"),className:"w-full file:py-2 file:px-3 file:border-0 file:bg-green-100 file:text-green-700 hover:file:bg-green-200"}),t.jsx("small",{className:"text-gray-500",children:"Peso máximo: 2 MB."}),t.jsx("input",{type:"text",name:"text_alt_principal",placeholder:"Texto ALT para SEO",value:l.text_alt_principal,onChange:b,className:"mt-2 w-full border border-gray-300 rounded px-3 py-2"})]}),t.jsxs("div",{className:"border border-green-400 rounded p-4",children:[t.jsx("label",{className:"block font-semibold mb-4",children:"Imágenes Secundarias"}),t.jsx("small",{className:"text-gray-500",children:"Imágenes adicionales del artículo. Se creará un registro por archivo en la tabla imagen_blogs."}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:l.imagenes_secundarias.map((m,p)=>t.jsxs("div",{className:"flex flex-col items-center",children:[r?.imagenes?.[p]?.ruta_imagen&&t.jsx("img",{src:r.imagenes[p].ruta_imagen,alt:l.alt_imagenes_secundarias[p]||`Imagen secundaria #${p+1}`,className:"w-full h-32 object-cover rounded mb-2 border"}),t.jsx("input",{type:"file",accept:"image/*",onChange:w=>R(w,p),className:"w-full file:py-2 file:px-3 file:border-0 file:bg-green-100 file:text-green-700 hover:file:bg-green-200"}),t.jsxs("small",{className:"text-gray-500",children:["Archivo de imagen secundaria #",p+1,".",t.jsx("br",{}),"Tamaño máximo: 2 MB."]}),t.jsx("input",{type:"text",placeholder:`Texto ALT imagen secundaria #${p+1}`,value:l.alt_imagenes_secundarias[p],onChange:w=>H(w,p),className:"w-full border border-gray-300 rounded px-3 py-2 mt-2"})]},p))})]})]})]}),t.jsxs("div",{className:"bg-purple-50 p-4 sm:p-6 rounded-lg border border-purple-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-4",children:"Video"}),t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL del Video *"}),t.jsx("input",{type:"url",name:"url_video",value:l.url_video,onChange:b,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),t.jsx("small",{className:"text-gray-500",children:"Solo minúsculas y guiones. Hasta 255 letras, números o espacios."})]}),t.jsxs("div",{className:"bg-yellow-50 p-4 sm:p-6 rounded-lg border border-yellow-200",children:[t.jsxs("h3",{className:"text-lg font-semibold text-yellow-800 mb-4",children:["Párrafos ",t.jsx("span",{className:"text-red-500",children:"*"})]}),l.parrafos.map((m,p)=>t.jsxs("div",{className:"relative mb-6",children:[t.jsx("textarea",{id:`parrafo-${p}`,value:m,onChange:w=>K(w,p),className:"w-full border border-gray-300 rounded px-3 py-2 pr-20",rows:4,placeholder:`Párrafo ${p+1} (opcional)`}),t.jsx("small",{className:"text-gray-500",children:"Máx. 100 caracteres (letras, números y espacios)."}),t.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[t.jsx("button",{type:"button",onClick:()=>Q(p),className:"bg-blue-500 hover:bg-blue-700 text-white p-2 rounded-full shadow-lg transition",children:"🔗"}),t.jsx("button",{type:"button",onClick:()=>ae(p),className:"bg-green-500 hover:bg-green-700 text-white p-2 rounded-full shadow-lg transition",children:"🛒"})]})]},p))]}),t.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4",children:[t.jsx("button",{type:"button",onClick:A,className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",disabled:s,children:"Cancelar"}),t.jsx("button",{type:"submit",disabled:s,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded disabled:opacity-50",children:s?"Procesando...":r?"Actualizar":"Crear"})]})]})}),u&&t.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-[60]",children:t.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[t.jsx("h3",{className:"text-lg font-bold mb-4",children:"Insertar Enlace"}),t.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Texto seleccionado: ",t.jsxs("strong",{children:['"',f,'"']})]}),t.jsx("input",{type:"url",value:d,onChange:m=>S(m.target.value),placeholder:"https://ejemplo.com",className:"w-full border border-gray-300 rounded px-3 py-2 mb-4",required:!0}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:()=>v(!1),className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",children:"Cancelar"}),t.jsx("button",{type:"button",onClick:te,disabled:!d.trim(),className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-300 text-white px-4 py-2 rounded",children:"Insertar"})]})]})}),j&&t.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-[60]",children:t.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[t.jsx("h3",{className:"text-lg font-bold mb-4",children:"Enlazar a Producto"}),t.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Texto seleccionado: ",t.jsxs("strong",{children:['"',f,'"']})]}),t.jsxs("select",{onChange:m=>{const p=parseInt(m.target.value),w=g.find(k=>k.id===p);w&&re(w)},className:"w-full border border-gray-300 rounded px-3 py-2 mb-4",children:[t.jsx("option",{value:"",children:"-- Seleccionar producto --"}),g.map(m=>t.jsx("option",{value:m.id,children:m.nombre},m.id))]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{type:"button",onClick:()=>y(!1),className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",children:"Cancelar"})})]})})]})}):null},oe=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopedSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideNextClass","slidePrevClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function F(a){return typeof a=="object"&&a!==null&&a.constructor&&Object.prototype.toString.call(a).slice(8,-1)==="Object"&&!a.__swiper__}function U(a,e){const r=["__proto__","constructor","prototype"];Object.keys(e).filter(n=>r.indexOf(n)<0).forEach(n=>{typeof a[n]>"u"?a[n]=e[n]:F(e[n])&&F(a[n])&&Object.keys(e[n]).length>0?e[n].__swiper__?a[n]=e[n]:U(a[n],e[n]):a[n]=e[n]})}function ce(a){return a===void 0&&(a={}),a.navigation&&typeof a.navigation.nextEl>"u"&&typeof a.navigation.prevEl>"u"}function de(a){return a===void 0&&(a={}),a.pagination&&typeof a.pagination.el>"u"}function ue(a){return a===void 0&&(a={}),a.scrollbar&&typeof a.scrollbar.el>"u"}function pe(a){a===void 0&&(a="");const e=a.split(" ").map(n=>n.trim()).filter(n=>!!n),r=[];return e.forEach(n=>{r.indexOf(n)<0&&r.push(n)}),r.join(" ")}function Ne(a){return a===void 0&&(a=""),a?a.includes("swiper-wrapper")?a:`swiper-wrapper ${a}`:"swiper-wrapper"}function Ce(a){let{swiper:e,slides:r,passedParams:n,changedParams:g,nextEl:o,prevEl:h,scrollbarEl:_,paginationEl:s}=a;const P=g.filter(b=>b!=="children"&&b!=="direction"&&b!=="wrapperClass"),{params:u,pagination:v,navigation:E,scrollbar:N,virtual:O,thumbs:c}=e;let f,i,j,y,d,S,I,l;g.includes("thumbs")&&n.thumbs&&n.thumbs.swiper&&u.thumbs&&!u.thumbs.swiper&&(f=!0),g.includes("controller")&&n.controller&&n.controller.control&&u.controller&&!u.controller.control&&(i=!0),g.includes("pagination")&&n.pagination&&(n.pagination.el||s)&&(u.pagination||u.pagination===!1)&&v&&!v.el&&(j=!0),g.includes("scrollbar")&&n.scrollbar&&(n.scrollbar.el||_)&&(u.scrollbar||u.scrollbar===!1)&&N&&!N.el&&(y=!0),g.includes("navigation")&&n.navigation&&(n.navigation.prevEl||h)&&(n.navigation.nextEl||o)&&(u.navigation||u.navigation===!1)&&E&&!E.prevEl&&!E.nextEl&&(d=!0);const C=b=>{e[b]&&(e[b].destroy(),b==="navigation"?(e.isElement&&(e[b].prevEl.remove(),e[b].nextEl.remove()),u[b].prevEl=void 0,u[b].nextEl=void 0,e[b].prevEl=void 0,e[b].nextEl=void 0):(e.isElement&&e[b].el.remove(),u[b].el=void 0,e[b].el=void 0))};g.includes("loop")&&e.isElement&&(u.loop&&!n.loop?S=!0:!u.loop&&n.loop?I=!0:l=!0),P.forEach(b=>{if(F(u[b])&&F(n[b]))U(u[b],n[b]),(b==="navigation"||b==="pagination"||b==="scrollbar")&&"enabled"in n[b]&&!n[b].enabled&&C(b);else{const q=n[b];(q===!0||q===!1)&&(b==="navigation"||b==="pagination"||b==="scrollbar")?q===!1&&C(b):u[b]=n[b]}}),P.includes("controller")&&!i&&e.controller&&e.controller.control&&u.controller&&u.controller.control&&(e.controller.control=u.controller.control),g.includes("children")&&r&&O&&u.virtual.enabled&&(O.slides=r,O.update(!0)),g.includes("children")&&r&&u.loop&&(l=!0),f&&c.init()&&c.update(!0),i&&(e.controller.control=u.controller.control),j&&(e.isElement&&(!s||typeof s=="string")&&(s=document.createElement("div"),s.classList.add("swiper-pagination"),s.part.add("pagination"),e.el.appendChild(s)),s&&(u.pagination.el=s),v.init(),v.render(),v.update()),y&&(e.isElement&&(!_||typeof _=="string")&&(_=document.createElement("div"),_.classList.add("swiper-scrollbar"),_.part.add("scrollbar"),e.el.appendChild(_)),_&&(u.scrollbar.el=_),N.init(),N.updateSize(),N.setTranslate()),d&&(e.isElement&&((!o||typeof o=="string")&&(o=document.createElement("div"),o.classList.add("swiper-button-next"),o.innerHTML=e.hostEl.constructor.nextButtonSvg,o.part.add("button-next"),e.el.appendChild(o)),(!h||typeof h=="string")&&(h=document.createElement("div"),h.classList.add("swiper-button-prev"),h.innerHTML=e.hostEl.constructor.prevButtonSvg,h.part.add("button-prev"),e.el.appendChild(h))),o&&(u.navigation.nextEl=o),h&&(u.navigation.prevEl=h),E.init(),E.update()),g.includes("allowSlideNext")&&(e.allowSlideNext=n.allowSlideNext),g.includes("allowSlidePrev")&&(e.allowSlidePrev=n.allowSlidePrev),g.includes("direction")&&e.changeDirection(n.direction,!1),(S||l)&&e.loopDestroy(),(I||l)&&e.loopCreate(),e.update()}function Pe(a,e){a===void 0&&(a={}),e===void 0&&(e=!0);const r={on:{}},n={},g={};U(r,we),r._emitClasses=!0,r.init=!1;const o={},h=oe.map(s=>s.replace(/_/,"")),_=Object.assign({},a);return Object.keys(_).forEach(s=>{typeof a[s]>"u"||(h.indexOf(s)>=0?F(a[s])?(r[s]={},g[s]={},U(r[s],a[s]),U(g[s],a[s])):(r[s]=a[s],g[s]=a[s]):s.search(/on[A-Z]/)===0&&typeof a[s]=="function"?e?n[`${s[2].toLowerCase()}${s.substr(3)}`]=a[s]:r.on[`${s[2].toLowerCase()}${s.substr(3)}`]=a[s]:o[s]=a[s])}),["navigation","pagination","scrollbar"].forEach(s=>{r[s]===!0&&(r[s]={}),r[s]===!1&&delete r[s]}),{params:r,passedParams:g,rest:o,events:n}}function Ie(a,e){let{el:r,nextEl:n,prevEl:g,paginationEl:o,scrollbarEl:h,swiper:_}=a;ce(e)&&n&&g&&(_.params.navigation.nextEl=n,_.originalParams.navigation.nextEl=n,_.params.navigation.prevEl=g,_.originalParams.navigation.prevEl=g),de(e)&&o&&(_.params.pagination.el=o,_.originalParams.pagination.el=o),ue(e)&&h&&(_.params.scrollbar.el=h,_.originalParams.scrollbar.el=h),_.init(r)}function ke(a,e,r,n,g){const o=[];if(!e)return o;const h=s=>{o.indexOf(s)<0&&o.push(s)};if(r&&n){const s=n.map(g),P=r.map(g);s.join("")!==P.join("")&&h("children"),n.length!==r.length&&h("children")}return oe.filter(s=>s[0]==="_").map(s=>s.replace(/_/,"")).forEach(s=>{if(s in a&&s in e)if(F(a[s])&&F(e[s])){const P=Object.keys(a[s]),u=Object.keys(e[s]);P.length!==u.length?h(s):(P.forEach(v=>{a[s][v]!==e[s][v]&&h(s)}),u.forEach(v=>{a[s][v]!==e[s][v]&&h(s)}))}else a[s]!==e[s]&&h(s)}),o}const Oe=a=>{!a||a.destroyed||!a.params.virtual||a.params.virtual&&!a.params.virtual.enabled||(a.updateSlides(),a.updateProgress(),a.updateSlidesClasses(),a.parallax&&a.params.parallax&&a.params.parallax.enabled&&a.parallax.setTranslate())};function ee(){return ee=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(a[n]=r[n])}return a},ee.apply(this,arguments)}function fe(a){return a.type&&a.type.displayName&&a.type.displayName.includes("SwiperSlide")}function me(a){const e=[];return $.Children.toArray(a).forEach(r=>{fe(r)?e.push(r):r.props&&r.props.children&&me(r.props.children).forEach(n=>e.push(n))}),e}function $e(a){const e=[],r={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return $.Children.toArray(a).forEach(n=>{if(fe(n))e.push(n);else if(n.props&&n.props.slot&&r[n.props.slot])r[n.props.slot].push(n);else if(n.props&&n.props.children){const g=me(n.props.children);g.length>0?g.forEach(o=>e.push(o)):r["container-end"].push(n)}else r["container-end"].push(n)}),{slides:e,slots:r}}function Ae(a,e,r){if(!r)return null;const n=u=>{let v=u;return u<0?v=e.length+u:v>=e.length&&(v=v-e.length),v},g=a.isHorizontal()?{[a.rtlTranslate?"right":"left"]:`${r.offset}px`}:{top:`${r.offset}px`},{from:o,to:h}=r,_=a.params.loop?-e.length:0,s=a.params.loop?e.length*2:e.length,P=[];for(let u=_;u<s;u+=1)u>=o&&u<=h&&P.push(e[n(u)]);return P.map((u,v)=>$.cloneElement(u,{swiper:a,style:g,key:`slide-${v}`}))}function Z(a,e){return typeof window>"u"?x.useEffect(a,e):x.useLayoutEffect(a,e)}const le=x.createContext(null),Le=x.createContext(null),se=x.forwardRef(function(a,e){let{className:r,tag:n="div",wrapperTag:g="div",children:o,onSwiper:h,..._}=a===void 0?{}:a,s=!1;const[P,u]=x.useState("swiper"),[v,E]=x.useState(null),[N,O]=x.useState(!1),c=x.useRef(!1),f=x.useRef(null),i=x.useRef(null),j=x.useRef(null),y=x.useRef(null),d=x.useRef(null),S=x.useRef(null),I=x.useRef(null),l=x.useRef(null),{params:C,passedParams:b,rest:q,events:M}=Pe(_),{slides:R,slots:H}=$e(o),K=()=>{O(!N)};Object.assign(C.on,{_containerClasses(A,D){u(D)}});const Q=()=>{Object.assign(C.on,M),s=!0;const A={...C};if(delete A.wrapperClass,i.current=new _e(A),i.current.virtual&&i.current.params.virtual.enabled){i.current.virtual.slides=R;const D={cache:!1,slides:R,renderExternal:E,renderExternalUpdate:!1};U(i.current.params.virtual,D),U(i.current.originalParams.virtual,D)}};f.current||Q(),i.current&&i.current.on("_beforeBreakpoint",K);const te=()=>{s||!M||!i.current||Object.keys(M).forEach(A=>{i.current.on(A,M[A])})},ae=()=>{!M||!i.current||Object.keys(M).forEach(A=>{i.current.off(A,M[A])})};x.useEffect(()=>()=>{i.current&&i.current.off("_beforeBreakpoint",K)}),x.useEffect(()=>{!c.current&&i.current&&(i.current.emitSlidesClasses(),c.current=!0)}),Z(()=>{if(e&&(e.current=f.current),!!f.current)return i.current.destroyed&&Q(),Ie({el:f.current,nextEl:d.current,prevEl:S.current,paginationEl:I.current,scrollbarEl:l.current,swiper:i.current},C),h&&h(i.current),()=>{i.current&&!i.current.destroyed&&i.current.destroy(!0,!1)}},[]),Z(()=>{te();const A=ke(b,j.current,R,y.current,D=>D.key);return j.current=b,y.current=R,A.length&&i.current&&!i.current.destroyed&&Ce({swiper:i.current,slides:R,passedParams:b,changedParams:A,nextEl:d.current,prevEl:S.current,scrollbarEl:l.current,paginationEl:I.current}),()=>{ae()}}),Z(()=>{Oe(i.current)},[v]);function re(){return C.virtual?Ae(i.current,R,v):R.map((A,D)=>$.cloneElement(A,{swiper:i.current,swiperSlideIndex:D}))}return $.createElement(n,ee({ref:f,className:pe(`${P}${r?` ${r}`:""}`)},q),$.createElement(Le.Provider,{value:i.current},H["container-start"],$.createElement(g,{className:Ne(C.wrapperClass)},H["wrapper-start"],re(),H["wrapper-end"]),ce(C)&&$.createElement($.Fragment,null,$.createElement("div",{ref:S,className:"swiper-button-prev"}),$.createElement("div",{ref:d,className:"swiper-button-next"})),ue(C)&&$.createElement("div",{ref:l,className:"swiper-scrollbar"}),de(C)&&$.createElement("div",{ref:I,className:"swiper-pagination"}),H["container-end"]))});se.displayName="Swiper";const J=x.forwardRef(function(a,e){let{tag:r="div",children:n,className:g="",swiper:o,zoom:h,lazy:_,virtualIndex:s,swiperSlideIndex:P,...u}=a===void 0?{}:a;const v=x.useRef(null),[E,N]=x.useState("swiper-slide"),[O,c]=x.useState(!1);function f(d,S,I){S===v.current&&N(I)}Z(()=>{if(typeof P<"u"&&(v.current.swiperSlideIndex=P),e&&(e.current=v.current),!(!v.current||!o)){if(o.destroyed){E!=="swiper-slide"&&N("swiper-slide");return}return o.on("_slideClass",f),()=>{o&&o.off("_slideClass",f)}}}),Z(()=>{o&&v.current&&!o.destroyed&&N(o.getSlideClasses(v.current))},[o]);const i={isActive:E.indexOf("swiper-slide-active")>=0,isVisible:E.indexOf("swiper-slide-visible")>=0,isPrev:E.indexOf("swiper-slide-prev")>=0,isNext:E.indexOf("swiper-slide-next")>=0},j=()=>typeof n=="function"?n(i):n,y=()=>{c(!0)};return $.createElement(r,ee({ref:v,className:pe(`${E}${g?` ${g}`:""}`),"data-swiper-slide-index":s,onLoad:y},u),h&&$.createElement(le.Provider,{value:i},$.createElement("div",{className:"swiper-zoom-container","data-swiper-zoom":typeof h=="number"?h:void 0},j(),_&&!O&&$.createElement("div",{className:"swiper-lazy-preloader"}))),!h&&$.createElement(le.Provider,{value:i},j(),_&&!O&&$.createElement("div",{className:"swiper-lazy-preloader"})))});J.displayName="SwiperSlide";function Be(a){let{swiper:e,extendParams:r,on:n,emit:g}=a;r({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),e.navigation={nextEl:null,prevEl:null};const o=c=>(Array.isArray(c)?c:[c]).filter(f=>!!f);function h(c){let f;return c&&typeof c=="string"&&e.isElement&&(f=e.el.querySelector(c),f)?f:(c&&(typeof c=="string"&&(f=[...document.querySelectorAll(c)]),e.params.uniqueNavElements&&typeof c=="string"&&f.length>1&&e.el.querySelectorAll(c).length===1&&(f=e.el.querySelector(c))),c&&!f?c:f)}function _(c,f){const i=e.params.navigation;c=o(c),c.forEach(j=>{j&&(j.classList[f?"add":"remove"](...i.disabledClass.split(" ")),j.tagName==="BUTTON"&&(j.disabled=f),e.params.watchOverflow&&e.enabled&&j.classList[e.isLocked?"add":"remove"](i.lockClass))})}function s(){const{nextEl:c,prevEl:f}=e.navigation;if(e.params.loop){_(f,!1),_(c,!1);return}_(f,e.isBeginning&&!e.params.rewind),_(c,e.isEnd&&!e.params.rewind)}function P(c){c.preventDefault(),!(e.isBeginning&&!e.params.loop&&!e.params.rewind)&&(e.slidePrev(),g("navigationPrev"))}function u(c){c.preventDefault(),!(e.isEnd&&!e.params.loop&&!e.params.rewind)&&(e.slideNext(),g("navigationNext"))}function v(){const c=e.params.navigation;if(e.params.navigation=je(e,e.originalParams.navigation,e.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(c.nextEl||c.prevEl))return;let f=h(c.nextEl),i=h(c.prevEl);Object.assign(e.navigation,{nextEl:f,prevEl:i}),f=o(f),i=o(i);const j=(y,d)=>{y&&y.addEventListener("click",d==="next"?u:P),!e.enabled&&y&&y.classList.add(...c.lockClass.split(" "))};f.forEach(y=>j(y,"next")),i.forEach(y=>j(y,"prev"))}function E(){let{nextEl:c,prevEl:f}=e.navigation;c=o(c),f=o(f);const i=(j,y)=>{j.removeEventListener("click",y==="next"?u:P),j.classList.remove(...e.params.navigation.disabledClass.split(" "))};c.forEach(j=>i(j,"next")),f.forEach(j=>i(j,"prev"))}n("init",()=>{e.params.navigation.enabled===!1?O():(v(),s())}),n("toEdge fromEdge lock unlock",()=>{s()}),n("destroy",()=>{E()}),n("enable disable",()=>{let{nextEl:c,prevEl:f}=e.navigation;if(c=o(c),f=o(f),e.enabled){s();return}[...c,...f].filter(i=>!!i).forEach(i=>i.classList.add(e.params.navigation.lockClass))}),n("click",(c,f)=>{let{nextEl:i,prevEl:j}=e.navigation;i=o(i),j=o(j);const y=f.target;if(e.params.navigation.hideOnClick&&!j.includes(y)&&!i.includes(y)){if(e.pagination&&e.params.pagination&&e.params.pagination.clickable&&(e.pagination.el===y||e.pagination.el.contains(y)))return;let d;i.length?d=i[0].classList.contains(e.params.navigation.hiddenClass):j.length&&(d=j[0].classList.contains(e.params.navigation.hiddenClass)),g(d===!0?"navigationShow":"navigationHide"),[...i,...j].filter(S=>!!S).forEach(S=>S.classList.toggle(e.params.navigation.hiddenClass))}});const N=()=>{e.el.classList.remove(...e.params.navigation.navigationDisabledClass.split(" ")),v(),s()},O=()=>{e.el.classList.add(...e.params.navigation.navigationDisabledClass.split(" ")),E()};Object.assign(e.navigation,{enable:N,disable:O,update:s,init:v,destroy:E})}const ze=({item:a,getImageUrl:e})=>{const[r,n]=x.useState(null),g=1+(a.imagenes?.length||0);return x.useEffect(()=>{r&&r.update()},[a,r]),g<=1?t.jsx("img",{src:e(a.imagen_principal),alt:a.nombre_producto||"Blog",className:"w-full max-w-[120px] h-20 object-cover rounded-lg shadow-md"}):t.jsxs(se,{onSwiper:n,modules:[ie,ye],spaceBetween:10,slidesPerView:1,loop:g>=3,rewind:g===2,speed:800,autoplay:{delay:2e3,disableOnInteraction:!1,pauseOnMouseEnter:!0},pagination:{clickable:!0},className:"w-full max-w-[120px] h-20 rounded-lg shadow-md",children:[t.jsx(J,{children:t.jsx("img",{src:e(a.imagen_principal),alt:a.nombre_producto||"Blog",className:"w-full h-20 object-cover rounded-lg"})},`slide-principal-${a.id}`),a.imagenes?.map((o,h)=>t.jsx(J,{children:t.jsx("img",{src:e(o.ruta_imagen),alt:o.text_alt||"Imagen extra",className:"w-full h-20 object-cover rounded-lg"})},`slide-${a.id}-${h}`))]})},Je=()=>{const[a,e]=x.useState([]),[r,n]=x.useState(1),g=5,[o,h]=x.useState({current_page:1,last_page:1,per_page:g,total:0}),[_,s]=x.useState(null),[P,u]=x.useState(!0),[v,E]=x.useState(!1),{darkMode:N}=Ee(),O=async(d=1)=>{u(!0);try{const S=localStorage.getItem("token"),I=await fetch(`${W(G.endpoints.blogs.list)}?page=${d}&per_page=${g}`,{headers:{Authorization:`Bearer ${S}`,Accept:"application/json"}});if(!I.ok)throw new Error(`HTTP error! status: ${I.status}`);const l=await I.json();l.success&&l.data&&Array.isArray(l.data.data)?(e(l.data.data),h({current_page:l.data.current_page??d,last_page:l.data.last_page,per_page:l.data.per_page,total:l.data.total})):e([])}catch(S){console.error("❌ Error al cargar datos:",S),e([])}finally{u(!1)}};x.useEffect(()=>{O(r)},[r]);const c=d=>{d>=1&&d<=o.last_page&&n(d)},f=async d=>{const S=localStorage.getItem("token");if(window.confirm("¿Estás seguro de que deseas eliminar este blog?"))try{const l=await fetch(W(G.endpoints.blogs.delete(d)),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`}});if(l.ok)O(r),alert("✅ Blog eliminado exitosamente");else{const C=await l.json().catch(()=>({}));alert(`❌ Error al eliminar el blog: ${C.message||"Error desconocido"}`)}}catch{alert("❌ Error al conectar con el servidor")}},i=d=>d?d.startsWith("http")?d:`https://apiyuntas.yuntaspublicidad.com${d}`:"/placeholder-image.jpg",j=(d,S=50)=>d?d.length>S?d.substring(0,S)+"...":d:"",y=()=>{s(null),E(!0)};return t.jsxs("div",{className:"overflow-x-auto p-2 sm:p-4",children:[t.jsxs(ve,{tableType:"blogs",exportData:a,onAddNew:y,children:[t.jsx("thead",{className:"hidden md:table-header-group",children:t.jsx("tr",{className:"bg-blue-950 text-white",children:["ID","PRODUCTO","SUBTÍTULO","IMAGEN","FECHA","ACCIÓN"].map(d=>t.jsx("th",{className:`px-4 py-2 text-white uppercase text-xs font-bold rounded-md ${N?"bg-cyan-900":"bg-cyan-400"}`,children:d},d))})}),t.jsx("tbody",{children:P?t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-500 block md:table-cell",children:"Cargando blogs..."})}):a.length>0?a.map((d,S)=>(1+(d.imagenes?.length||0),t.jsxs("tr",{className:`md:table-row block md:mb-0 mb-6 rounded-xl shadow-md overflow-hidden border ${S%2===0&&N?"bg-white text-black":"text-black bg-white"}`,children:[t.jsx("td",{"data-label":"ID",className:`block md:table-cell px-4 py-2 border-b font-bold before:content-['ID'] before:font-semibold before:block md:before:hidden ${N?"bg-gray-300":""}`,children:d.id}),t.jsx("td",{"data-label":"Producto",className:`block md:table-cell px-4 py-2 border-b font-semibold before:content-['Producto'] before:font-semibold before:block md:before:hidden ${N?"bg-gray-300":""}`,children:j(d.nombre_producto||"Sin nombre",30)}),t.jsx("td",{"data-label":"Subtítulo",className:`block md:table-cell px-4 py-2 border-b before:content-['Subtítulo'] before:font-semibold before:block md:before:hidden ${N?"bg-gray-300":""}`,children:j(d.subtitulo,40)}),t.jsxs("td",{"data-label":"Imagen",className:`block md:table-cell px-4 py-2 border-b border-gray-200 relative md:static before:content-['Imagen'] before:font-semibold before:block md:before:hidden ${N?"bg-gray-300":""}`,children:[t.jsx("div",{className:"block md:hidden w-full",children:t.jsxs(se,{modules:[Be,ie],spaceBetween:10,slidesPerView:1,pagination:{clickable:!0},navigation:!0,className:"w-full max-w-[320px] rounded-lg shadow-md",children:[t.jsx(J,{children:t.jsx("img",{src:i(d.imagen_principal),alt:d.nombre_producto||"Blog",className:"w-full h-48 object-cover rounded-lg"})}),d.imagenes?.map((I,l)=>t.jsx(J,{children:t.jsx("img",{src:i(I.ruta_imagen),alt:I.text_alt||"Imagen extra",className:"w-full h-48 object-cover rounded-lg"})},l))]})}),t.jsx("div",{className:"hidden md:block w-full",children:t.jsx(ze,{item:d,getImageUrl:i},d.id)})]}),t.jsx("td",{"data-label":"Fecha",className:`block md:table-cell px-4 py-2 border-b text-sm before:content-['Fecha'] before:font-semibold before:block md:before:hidden ${N?"bg-gray-300":""}`,children:d.created_at?new Date(d.created_at).toLocaleDateString("es-ES"):"N/A"}),t.jsx("td",{"data-label":"Acción",className:`block md:table-cell px-4 py-3 border-b before:content-['Acción'] before:font-semibold before:block md:before:hidden ${N?"bg-gray-300":""}`,children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-3 mt-2 sm:mt-0",children:[t.jsxs("button",{className:"flex items-center justify-center gap-2 p-2 text-red-600 hover:text-red-800 transition bg-red-100 rounded-lg shadow-sm",title:"Eliminar",onClick:()=>f(d.id),children:[t.jsx(xe,{size:18}),t.jsx("span",{className:"md:hidden font-medium",children:"Borrar"})]}),t.jsxs("button",{className:"flex items-center justify-center gap-2 p-2 text-yellow-600 hover:text-yellow-800 transition bg-yellow-100 rounded-lg shadow-sm",title:"Editar",onClick:()=>{s(d),E(!0)},children:[t.jsx(he,{size:18}),t.jsx("span",{className:"md:hidden font-medium",children:"Editar"})]})]})})]},d.id))):t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-500",children:"No hay blogs disponibles"})})})]}),o.last_page>1&&t.jsxs("div",{className:"flex flex-wrap justify-center items-center mt-4 gap-2",children:[t.jsx("button",{onClick:()=>c(r-1),disabled:r===1,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-800 transition-colors",children:"Anterior"}),Array.from({length:o.last_page},(d,S)=>{const I=S+1;return t.jsx("button",{onClick:()=>c(I),className:`px-3 py-2 rounded-md ${r===I?"bg-blue-950 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:I},I)}),t.jsx("button",{onClick:()=>c(r+1),disabled:r===o.last_page,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-800 transition-colors",children:"Siguiente"})]}),t.jsx("button",{onClick:y,className:"mt-4 mb-6 bg-blue-950 hover:bg-blue-800 text-white text-lg px-8 sm:px-10 py-2 rounded-full w-full sm:w-auto",children:"Añadir Blog"}),t.jsx(Se,{isOpen:v,setIsOpen:E,blogToEdit:_,onSuccess:()=>{s(null),E(!1),O(r)}})]})};export{Je as default};
