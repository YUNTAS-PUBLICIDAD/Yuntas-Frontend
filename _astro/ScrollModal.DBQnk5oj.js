import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as t}from"./index.Be8AcK8B.js";import{g as p,c as x}from"./config.DZH0lvwJ.js";import{o as I,s as E,y as $}from"./yuleLove.TFxG_wNG.js";const R="asesoriaModalLastClosed",z=10*1e3,P=I({nombre:E().min(1,"El nombre es obligatorio").max(100,"El nombre no puede exceder 100 caracteres").regex(/^[a-zA-ZáéíóúÁÉÍÓÚñÑüÜ\s]+$/,"El nombre solo puede contener letras y espacios"),email:E().min(1,"El email es obligatorio").email("El formato del correo electrónico es inválido").max(100,"El email no puede exceder 100 caracteres"),telefono:E().regex(/^[0-9]{9}$/,"El celular debe tener exactamente 9 dígitos").regex(/^[0-9]{9}$/,"El celular solo puede contener números")}),H=()=>{const[h,g]=t.useState(!1),[D,N]=t.useState(!1),[d,b]=t.useState({nombre:"",email:"",telefono:""}),[i,c]=t.useState({}),[S,C]=t.useState(!1),[A,m]=t.useState(""),L=t.useRef(0),w=t.useRef(!1),u=t.useRef(!1),v=t.useRef(null),[y,O]=t.useState([]),[T,M]=t.useState(p(x.endpoints.clientes.create));t.useEffect(()=>{const s=window.location.pathname;console.log("URL ACTUAL",s),M(s==="/products"?p(x.endpoints.productos.info):p(x.endpoints.information.sendInformation)),(async()=>{try{const r=await fetch(p(x.endpoints.productos.all));if(!r.ok)throw new Error("No se pudieron obtener los productos");const n=await r.json();O(n.data)}catch(r){console.error("Error al obtener productos:",r)}})()},[]);const j=s=>{const{name:a,value:r}=s.target;b({...d,[a]:r}),i[a]&&c(n=>({...n,[a]:""}))},k=async s=>{s.preventDefault(),c({}),m("");const a=P.safeParse(d);if(!a.success){const r={};a.error.errors.forEach(n=>{const o=n.path[0];r[o]=n.message}),c(r);return}C(!0);try{const r=new FormData;if(r.append("name",a.data.nombre),r.append("email",a.data.email),r.append("celular",a.data.telefono),window.location.pathname==="/products"&&y.length>0){const l=y[Math.floor(Math.random()*y.length)];r.append("producto_id",l.id)}else r.append("current_page",window.location.pathname.split("/")[1]||"raiz");console.log("CONTENIDO DEL PAYLOAD: ");for(let l of r.entries())console.log(l[0]+": "+l[1]);const n=await fetch(T,{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:r});let o;try{const l=await n.text();if(!l)throw new Error("Respuesta vacía del servidor");o=JSON.parse(l)}catch(l){throw console.error("[ScrollModal] Error parsing response:",l),console.error("[ScrollModal] Response status:",n.status),console.error("[ScrollModal] Response headers:",n.headers),new Error("Error al procesar la respuesta del servidor")}if(!n.ok){if(n.status===422&&o.errors){const l={};o.errors.name&&(l.nombre=Array.isArray(o.errors.name)?o.errors.name[0]:o.errors.name),o.errors.email&&(l.email=Array.isArray(o.errors.email)?o.errors.email[0]:o.errors.email),o.errors.celular&&(l.telefono=Array.isArray(o.errors.celular)?o.errors.celular[0]:o.errors.celular),c(l);return}throw new Error(o.message||`Error ${n.status}: ${n.statusText}`)}m("✅ Información enviada con éxito"),b({nombre:"",email:"",telefono:""}),setTimeout(()=>{f(),m("")},2e3)}catch(r){console.error("[ScrollModal] Error:",r),r.name==="TypeError"&&(r.message.includes("fetch")||r.message.includes("CORS"))?c({general:"Error de conexión con el servidor. Por favor intenta nuevamente."}):r.message.includes("configuración del servidor")?c({general:"Error de configuración del servidor. Contacta al administrador."}):c({general:r.message||"Error desconocido al enviar la información."})}finally{C(!1)}};t.useEffect(()=>{const s=a=>{v.current&&!v.current.contains(a.target)&&f()};return h&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[h]),t.useEffect(()=>{const s=()=>{g(!0),u.current=!0};return window.addEventListener("open-scroll-modal",s),()=>window.removeEventListener("open-scroll-modal",s)},[]),t.useEffect(()=>{const s=()=>{const a=window.scrollY,r=a<L.current?"up":"down";if(L.current=a,window.innerHeight+window.scrollY>=document.body.offsetHeight&&(w.current=!0),w.current&&r==="up"&&!u.current){const o=parseInt(localStorage.getItem(R)||"0",10);if(Date.now()-o<z)return;g(!0),u.current=!0,w.current=!1}};return window.addEventListener("scroll",s),()=>window.removeEventListener("scroll",s)},[]);const f=()=>{N(!0),setTimeout(()=>{g(!1),N(!1),localStorage.setItem(R,Date.now().toString()),u.current=!1,b({nombre:"",email:"",telefono:""}),c({}),m("")},300)};return h?e.jsx("div",{className:"fixed inset-0 bg-black/30 z-50 flex items-center justify-center px-4 modal-overlay",children:e.jsxs("div",{ref:v,className:`flex flex-col sm:flex-row rounded-3xl shadow-xl w-[90vw] sm:w-full max-w-2xl max-h-[90vh] overflow-hidden bg-white relative ${D?"animate-slideOut":"animate-slideIn"}`,style:{border:"3px solid #e5e7eb"},children:[e.jsxs("div",{className:"w-full sm:w-1/2 relative",children:[e.jsx("div",{className:"w-full h-[250px] sm:h-auto sm:min-h-[400px] relative overflow-hidden sm:p-4",children:e.jsxs("div",{className:"w-full h-full relative clip-vase overflow-hidden flex items-center justify-center",children:[e.jsx("img",{src:$.src,alt:"Asesoría",className:"w-full h-full object-cover object-center"}),e.jsx("div",{className:"absolute inset-0 bg-black/10 sm:bg-transparent"})]})}),e.jsx("button",{onClick:f,"aria-label":"Cerrar modal",className:"absolute top-3 right-3 bg-white/90 hover:bg-white text-gray-600 rounded-full w-8 h-8 flex items-center justify-center transition-colors cursor-pointer text-sm z-10 shadow-sm sm:hidden",children:"✕"})]}),e.jsxs("div",{className:"w-full sm:w-1/2 p-6 relative flex flex-col justify-center",children:[e.jsx("button",{onClick:f,"aria-label":"Cerrar modal",className:"hidden sm:flex absolute top-3 right-3 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-full w-8 h-8 items-center justify-center transition-colors cursor-pointer text-sm z-10",children:"✕"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsxs("h2",{className:"text-xl sm:text-2xl md:text-3xl font-bold leading-tight font-montserrat text-center sm:text-left",style:{color:"#0E3F88"},children:["¡Un detalle que",e.jsx("br",{}),"cambia todo!"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{name:"nombre",type:"text",value:d.nombre,onChange:j,className:`w-[95%] px-4 py-3 rounded-xl bg-gray-100 text-gray-800 placeholder-gray-500 border-0 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:bg-gray-50 ${i.nombre?"ring-2 ring-red-400":""}`,placeholder:"Nombre"}),i.nombre&&e.jsx("p",{className:"text-red-500 text-sm mt-1 ml-1",children:i.nombre})]}),e.jsxs("div",{children:[e.jsx("input",{type:"tel",name:"telefono",value:d.telefono,onChange:j,className:`w-[95%] px-4 py-3 rounded-xl bg-gray-100 text-gray-800 placeholder-gray-500 border-0 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:bg-gray-50 ${i.telefono?"ring-2 ring-red-400":""}`,placeholder:"Teléfono",maxLength:9}),i.telefono&&e.jsx("p",{className:"text-red-500 text-sm mt-1 ml-1",children:i.telefono})]}),e.jsxs("div",{children:[e.jsx("input",{type:"email",name:"email",value:d.email,onChange:j,className:`w-[95%] px-4 py-3 rounded-xl bg-gray-100 text-gray-800 placeholder-gray-500 border-0 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:bg-gray-50 ${i.email?"ring-2 ring-red-400":""}`,placeholder:"Correo"}),i.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1 ml-1",children:i.email})]}),i.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-3",children:e.jsx("p",{className:"text-red-600 text-sm",children:i.general})}),A&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-3",children:e.jsx("p",{className:"text-green-600 text-sm",children:A})}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:k,disabled:S,className:"w-full max-w-[220px] bg-[#0E3F88] hover:bg-[#0b3674] text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed mt-4 sm:mt-6 font-montserrat",children:S?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Enviando..."]}):"Empieza a brillar"})})]})]})]})}):null};export{H as default};
