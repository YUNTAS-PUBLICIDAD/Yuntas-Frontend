import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{e as B,c as T}from"./index.C2rrZm7j.js";import{r}from"./index.ai7qpRr1.js";import{S as N}from"./sweetalert2.esm.all.B0Dix5B2.js";import{T as I}from"./TableContainer.BmMHsEjo.js";import"./iconBase.CsihB_xR.js";const j=({label:c,type:d="text",rows:o,name:a,value:u,placeholder:m,onChange:x,className:p,required:l=!1,disabled:b=!1,defaultValue:t})=>e.jsxs("div",{className:`flex flex-col w-full ${p}`,children:[c&&e.jsx("label",{htmlFor:a,className:"mb-1 font-semibold text-gray-700",children:c}),d==="textarea"?e.jsx("textarea",{id:a,name:a,value:u,placeholder:m,rows:o,required:l,disabled:b,defaultValue:t,className:"px-4 py-2 text-black border border-gray-300 rounded-lg shadow-sm focus:outline-none  focus:ring-2 focus:ring-[#6886e9] focus:border-[#6886e9] transition duration-200 disabled:bg-gray-100 disabled:cursor-not-allowed"}):e.jsx("input",{id:a,type:d,name:a,value:u,placeholder:m,onChange:x,required:l,disabled:b,defaultValue:t,className:`px-4 py-2 text-black border border-gray-300 rounded-lg shadow-sm focus:outline-none  focus:ring-2 focus:ring-[#6886e9] focus:border-[#6886e9] transition duration-200 disabled:bg-gray-100 disabled:cursor-not-allowed ${p}`})]}),A=({onClose:c,onUserAdded:d,initialData:o,isEditing:a})=>{const[u,m]=r.useState(o?.name||""),[x,p]=r.useState(o?.email||""),[l,b]=r.useState(o?.celular||""),[t,f]=r.useState(o?.roles?.join(", ")||""),[n,i]=r.useState(""),[h,w]=r.useState(""),[g,v]=r.useState(!1),[S,C]=r.useState(""),$=async s=>{if(s.preventDefault(),v(!0),C(""),!a&&n!==h){C("Las contraseñas no coinciden."),v(!1);return}const U=localStorage.getItem("token");try{const y={name:u,email:x,celular:l,roles:t.split(",").map(k=>k.trim()).filter(Boolean)};a?(y._method="PUT",n&&(y.password=n)):y.password=n;const E=await fetch(`https://apiyuntas.yuntaspublicidad.com/api/v1/users${a&&o?`/${o.id}`:""}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${U}`},body:JSON.stringify(y)});if(!E.ok){const k=await E.json();throw new Error(k.message||"Error al guardar usuario")}d(),c()}catch(y){C(y.message)}finally{v(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-[#1e293b]/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-2xl font-bold",onClick:c,children:"×"}),e.jsx("h3",{className:"text-2xl font-bold mb-6 text-blue-900 border-b-2 border-blue-700 pb-2 w-fit",children:a?"Editar Usuario":"Ingresar Usuario"}),e.jsxs("form",{onSubmit:$,className:"grid max-sm:grid-cols-1 grid-cols-2 gap-5",children:[e.jsx(j,{label:"Nombre",name:"name",value:u,onChange:s=>m(s.target.value),required:!0,className:""}),e.jsx(j,{label:"Email",name:"email",value:x,onChange:s=>p(s.target.value),required:!0,type:"email",className:""}),e.jsx(j,{label:"Celular",name:"celular",value:l,onChange:s=>b(s.target.value),className:""}),e.jsx(j,{label:"Roles (separados por coma)",name:"roles",value:t,onChange:s=>f(s.target.value),required:!0,className:""}),e.jsx(j,{label:"Contraseña",name:"password",value:n,onChange:s=>i(s.target.value),type:"password",className:"",required:!a}),e.jsx(j,{label:"Confirmar contraseña",name:"confirmPassword",value:h,onChange:s=>w(s.target.value),type:"password",className:"",required:!a}),S&&e.jsx("div",{className:"col-span-2 text-red-600 text-sm",children:S}),e.jsxs("div",{className:"col-span-2 flex justify-end gap-3 mt-4",children:[e.jsx("button",{type:"button",className:"px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300 transition",onClick:c,disabled:g,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-lg font-semibold bg-blue-600 text-white hover:bg-blue-700 transition",disabled:g,children:g?a?"Guardando...":"Agregando...":a?"Guardar cambios":"Agregar usuario"})]})]})]})})};function G(){const[c,d]=r.useState(!0),[o,a]=r.useState([]),[u,m]=r.useState(!1),[x,p]=r.useState(null),l=async()=>{d(!0);try{const t=localStorage.getItem("token"),n=await(await fetch("https://apiyuntas.yuntaspublicidad.com/api/v1/users",{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${t}`}})).json();a(n.data||[])}catch(t){console.error("Error al obtener usuarios:",t),N.fire({icon:"error",title:"Error",text:"Hubo un error al cargar los usuarios",confirmButtonColor:"#14b8a6"})}finally{d(!1)}},b=async t=>{const f=localStorage.getItem("token");if((await N.fire({title:"¿Estás seguro?",text:"Esta acción eliminará el usuario permanentemente.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const i=await fetch(`https://apiyuntas.yuntaspublicidad.com/api/v1/users/${t}`,{method:"DELETE",headers:{Accept:"application/json",Authorization:`Bearer ${f}`}});if(!i.ok){const h=await i.json();throw new Error(h.message||"Error al eliminar usuario")}await l(),N.fire("Eliminado","El usuario ha sido eliminado.","success")}catch(i){N.fire("Error",i.message,"error")}};return r.useEffect(()=>{l()},[]),e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Usuarios"}),e.jsxs(I,{tableType:"usuarios",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 bg-cyan-400 dark:bg-cyan-600 text-white uppercase text-xs font-bold rounded-md",children:"ID"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 dark:bg-cyan-600 text-white uppercase text-xs font-bold rounded-md",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 dark:bg-cyan-600 text-white uppercase text-xs font-bold rounded-md",children:"Email"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 dark:bg-cyan-600 text-white uppercase text-xs font-bold rounded-md",children:"Acción"})]})}),e.jsx("tbody",{children:c?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-2",children:e.jsxs("div",{className:"flex justify-center items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-teal-500"}),e.jsx("span",{className:"text-teal-500 font-medium",children:"Cargando usuarios..."})]})})}):o.length>0?o.map((t,f)=>{const n=f%2===0,i=n?"bg-gray-100":"bg-gray-200",h=n?"dark:bg-gray-800":"dark:bg-gray-700",w="text-gray-900 dark:text-gray-100",g=`px-4 py-2 rounded-md font-bold ${i} ${h} ${w}`;return e.jsxs("tr",{children:[e.jsx("td",{className:g,children:t.id}),e.jsx("td",{className:g,children:t.name}),e.jsx("td",{className:g,children:t.email}),e.jsx("td",{className:`px-4 py-2 rounded-md ${i} ${h} ${w}`,children:e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{className:"text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300 transition cursor-pointer",title:"Editar",onClick:()=>p(t),children:e.jsx(B,{size:18})}),e.jsx("button",{className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 transition cursor-pointer",title:"Eliminar",onClick:()=>b(t.id),children:e.jsx(T,{size:18})})]})})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-12",children:e.jsx("span",{className:"text-gray-500",children:"No hay usuarios registrados"})})})})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-xl font-semibold hover:bg-blue-700 transition",onClick:()=>m(!0),children:"Agregar usuario"})}),u&&e.jsx(A,{onClose:()=>m(!1),onUserAdded:l}),x&&e.jsx(A,{onClose:()=>p(null),onUserAdded:l,initialData:x,isEditing:!0})]})}export{G as default};
