import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.ai7qpRr1.js";import{c as Q,d as X}from"./index.C2rrZm7j.js";import{g as T,c as A}from"./config.CT_CG-Xn.js";import{S as F}from"./sweetalert2.esm.all.B0Dix5B2.js";import{T as Y}from"./TableContainer.b9hjZr1F.js";import"./iconBase.CsihB_xR.js";const Z=({isOpen:b,setIsOpen:v,blogToEdit:l,onSuccess:z})=>{const[m,_]=i.useState([]),[f,L]=i.useState(!1),[$,w]=i.useState(!1),[x,y]=i.useState(null),[g,j]=i.useState(null),[N,h]=i.useState(""),[I,k]=i.useState(!1),[S,C]=i.useState(""),s={producto_id:"",titulo:"",subtitulo:"",link:"",meta_titulo:"",meta_descripcion:"",imagen_principal:null,alt_imagen_principal:"",imagen_card:null,alt_imagen_card:"",imagenes_secundarias:[null,null,null],alt_imagenes_secundarias:["","",""],parrafos:["","",""]},[a,c]=i.useState(s);i.useEffect(()=>{b&&c(l?{producto_id:l.producto_id?.toString()||"",titulo:l.titulo||"",subtitulo:l.subtitulo||"",link:l.link||"",meta_titulo:l.meta_titulo||"",meta_descripcion:l.meta_descripcion||"",imagen_principal:null,alt_imagen_principal:l.alt_imagen_principal||"",imagen_card:null,alt_imagen_card:l.alt_imagen_card||"",imagenes_secundarias:[null,null,null],alt_imagenes_secundarias:[l.imagenes?.[0]?.text_alt||"",l.imagenes?.[1]?.text_alt||"",l.imagenes?.[2]?.text_alt||""],parrafos:[l.parrafos?.[0]?.parrafo||"",l.parrafos?.[1]?.parrafo||"",l.parrafos?.[2]?.parrafo||""]}:{producto_id:"",titulo:"",subtitulo:"",link:"",meta_titulo:"",meta_descripcion:"",imagen_principal:null,alt_imagen_principal:"",imagen_card:null,alt_imagen_card:"",imagenes_secundarias:[null,null,null],alt_imagenes_secundarias:["","",""],parrafos:["","",""]})},[b,l]),i.useEffect(()=>{(async()=>{if(b){L(!0);try{const r=localStorage.getItem("token"),n=await fetch(T(A.endpoints.productos.list),{method:"GET",headers:{Authorization:`Bearer ${r}`,Accept:"application/json","Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const o=await n.json();console.log("Respuesta de productos/select:",o),o.success&&Array.isArray(o.data)?_(o.data):Array.isArray(o)?_(o):(console.error("La respuesta no contiene un array de productos:",o),_([]))}catch(r){console.error("Error al obtener productos:",r),_([]),alert("‚ùå Error al cargar los productos. Por favor, intenta de nuevo.")}finally{L(!1)}}})()},[b]);const p=t=>{c({...a,[t.target.name]:t.target.value})},P=t=>{c({...a,[t.target.name]:t.target.value})},B=(t,r)=>{t.target.files?.[0]&&c({...a,[r]:t.target.files[0]})},R=(t,r)=>{const n=[...a.imagenes_secundarias];n[r]=t.target.files?.[0]||null,c({...a,imagenes_secundarias:n})},q=(t,r)=>{const n=[...a.alt_imagenes_secundarias];n[r]=t.target.value,c({...a,alt_imagenes_secundarias:n})},H=(t,r)=>{const n=[...a.parrafos];n[r]=t.target.value,c({...a,parrafos:n})},W=t=>{const r=document.getElementById(`parrafo-${t}`);if(!r)return;const n=r.selectionStart,o=r.selectionEnd;if(n===o){F.fire("Selecciona texto","Por favor selecciona una palabra o frase antes de insertar el enlace.","warning");return}const d=r.value.substring(n,o);y(t),j({start:n,end:o}),h(d),w(!0)},G=()=>{if(x===null||g===null||!S.trim()){alert("‚ùå Faltan datos para insertar el enlace");return}const t=a.parrafos[x],r=`<a href="${S}" target="_blank" rel="noopener noreferrer">${N}</a>`,n=t.slice(0,g.start)+r+t.slice(g.end),o=[...a.parrafos];o[x]=n,c({...a,parrafos:o}),y(null),j(null),h(""),C(""),w(!1)},V=t=>{const r=document.getElementById(`parrafo-${t}`);if(!r)return;const n=r.selectionStart,o=r.selectionEnd,d=r.value.substring(n,o);if(!d){F.fire("Selecciona texto","Por favor selecciona una palabra o frase para enlazar a un producto.","warning");return}y(t),j({start:n,end:o}),h(d),k(!0)},J=t=>{if(x===null||g===null)return;const r=a.parrafos[x],n=t.link,o=`<a href="/products/producto/?link=${encodeURIComponent(n)}">${N}</a>`,d=r.slice(0,g.start)+o+r.slice(g.end),E=[...a.parrafos];E[x]=d,c({...a,parrafos:E}),y(null),j(null),h(""),k(!1)},O=()=>{v(!1),y(null),j(null),h(""),w(!1),k(!1),C("")},K=async t=>{t.preventDefault();const r=!!l;if(!a.titulo||!a.subtitulo)return alert("‚ö†Ô∏è T√≠tulo y subt√≠tulo son obligatorios.");if(!r&&!a.imagen_principal)return alert("‚ö†Ô∏è La imagen principal es obligatoria para crear.");if(a.parrafos.some(o=>!o.trim()))return alert("‚ö†Ô∏è Todos los p√°rrafos deben estar completos.");const n=/^[a-z0-9]+(?:-[a-z0-9]+)*$/;if(a.link&&!n.test(a.link))return alert("‚ö†Ô∏è El link debe ser URL-friendly (solo min√∫sculas, guiones y n√∫meros).");try{const o=localStorage.getItem("token"),d=new FormData;r&&d.append("_method","PUT");for(const u in a){if(u==="imagenes_secundarias"||u==="alt_imagenes_secundarias"||u==="parrafos")continue;const M=a[u];M instanceof File?d.append(u,M):d.append(u,M??"")}a.imagenes_secundarias.forEach(u=>{u&&d.append("imagenes[]",u)}),a.alt_imagenes_secundarias.forEach(u=>{d.append("alt_imagenes[]",u)}),a.parrafos.forEach(u=>d.append("parrafos[]",u));const E=r?T(A.endpoints.blogs.update(l.id)):T(A.endpoints.blogs.create);console.log("üëâ Endpoint blogs:",E);const D=await fetch(E,{method:r?"PUT":"POST",body:d,headers:{Authorization:`Bearer ${o}`,Accept:"application/json"}}),U=D.headers.get("content-type")?.includes("json")?await D.json():await D.text();D.ok?(alert(`‚úÖ Blog ${r?"actualizado":"creado"} correctamente.`),O(),z?.()):alert(`‚ùå Error: ${U.message||U}`)}catch(o){console.error(o),alert("‚ùå Error en la solicitud.")}};return b?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"bg-white text-black px-8 py-6 rounded-lg max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:l?"Editar Blog":"A√±adir Blog"}),e.jsxs("form",{onSubmit:K,encType:"multipart/form-data",className:"space-y-8 max-w-3xl mx-auto",children:[e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"Informaci√≥n Principal & SEO"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"block mb-2",children:"Selecciona un Producto"}),e.jsxs("select",{name:"producto_id",value:a.producto_id,onChange:P,required:!0,className:"w-full bg-white text-black p-2 rounded-md",disabled:f,children:[e.jsx("option",{value:"",children:f?"Cargando productos...":"-- Selecciona un producto --"}),Array.isArray(m)&&m.length>0?m.map(t=>e.jsx("option",{value:t.id,children:t.nombre||`Producto ${t.id}`},t.id)):!f&&e.jsx("option",{value:"",disabled:!0,children:"No hay productos disponibles"})]}),m.length>0&&e.jsxs("p",{className:"text-xs text-green-400 mt-1",children:["‚úÖ ",m.length," productos cargados"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block font-medium mb-1",children:"T√≠tulo"}),e.jsx("input",{type:"text",name:"titulo",value:a.titulo,onChange:p,className:"w-full border border-gray-300 rounded px-3 py-2",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block font-medium mb-1",children:"Subt√≠tulo"}),e.jsx("input",{name:"subtitulo",value:a.subtitulo,onChange:p,className:"w-full border border-gray-300 rounded px-3 py-2",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block font-medium mb-1",children:"Meta T√≠tulo (SEO)"}),e.jsx("input",{type:"text",name:"meta_titulo",value:a.meta_titulo,onChange:p,placeholder:"T√≠tulo optimizado para SEO",className:"w-full border border-gray-300 rounded px-3 py-2"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Recomendado: 50-60 caracteres"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block font-medium mb-1",children:"Meta Descripci√≥n (SEO)"}),e.jsx("textarea",{name:"meta_descripcion",value:a.meta_descripcion,onChange:p,placeholder:"Descripci√≥n optimizada para motores de b√∫squeda",className:"w-full border border-gray-300 rounded px-3 py-2",rows:3}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Recomendado: 150-160 caracteres"})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"block font-medium mb-1",children:"Link (URL amigable)"}),e.jsx("input",{type:"text",name:"link",value:a.link,onChange:p,placeholder:"ejemplo: mi-blog-post",className:"w-full border border-gray-300 rounded px-3 py-2"})]})]})]}),e.jsxs("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-4",children:"Im√°genes"}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Imagen Principal"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>B(t,"imagen_principal"),className:"w-full file:py-2 file:px-3 file:border-0 file:bg-green-100 file:text-green-700 hover:file:bg-green-200"}),e.jsx("input",{type:"text",name:"alt_imagen_principal",placeholder:"Texto ALT para SEO",value:a.alt_imagen_principal,onChange:p,className:"mt-2 w-full border border-gray-300 rounded px-3 py-2"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-medium mb-1",children:"Imagen Card"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>B(t,"imagen_card"),className:"w-full file:py-2 file:px-3 file:border-0 file:bg-green-100 file:text-green-700 hover:file:bg-green-200"}),e.jsx("input",{type:"text",name:"alt_imagen_card",placeholder:"Texto ALT para SEO",value:a.alt_imagen_card,onChange:p,className:"mt-2 w-full border border-gray-300 rounded px-3 py-2"})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsx("label",{className:"block font-semibold",children:"Im√°genes Secundarias"}),a.imagenes_secundarias.map((t,r)=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:n=>R(n,r),className:"w-full file:py-2 file:px-3 file:border-0 file:bg-green-100 file:text-green-700 hover:file:bg-green-200"}),e.jsx("input",{type:"text",placeholder:`Texto ALT imagen secundaria #${r+1}`,value:a.alt_imagenes_secundarias[r],onChange:n=>q(n,r),className:"w-full border border-gray-300 rounded px-3 py-2"})]},r))]})]}),e.jsxs("div",{className:"bg-yellow-50 p-6 rounded-lg border border-yellow-200 relative",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-800 mb-4",children:"P√°rrafos"}),a.parrafos.map((t,r)=>e.jsxs("div",{className:"relative mb-6",children:[e.jsx("textarea",{id:`parrafo-${r}`,value:t,onChange:n=>H(n,r),className:"w-full border border-gray-300 rounded px-3 py-2 pr-20",rows:4,placeholder:`P√°rrafo ${r+1}`,required:!0}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>W(r),title:"Insertar enlace manual",className:"bg-blue-500 hover:bg-blue-700 text-white p-2 rounded-full shadow-lg transition-all duration-200",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),e.jsx("button",{type:"button",onClick:()=>V(r),title:"Enlazar a producto",className:"bg-green-500 hover:bg-green-700 text-white p-2 rounded-full shadow-lg transition-all duration-200",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})})]})]},r))]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:O,className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:f,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded",children:l?"Actualizar":"Crear"})]})]}),$&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-[60]",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Insertar Enlace"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Texto seleccionado: ",e.jsxs("strong",{children:['"',N,'"']})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-medium mb-1",children:"URL del enlace"}),e.jsx("input",{type:"url",value:S,onChange:t=>C(t.target.value),placeholder:"https://ejemplo.com",className:"w-full border border-gray-300 rounded px-3 py-2",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>w(!1),className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:G,disabled:!S.trim(),className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-300 text-white px-4 py-2 rounded",children:"Insertar"})]})]})}),I&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-[60]",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Enlazar a Producto"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Texto seleccionado: ",e.jsxs("strong",{children:['"',N,'"']})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block font-medium mb-1",children:"Selecciona un producto"}),e.jsxs("select",{onChange:t=>{const r=parseInt(t.target.value),n=m.find(o=>o.id===r);n&&J(n)},className:"w-full border border-gray-300 rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"-- Seleccionar producto --"}),m.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>k(!1),className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",children:"Cancelar"})})]})})]})}):null},ce=()=>{const[b,v]=i.useState([]),[l,z]=i.useState(1),m=10,[_,f]=i.useState(null),[L,$]=i.useState(!0),[w,x]=i.useState(!1),y=async()=>{$(!0);try{const s=localStorage.getItem("token"),a=await fetch(T(A.endpoints.blogs.list),{headers:{Authorization:`Bearer ${s}`,Accept:"application/json"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const c=await a.json();console.log("Datos recibidos:",c),c.success&&c.data?v(c.data):(console.error("Formato de respuesta inesperado:",c),v([]))}catch(s){console.error("‚ùå Error al cargar datos:",s),v([])}finally{$(!1)}};i.useEffect(()=>{y()},[]);const g=l*m,j=g-m,N=b.slice(j,g),h=s=>{z(s)},I=Math.ceil(b.length/m),k=async s=>{const a=localStorage.getItem("token");if(window.confirm("¬øEst√°s seguro de que deseas eliminar este blog?"))try{const p=await fetch(T(A.endpoints.blogs.delete(s)),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(p.ok)v(P=>P.filter(B=>B.id!==s)),alert("‚úÖ Blog eliminado exitosamente");else{const P=await p.json().catch(()=>({}));alert(`‚ùå Error al eliminar el blog: ${P.message||"Error desconocido"}`)}}catch(p){console.error("Error al eliminar:",p),alert("‚ùå Error al conectar con el servidor")}},S=s=>s?s.startsWith("http")?s:`https://apiyuntas.yuntaspublicidad.com${s}`:"/placeholder-image.jpg",C=(s,a=50)=>s?s.length>a?s.substring(0,a)+"...":s:"";return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"overflow-x-auto p-4",children:[e.jsxs(Y,{tableType:"blogs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-950 text-white",children:[e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:"ID"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:"PRODUCTO"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:"SUBT√çTULO"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:"IMAGEN"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:"FECHA"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:"ACCI√ìN"})]})}),e.jsx("tbody",{children:L?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-4 text-gray-500",children:"Cargando blogs..."})}):N.length>0?N.map(s=>e.jsxs("tr",{className:`text-center ${s.id%2===0?"bg-gray-100":"bg-gray-300"}`,children:[e.jsx("td",{className:"px-4 py-2 font-bold rounded-xl border border-gray-300",children:s.id}),e.jsx("td",{className:"px-4 py-2 font-bold rounded-xl border border-gray-300",children:C(s.nombre_producto||"Sin nombre",30)}),e.jsx("td",{className:"px-4 py-2 rounded-xl border border-gray-300",children:C(s.subtitulo,40)}),e.jsx("td",{className:"px-4 py-2 rounded-xl border border-gray-300",children:e.jsx("img",{src:S(s.imagen_principal),alt:s.nombre_producto||"Blog",className:"w-16 h-16 rounded-md mx-auto object-cover",onError:a=>{const c=a.target;c.src="/placeholder-image.jpg"}})}),e.jsx("td",{className:"px-4 py-2 rounded-xl border border-gray-300 text-sm",children:s.created_at?new Date(s.created_at).toLocaleDateString("es-ES"):"N/A"}),e.jsx("td",{className:"px-4 py-2 rounded-xl border border-gray-300",children:e.jsxs("div",{className:"flex justify-center gap-2 rounded-xl p-1",children:[e.jsx("button",{className:"p-2 text-red-600 hover:text-red-800 transition",title:"Eliminar",onClick:()=>k(s.id),children:e.jsx(Q,{size:18})}),e.jsx("button",{className:"p-2 text-yellow-600 hover:text-yellow-800 transition",title:"Editar",onClick:()=>{console.log("Blog a editar:",s),f(s),x(!0)},children:e.jsx(X,{size:18})})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-4 text-gray-500",children:"No hay blogs disponibles"})})})]}),I>1&&e.jsxs("div",{className:"flex justify-center items-center mt-4 gap-2",children:[e.jsx("button",{onClick:()=>h(l-1),disabled:l===1,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,I)},(s,a)=>{const c=a+1;return e.jsx("button",{onClick:()=>h(c),className:`px-3 py-2 rounded-md ${l===c?"bg-blue-950 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:c},c)})}),e.jsx("button",{onClick:()=>h(l+1),disabled:l===I,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"})]}),e.jsx("button",{onClick:()=>{f(null),x(!0)},className:"mt-4 mb-6 bg-blue-950 hover:bg-blue-800 text-white text-lg px-10 py-2 rounded-full",children:"A√±adir Blog"}),e.jsx(Z,{isOpen:w,setIsOpen:x,blogToEdit:_,onSuccess:()=>{f(null),x(!1),y()}})]})})};export{ce as default};
