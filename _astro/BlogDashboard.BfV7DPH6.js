import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.Be8AcK8B.js";import{h as m}from"./httpService.CT4lg0D-.js";import{c as x}from"./config.CelHcebK.js";import{A as v}from"./AddBlogModel.CSF82T8b.js";import"./sweetalert2.esm.all.Bj_ZQUAw.js";class B{async getAllBlogs(){let e=[],a=1,r=1,l=!0;for(;l;)try{const o=await m.get(`${x.endpoints.blogs.list}?page=${a}`);o.success&&o.data.data.length>0?(e=[...e,...o.data.data],r=o.data.last_page,a>=r?l=!1:a++):l=!1}catch(o){console.error(`Error obteniendo página ${a}:`,o),l=!1}return{success:!0,message:"Todos los blogs obtenidos exitosamente.",status:200,data:{data:e,current_page:1,last_page:1,per_page:e.length,total:e.length}}}async getBlogByLink(e){return await m.get(x.endpoints.blogs.link(e))}async createBlog(e){const a=this.buildFormData(e,"create");return await m.authenticatedPostFormData(x.endpoints.blogs.create,a)}async updateBlog(e,a){const r=this.buildFormData(a,"update");return r.append("_method","PATCH"),await m.authenticatedPostFormData(x.endpoints.blogs.update(e),r)}async deleteBlog(e){return await m.authenticatedDelete(x.endpoints.blogs.delete(e))}buildFormData(e,a){const r=new FormData;return r.append("producto_id",e.producto_id||""),r.append("link",e.link||""),r.append("subtitulo",e.titulo||""),e.parrafo&&r.append("parrafos[0]",e.parrafo),e.url_video&&r.append("url_video",e.url_video),e.imagen_principal instanceof File&&r.append("imagen_principal",e.imagen_principal),e.imagenes?.length&&e.imagenes.forEach((l,o)=>{l.url_imagen instanceof File&&(r.append(`imagenes[${o}]`,l.url_imagen),r.append(`alt_imagenes[${o}]`,l.parrafo_imagen||""))}),r}generateLinkFromTitle(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim()}}const h=new B;function E(){const[u,e]=d.useState([]),[a,r]=d.useState(!0),[l,o]=d.useState(null),p=async()=>{try{r(!0),o(null);const i=await h.getAllBlogs();e(i.data)}catch(i){o(i instanceof Error?i.message:"Error desconocido al obtener blogs"),console.error("Error en useBlogs:",i)}finally{r(!1)}},g=async()=>{await p()};return d.useEffect(()=>{p()},[]),{blogs:u,loading:a,error:l,refetch:g}}function _(){const[u,e]=d.useState(!1),[a,r]=d.useState(null);return{loading:u,error:a,createBlog:async i=>{try{return e(!0),r(null),(await h.createBlog(i)).data}catch(n){const c=n instanceof Error?n.message:"Error desconocido al crear el blog";return r(c),console.error("Error creando blog:",n),null}finally{e(!1)}},updateBlog:async(i,n)=>{try{return e(!0),r(null),(await h.updateBlog(i,n)).data}catch(c){const f=c instanceof Error?c.message:"Error desconocido al actualizar el blog";return r(f),console.error("Error actualizando blog:",c),null}finally{e(!1)}},deleteBlog:async i=>{try{return e(!0),r(null),await h.deleteBlog(i),!0}catch(n){const c=n instanceof Error?n.message:"Error desconocido al eliminar el blog";return r(c),console.error("Error eliminando blog:",n),!1}finally{e(!1)}},clearError:()=>r(null)}}const D=()=>{const{blogs:u,loading:e,error:a,refetch:r}=E(),{deleteBlog:l,loading:o}=_(),[p,g]=d.useState(!1),[i,n]=d.useState(null),[c,f]=d.useState(""),b=u.filter(s=>s.titulo.toLowerCase().includes(c.toLowerCase())||s.descripcion.toLowerCase().includes(c.toLowerCase())),y=s=>{n(s),g(!0)},w=async s=>{window.confirm("¿Estás seguro de que quieres eliminar este blog?")&&await l(s)&&r()},j=()=>{n(null),g(!0)},N=s=>new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"});return e?t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):a?t.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:["Error cargando blogs: ",a]}):t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Gestión de Blogs"}),t.jsx("button",{onClick:j,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Crear Nuevo Blog"})]}),t.jsx("div",{className:"mb-4",children:t.jsx("input",{type:"text",placeholder:"Buscar blogs...",value:c,onChange:s=>f(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),t.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:b.length===0?t.jsx("div",{className:"p-8 text-center text-gray-500",children:c?"No se encontraron blogs que coincidan con tu búsqueda.":"No hay blogs disponibles."}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Imagen"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Título"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(s=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("img",{src:s.imagenPrincipal,alt:s.titulo,className:"h-16 w-16 rounded-lg object-cover"})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.titulo}),t.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",s.id]})]}),t.jsx("td",{className:"px-6 py-4",children:t.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:s.descripcion})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:N(s.created_at)}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>y(s),className:"text-blue-600 hover:text-blue-900 bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded",children:"Editar"}),t.jsx("button",{onClick:()=>w(s.id),disabled:o,className:"text-red-600 hover:text-red-900 bg-red-100 hover:bg-red-200 px-3 py-1 rounded disabled:opacity-50",children:o?"Eliminando...":"Eliminar"}),t.jsx("a",{href:`/blogs/${s.id}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:text-green-900 bg-green-100 hover:bg-green-200 px-3 py-1 rounded",children:"Ver"})]})})]},s.id))})]})})}),t.jsx(v,{isOpen:p,setIsOpen:g,blogToEdit:i,onSuccess:()=>{r(),n(null)}})]})},M=()=>t.jsx("div",{children:t.jsx(D,{})});export{M as default};
