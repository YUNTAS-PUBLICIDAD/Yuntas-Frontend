import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.ai7qpRr1.js";import{g as M,c as R}from"./config.CT_CG-Xn.js";import{z as c,y as D}from"./yuleLove.CM7Koq5Z.js";const y="asesoriaModalLastClosed",O=1*60*1e3,k=c.object({nombre:c.string().min(1,"El nombre es obligatorio"),email:c.string().email("Correo inválido"),telefono:c.string().min(7,"El número de teléfono es demasiado corto").max(15,"El número de teléfono es demasiado largo").regex(/^\+?\d+$/,"El teléfono debe contener solo números (y opcionalmente +)")}),B=()=>{const[m,d]=s.useState(!1),[C,w]=s.useState(!1),[a,v]=s.useState({nombre:"",email:"",telefono:""}),[l,u]=s.useState({}),x=t=>{v({...a,[t.target.name]:t.target.value})},L=async t=>{t.preventDefault();const n=k.safeParse(a);if(!n.success){const o={};n.error.errors.forEach(i=>{const g=i.path[0];o[g]=i.message}),u(o);return}u({}),N(!0),f("");try{const o=new FormData;if(o.append("name",n.data.nombre),o.append("email",n.data.email),o.append("celular",n.data.telefono),!(await fetch(M(R.endpoints.clientes.create),{method:"POST",body:o})).ok)throw new Error("No se pudo enviar la información. Intenta nuevamente.");f("✅ Información enviada con éxito"),v({nombre:"",email:"",telefono:""}),setTimeout(()=>{b(),f("")},2e3)}catch(o){console.error("[ScrollModal] Error:",o),u({general:o.message||"Error desconocido."})}finally{N(!1)}},[j,N]=s.useState(!1),[E,f]=s.useState(""),S=s.useRef(0),h=s.useRef(!1),r=s.useRef(!1),p=s.useRef(null);s.useEffect(()=>{const t=n=>{p.current&&!p.current.contains(n.target)&&b()};return m&&document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[m]),s.useEffect(()=>{const t=()=>{d(!0),r.current=!0};return window.addEventListener("open-scroll-modal",t),()=>window.removeEventListener("open-scroll-modal",t)},[]),s.useEffect(()=>{const t=()=>{const n=window.scrollY,o=n<S.current?"up":"down";if(S.current=n,window.innerHeight+window.scrollY>=document.body.offsetHeight&&(h.current=!0),h.current&&o==="up"&&!r.current){const g=parseInt(localStorage.getItem(y)||"0",10);if(Date.now()-g<O)return;d(!0),r.current=!0,h.current=!1}};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[]);const b=()=>{w(!0),setTimeout(()=>{d(!1),w(!1),localStorage.setItem(y,Date.now().toString()),r.current=!1},300)};return m?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center px-4 modal-overlay",children:e.jsxs("div",{ref:p,className:`bg-white flex flex-col sm:flex-row overflow-hidden shadow-lg w-[90%] max-w-md sm:max-w-3xl relative ${C?"animate-slideOut":"animate-slideIn"}`,children:[e.jsx("div",{className:"hidden sm:block w-2/5 relative",children:e.jsx("img",{src:D.src,alt:"Asesoría",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"w-full sm:w-3/5 bg-[#1E2A78] text-white relative",children:e.jsxs("div",{className:"py-6 px-4 sm:py-10 mx-2 sm:mx-8 min-h-[420px]",children:[e.jsx("button",{onClick:b,"aria-label":"Cerrar modal",className:"absolute top-2 right-2 bg-white text-black rounded-full w-8 h-8 flex items-center justify-center hover:bg-gray-200 transition-colors cursor-pointer",children:"X"}),e.jsxs("div",{className:"text-white mb-6",children:[e.jsx("p",{className:"text-2xl italic",children:"Gana"}),e.jsxs("p",{className:"text-7xl font-bold ",children:["10",e.jsx("span",{className:"text-6xl font-semibold",children:"%"})," ",e.jsx("span",{className:"text-5xl font-semibold italic",children:"dto."})]}),e.jsx("p",{className:"text-2xl",children:"en tu compra"})]}),e.jsxs("form",{onSubmit:L,className:"flex flex-col gap-1",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold",children:"Nombre"}),e.jsx("input",{name:"nombre",type:"text",value:a.nombre,onChange:x,className:"py-2 px-4 rounded-full bg-white text-black outline-none mb-1"}),l.nombre&&e.jsx("p",{className:"text-red-500 text-sm",children:l.nombre}),e.jsx("h3",{className:"text-base sm:text-lg font-bold",children:"Teléfono"}),e.jsx("input",{type:"tel",name:"telefono",value:a.telefono,onChange:x,className:"py-2 px-4 rounded-full bg-white text-black outline-none mb-1"}),l.telefono&&e.jsx("p",{className:"text-red-500 text-sm",children:l.telefono}),e.jsx("h3",{className:"text-base sm:text-lg font-bold",children:"Correo"}),e.jsx("input",{type:"email",name:"email",value:a.email,onChange:x,className:"py-2 px-4 rounded-full bg-white text-black outline-none mb-1"}),l.email&&e.jsx("p",{className:"text-red-500 text-sm",children:l.email}),l.general&&e.jsx("p",{className:"text-red-500 text-sm",children:l.general}),E&&e.jsx("p",{className:"text-green-500 text-sm",children:E}),e.jsx("button",{type:"submit",disabled:j,className:"bg-blue-950 hover:bg-blue-700 text-white w-full sm:max-w-fit p-3 sm:p-4 text-xl sm:text-3xl font-bold rounded-xl mx-auto text-center border border-white/20 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed mt-4",children:j?"Enviando...":"Cotiza ahora"})]})]})})]})}):null};export{B as default};
