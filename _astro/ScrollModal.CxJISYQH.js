import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.Be8AcK8B.js";import{g as C,c as R}from"./config.gFP7Udml.js";import{o as O,s as v,y as D}from"./yuleLove.jBCH1_JG.js";const M="asesoriaModalLastClosed",T=10*1e3,k=O({nombre:v().min(1,"El nombre es obligatorio").max(100,"El nombre no puede exceder 100 caracteres").regex(/^[a-zA-ZáéíóúÁÉÍÓÚñÑüÜ\s]+$/,"El nombre solo puede contener letras y espacios"),email:v().min(1,"El email es obligatorio").email("El formato del correo electrónico es inválido").max(100,"El email no puede exceder 100 caracteres"),telefono:v().regex(/^[0-9]{9}$/,"El celular debe tener exactamente 9 dígitos").regex(/^[0-9]{9}$/,"El celular solo puede contener números")}),B=()=>{const[x,g]=a.useState(!1),[A,y]=a.useState(!1),[d,p]=a.useState({nombre:"",email:"",telefono:""}),[l,c]=a.useState({}),[j,E]=a.useState(!1),[N,m]=a.useState(""),S=a.useRef(0),h=a.useRef(!1),u=a.useRef(!1),b=a.useRef(null),w=n=>{const{name:o,value:s}=n.target;p({...d,[o]:s}),l[o]&&c(t=>({...t,[o]:""}))},L=async n=>{n.preventDefault(),c({}),m("");const o=k.safeParse(d);if(!o.success){const s={};o.error.errors.forEach(t=>{const r=t.path[0];s[r]=t.message}),c(s);return}E(!0);try{const s=new FormData;s.append("name",o.data.nombre),s.append("email",o.data.email),s.append("celular",o.data.telefono);const t=await fetch(C(R.endpoints.clientes.create),{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:s});if(t.type==="opaque"||t.url!==C(R.endpoints.clientes.create))throw new Error("Error de configuración del servidor. Por favor contacta al administrador.");let r;try{const i=await t.text();if(!i)throw new Error("Respuesta vacía del servidor");r=JSON.parse(i)}catch(i){throw console.error("[ScrollModal] Error parsing response:",i),console.error("[ScrollModal] Response status:",t.status),console.error("[ScrollModal] Response headers:",t.headers),new Error("Error al procesar la respuesta del servidor")}if(!t.ok){if(t.status===422&&r.errors){const i={};r.errors.name&&(i.nombre=Array.isArray(r.errors.name)?r.errors.name[0]:r.errors.name),r.errors.email&&(i.email=Array.isArray(r.errors.email)?r.errors.email[0]:r.errors.email),r.errors.celular&&(i.telefono=Array.isArray(r.errors.celular)?r.errors.celular[0]:r.errors.celular),c(i);return}throw new Error(r.message||`Error ${t.status}: ${t.statusText}`)}m("✅ Información enviada con éxito"),p({nombre:"",email:"",telefono:""}),setTimeout(()=>{f(),m("")},2e3)}catch(s){console.error("[ScrollModal] Error:",s),s.name==="TypeError"&&(s.message.includes("fetch")||s.message.includes("CORS"))?c({general:"Error de conexión con el servidor. Por favor intenta nuevamente."}):s.message.includes("configuración del servidor")?c({general:"Error de configuración del servidor. Contacta al administrador."}):c({general:s.message||"Error desconocido al enviar la información."})}finally{E(!1)}};a.useEffect(()=>{const n=o=>{b.current&&!b.current.contains(o.target)&&f()};return x&&document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[x]),a.useEffect(()=>{const n=()=>{g(!0),u.current=!0};return window.addEventListener("open-scroll-modal",n),()=>window.removeEventListener("open-scroll-modal",n)},[]),a.useEffect(()=>{const n=()=>{const o=window.scrollY,s=o<S.current?"up":"down";if(S.current=o,window.innerHeight+window.scrollY>=document.body.offsetHeight&&(h.current=!0),h.current&&s==="up"&&!u.current){const r=parseInt(localStorage.getItem(M)||"0",10);if(Date.now()-r<T)return;g(!0),u.current=!0,h.current=!1}};return window.addEventListener("scroll",n),()=>window.removeEventListener("scroll",n)},[]);const f=()=>{y(!0),setTimeout(()=>{g(!1),y(!1),localStorage.setItem(M,Date.now().toString()),u.current=!1,p({nombre:"",email:"",telefono:""}),c({}),m("")},300)};return x?e.jsx("div",{className:"fixed inset-0 bg-black/30 z-50 flex items-center justify-center px-4 modal-overlay",children:e.jsxs("div",{ref:b,className:`flex flex-col sm:flex-row rounded-3xl shadow-xl w-[90vw] sm:w-full max-w-2xl max-h-[90vh] overflow-hidden bg-white relative ${A?"animate-slideOut":"animate-slideIn"}`,style:{border:"3px solid #e5e7eb"},children:[e.jsxs("div",{className:"w-full sm:w-1/2 relative",children:[e.jsx("div",{className:"w-full h-[250px] sm:h-auto sm:min-h-[400px] relative overflow-hidden sm:p-4",children:e.jsxs("div",{className:"w-full h-full relative clip-vase overflow-hidden flex items-center justify-center",children:[e.jsx("img",{src:D.src,alt:"Asesoría",className:"w-full h-full object-cover object-center"}),e.jsx("div",{className:"absolute inset-0 bg-black/10 sm:bg-transparent"})]})}),e.jsx("button",{onClick:f,"aria-label":"Cerrar modal",className:"absolute top-3 right-3 bg-white/90 hover:bg-white text-gray-600 rounded-full w-8 h-8 flex items-center justify-center transition-colors cursor-pointer text-sm z-10 shadow-sm sm:hidden",children:"✕"})]}),e.jsxs("div",{className:"w-full sm:w-1/2 p-6 relative flex flex-col justify-center",children:[e.jsx("button",{onClick:f,"aria-label":"Cerrar modal",className:"hidden sm:flex absolute top-3 right-3 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-full w-8 h-8 items-center justify-center transition-colors cursor-pointer text-sm z-10",children:"✕"}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsxs("h2",{className:"text-xl sm:text-2xl md:text-3xl font-bold leading-tight font-montserrat text-center sm:text-left",style:{color:"#0E3F88"},children:["¡Un detalle que",e.jsx("br",{}),"cambia todo!"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{name:"nombre",type:"text",value:d.nombre,onChange:w,className:`w-[95%] px-4 py-3 rounded-xl bg-gray-100 text-gray-800 placeholder-gray-500 border-0 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:bg-gray-50 ${l.nombre?"ring-2 ring-red-400":""}`,placeholder:"Nombre"}),l.nombre&&e.jsx("p",{className:"text-red-500 text-sm mt-1 ml-1",children:l.nombre})]}),e.jsxs("div",{children:[e.jsx("input",{type:"tel",name:"telefono",value:d.telefono,onChange:w,className:`w-[95%] px-4 py-3 rounded-xl bg-gray-100 text-gray-800 placeholder-gray-500 border-0 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:bg-gray-50 ${l.telefono?"ring-2 ring-red-400":""}`,placeholder:"Teléfono",maxLength:9}),l.telefono&&e.jsx("p",{className:"text-red-500 text-sm mt-1 ml-1",children:l.telefono})]}),e.jsxs("div",{children:[e.jsx("input",{type:"email",name:"email",value:d.email,onChange:w,className:`w-[95%] px-4 py-3 rounded-xl bg-gray-100 text-gray-800 placeholder-gray-500 border-0 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:bg-gray-50 ${l.email?"ring-2 ring-red-400":""}`,placeholder:"Correo"}),l.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1 ml-1",children:l.email})]}),l.general&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-3",children:e.jsx("p",{className:"text-red-600 text-sm",children:l.general})}),N&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-3",children:e.jsx("p",{className:"text-green-600 text-sm",children:N})}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:L,disabled:j,className:"w-full max-w-[220px] bg-[#0E3F88] hover:bg-[#0b3674] text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed mt-4 sm:mt-6 font-montserrat",children:j?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Enviando..."]}):"Empieza a brillar"})})]})]})]})}):null};export{B as default};
