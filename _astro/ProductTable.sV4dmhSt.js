import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{i as X,j as J,c as Q,d as Y,k as Z}from"./index.GK1F2SJ7.js";import{r as b}from"./index.Be8AcK8B.js";import{S as P}from"./sweetalert2.esm.all.Bj_ZQUAw.js";import{g as T,c as S}from"./config.Cj4SBZka.js";import{T as ee}from"./TableContainer.C49vMdQY.js";import{h as $}from"./httpService.CS6HwzNl.js";import{u as re}from"./useDarkMode.C4HGFL6C.js";import"./iconBase.Db4UJpFa.js";const D=({children:l,isOpen:d,onClose:r,title:m})=>d?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 overflow-y-auto",children:e.jsxs("div",{className:"relative bg-white dark:bg-gray-900 px-5 py-6 rounded-xl max-w-4xl w-full mx-4 my-10 shadow-lg",children:[m&&e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800 dark:text-white",children:m}),e.jsx("button",{onClick:r,className:"absolute top-4 right-5 text-gray-500 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white text-xl","aria-label":"Cerrar",children:"✕"}),e.jsx("div",{className:"overflow-y-auto max-h-[75vh] pr-2",children:l})]})}):null,O=l=>{const d=l.target.files?.[0];d&&d.size>2*1024*1024&&(P.fire({icon:"warning",title:"¡Imagen muy grande!",text:"Máx. 2 MB."}),l.target.value="")},te=({initialData:l,onSubmit:d,isEditing:r})=>{b.useEffect(()=>{if(l){console.log("Inicializando especificaciones y beneficios desde specs:",l.especificaciones);const i=l.especificaciones?Object.entries(l.especificaciones).filter(([o])=>o.startsWith("spec_")).map(([,o])=>String(o).trim()):[];y(i.length>0?i:[""]);const a=l.especificaciones?Object.entries(l.especificaciones).filter(([o])=>o.startsWith("beneficio_")).map(([,o])=>String(o).trim()):[];E(a.length>0?a:[""])}},[l]);const[m,k]=b.useState(l?.imagenes||[]),[f,C]=b.useState([]),[h,y]=b.useState((()=>{if(!l?.especificaciones)return[""];const i=Object.entries(l.especificaciones).filter(([a])=>a.startsWith("spec_")).map(([,a])=>String(a));return i.length>0?i:[""]})()),[x,E]=b.useState((()=>{if(!l?.especificaciones)return[""];const i=Object.entries(l.especificaciones).filter(([a])=>a.startsWith("beneficio_")).map(([,a])=>String(a));return i.length>0?i:[""]})()),[_,v]=b.useState(l?.etiqueta?.keywords||[""]),N=(i,a)=>{const o=[..._];o[i]=a,v(o)},g=()=>{_[_.length-1].trim()&&v([..._,""])},I=i=>{_.length>1&&v(_.filter((a,o)=>o!==i))},t=i=>{k(m.filter(a=>a.id!==i)),C([...f,i])},s=(i,a)=>{const o=[...h];o[i]=a,y(o)},n=()=>{h[h.length-1].trim()&&y([...h,""])},c=i=>{h.length>1&&y(h.filter((a,o)=>o!==i))},p=(i,a)=>{const o=[...x];o[i]=a,E(o)},w=()=>{x[x.length-1].trim()&&E([...x,""])},j=i=>{x.length>1&&E(x.filter((a,o)=>o!==i))},U=async i=>{i.preventDefault();const a=new FormData(i.currentTarget),o=new FormData;o.append("nombre",a.get("nombre")),o.append("link",a.get("link")),o.append("titulo",a.get("titulo_hero")),o.append("stock",a.get("stock"));const H=a.get("precio").replace("$","").trim();o.append("precio",H),o.append("subtitulo",a.get("nombre")),o.append("descripcion",a.get("descripcion_informacion")),o.append("seccion",a.get("seccion"));const q=a.get("imagen_lista_productos");q&&q.size>0&&o.append("imagen_principal",q);const B={};h.forEach((u,A)=>{u.trim()&&(B[`spec_${A+1}`]=u.trim())}),x.forEach((u,A)=>{u.trim()&&(B[`beneficio_${A+1}`]=u.trim())}),Object.keys(B).length>0&&Object.entries(B).forEach(([u,A])=>{o.append(`especificaciones[${u}]`,A)});const K=[{key:"imagen_hero",file:a.get("imagen_hero"),index:0},{key:"imagen_especificaciones",file:a.get("imagen_especificaciones"),index:1},{key:"imagen_beneficios",file:a.get("imagen_beneficios"),index:2},{key:"imagen_popups",file:a.get("imagen_popups"),index:3}];console.log("=== DEBUGGING IMÁGENES FRONTEND ===");let F=0;K.forEach(u=>{console.log(`Revisando imagen ${u.index} (${u.key}):`,{hasFile:u.file instanceof File,fileName:u.file?.name||"N/A",fileSize:u.file?.size||0,fileType:u.file?.type||"N/A"}),u.file&&u.file instanceof File&&u.file.size>0?(console.log(`✅ Agregando imagen ${u.index}:`,u.key,u.file.name,`(${u.file.size} bytes)`),o.append(`imagenes[${u.index}]`,u.file),o.append(`imagen_tipos[${u.index}]`,u.key),F++):console.log(`❌ Imagen ${u.index} (${u.key}) no tiene archivo válido o está vacía`);const A=a.get("meta_título"),G=a.get("meta_descripcion");o.append("etiqueta[meta_titulo]",A.trim()),o.append("etiqueta[meta_descripcion]",G.trim());const V=_.filter(L=>L.trim()!=="");V.length>0&&V.forEach((L,W)=>{o.append(`etiqueta[keywords][${W}]`,L.trim())})}),console.log(`Total de imágenes enviadas: ${F}`),f.length>0&&f.forEach((u,A)=>{o.append(`imagenes_eliminar[${A}]`,u)});const z=a.get("meta_título"),R=a.get("meta_descripcion");(z.trim()||R.trim())&&(o.append("etiqueta[meta_titulo]",z.trim()),o.append("etiqueta[meta_descripcion]",R.trim())),console.log("=== DATOS ENVIADOS AL BACKEND ==="),o.forEach((u,A)=>{u instanceof File?console.log(`Campo: ${A}, Archivo: ${u.name} (${u.size} bytes)`):console.log(`Campo: ${A}, Valor: ${u}`)}),r&&o.append("_method","PUT"),await d(o)};return e.jsxs("form",{id:"product-form",onSubmit:U,className:"space-y-8 max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4 flex items-center",children:"Datos para Dashboard (Gestión Interna)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Nombre del Producto"," ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(Aparece en tabla)"})]}),e.jsx("input",{name:"nombre",defaultValue:l?.nombre||l?.titulo,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Máx. 255 caracteres (letras, números y espacios)."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Sección/Categoría"," ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(Aparece en tabla)"})]}),e.jsx("input",{name:"seccion",defaultValue:l?.seccion,placeholder:"ej: Letreros LED, Sillas LED, Pisos LED, etc.",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Máx. 255 caracteres (letras, números y espacios)."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Precio"," ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(Aparece en tabla)"})]}),e.jsx("input",{name:"precio",defaultValue:l?.precio?`$${l.precio}`:l?.precio,placeholder:"ej: $500.00",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Coloca el precio en números (máx. 100 000)."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Link/URL"," ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(ej: letreros-neon-led)"})]}),e.jsx("input",{name:"link",defaultValue:l?.link||(l?.titulo?l.titulo.toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]/g,""):""),placeholder:"letreros-neon-led",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Solo minúsculas y guiones. Hasta 255 letras, números o espacios."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Meta Título ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(SEO)"})]}),e.jsx("input",{name:"meta_título",defaultValue:l?.etiqueta?.meta_titulo||"",placeholder:"Título para SEO del producto",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Máx. 70 caracteres (letras, números y espacios)."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Meta Descripción"," ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(SEO)"})]}),e.jsx("textarea",{name:"meta_descripcion",defaultValue:l?.etiqueta?.meta_descripcion||"",rows:3,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Descripción breve del producto para SEO..."}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Máx. 160 caracteres (letras, números y espacios)."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Keywords ",e.jsx("span",{className:"text-blue-600 text-sm",children:"(SEO)"})]}),e.jsx("div",{className:"space-y-2",children:_.map((i,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:i,onChange:o=>N(a,o.target.value),placeholder:"ej: letreros para negocio",className:"flex-1 mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),_.length>1&&e.jsx("button",{type:"button",onClick:()=>I(a),className:"text-red-500 hover:text-red-700 font-bold text-lg",children:"✕"})]},a))}),e.jsx("button",{type:"button",onClick:g,className:"mt-2 text-blue-600 hover:text-blue-800 text-sm font-medium cursor-pointer",children:"+ Agregar keyword"}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Palabras clave relevantes para que los buscadores encuentren el producto."})]})]})]}),e.jsxs("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-4 flex items-center",children:"Datos para Página de Producto (Frontend)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Título Hero"," ",e.jsx("span",{className:"text-green-600 text-sm",children:"(Aparece sobre la imagen principal)"})]}),e.jsx("input",{name:"titulo_hero",defaultValue:l?.titulo,placeholder:"ej: Letreros Neón LED",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-green-500 focus:border-green-500",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Máx. 255 caracteres (letras, números y espacios)."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Descripción"," ",e.jsx("span",{className:"text-green-600 text-sm",children:'(Sección "Información")'})]}),e.jsx("textarea",{rows:4,name:"descripcion_informacion",defaultValue:l?.descripcion,placeholder:"Describe el producto, sus usos y características principales...",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-green-500 focus:border-green-500",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Descripción detallada. 300-600 palabras."})]})]})]}),e.jsxs("div",{className:"bg-purple-50 p-6 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-4 flex items-center",children:"Especificaciones (Checkmarks en el producto)"}),e.jsxs("div",{className:"space-y-3",children:[h.map((i,a)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:i,onChange:o=>s(a,o.target.value),placeholder:"ej: Materiales duraderos",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-purple-500 focus:border-purple-500"}),h.length>1&&e.jsx("button",{type:"button",onClick:()=>c(a),className:"text-red-500 hover:text-red-700 px-2 py-1",children:"✕"})]},a)),e.jsx("button",{type:"button",onClick:n,className:"text-purple-600 hover:text-purple-800 text-sm font-medium",children:"+ Agregar especificación"})]})]}),e.jsxs("div",{className:"bg-orange-50 p-6 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-800 mb-4 flex items-center",children:"Beneficios (Lista en el producto)"}),e.jsxs("div",{className:"space-y-3",children:[x.map((i,a)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:i,onChange:o=>p(a,o.target.value),placeholder:"ej: Iluminación con colores vibrantes",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-orange-500 focus:border-orange-500"}),x.length>1&&e.jsx("button",{type:"button",onClick:()=>j(a),className:"text-red-500 hover:text-red-700 px-2 py-1",children:"✕"})]},a)),e.jsx("button",{type:"button",onClick:w,className:"text-orange-600 hover:text-orange-800 text-sm font-medium",children:"+ Agregar beneficio"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:"Imágenes del Producto (4 imágenes específicas requeridas)"}),m.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700 mb-3",children:"Imágenes actuales"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:m.map(i=>e.jsxs("div",{className:"flex flex-col items-center p-4 bg-white rounded-lg shadow-sm border hover:shadow-md transition",children:[e.jsx("img",{src:`${i.url_imagen}`,alt:i.texto_alt_SEO,className:"w-32 h-32 object-cover rounded-lg mb-2"}),e.jsx("span",{className:"text-center text-gray-700 text-sm mb-2",children:i.texto_alt_SEO}),e.jsx("button",{type:"button",onClick:()=>t(i.id),className:"bg-red-100 text-red-600 text-xs px-3 py-1 rounded-full hover:bg-red-200 transition",children:"Eliminar"})]},i.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-blue-200",children:[e.jsxs("h4",{className:"text-md font-semibold text-blue-700 mb-3",children:["Imagen para Lista de Productos"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:['Esta imagen aparece en la página "Nuestros Productos" y es'," ",e.jsx("strong",{children:"obligatoria"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_lista_productos",required:!r,className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",onChange:O}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Cada imagen debe pesar menos de 2 MB."}),e.jsx("input",{type:"text",name:"alt_imagen_lista",value:l?.text_alt_principal||"",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-green-200",children:[e.jsxs("h4",{className:"text-md font-semibold text-green-700 mb-3",children:["🎯 Imagen Hero del Producto"," ",e.jsx("span",{className:"text-sm text-gray-500",children:"(Banner Principal)"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Imagen de fondo grande en la página individual del producto -"," ",e.jsx("strong",{children:"Banner superior principal"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_hero",className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100",onChange:O}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Cada imagen debe pesar menos de 2 MB."}),e.jsx("input",{type:"text",name:"alt_imagen_hero",value:l?.imagenes[0]?.texto_alt_SEO||"",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-purple-200",children:[e.jsxs("h4",{className:"text-md font-semibold text-purple-700 mb-3",children:["📋 Imagen para Especificaciones"," ",e.jsx("span",{className:"text-sm text-gray-500",children:"(Sección Izquierda)"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Imagen que acompaña la sección de especificaciones -"," ",e.jsx("strong",{children:"Lado izquierdo de la página"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_especificaciones",className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100",onChange:O}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Cada imagen debe pesar menos de 2 MB."}),e.jsx("input",{type:"text",name:"alt_imagen_especificaciones",value:l?.imagenes[1]?.texto_alt_SEO||"",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-orange-200",children:[e.jsxs("h4",{className:"text-md font-semibold text-orange-700 mb-3",children:["🎁 Imagen para Beneficios"," ",e.jsx("span",{className:"text-sm text-gray-500",children:"(Sección Derecha)"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Imagen que acompaña la sección de beneficios -"," ",e.jsx("strong",{children:"Lado derecho de la página"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_beneficios",className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100",onChange:O}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Cada imagen debe pesar menos de 2 MB."}),e.jsx("input",{type:"text",name:"alt_imagen_beneficios",value:l?.imagenes[2]?.texto_alt_SEO||"",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-yellow-200",children:[e.jsx("h4",{className:"text-md font-semibold text-yellow-700 mb-3",children:"💬 Imagen para Popups"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Imagen que acompaña los popups de registro clientes"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",name:"imagen_popups",className:"w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-yellow-50 file:text-yellow-700 hover:file:bg-yellow-100",onChange:O}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Cada imagen debe pesar menos de 2 MB."}),e.jsx("input",{type:"text",name:"alt_imagen_popups",value:l?.imagenes[3]?.texto_alt_SEO||"",placeholder:"Texto ALT para SEO",className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-yellow-500 focus:border-yellow-500"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"💡 Estructura CORRECTA de imágenes:"}),e.jsx("br",{}),"📸 ",e.jsx("strong",{children:"Lista Productos:"})," Imagen para vista de catálogo (imagen_principal)",e.jsx("br",{}),"🎯 ",e.jsx("strong",{children:"Hero:"})," Banner principal superior (images[0])",e.jsx("br",{}),"📋 ",e.jsx("strong",{children:"Especificaciones:"})," Acompaña características (images[1])",e.jsx("br",{}),"🎁 ",e.jsx("strong",{children:"Beneficios:"})," Acompaña ventajas (images[2])",e.jsx("br",{}),"💬 ",e.jsx("strong",{children:"Popups:"})," Acompaña popups registro (images[3])"]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",className:"px-6 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition",children:[r?"Actualizar":"Crear"," Producto"]})]})]})};function se({onSubmit:l,plantillaId:d=null}){const[r,m]=b.useState(null),[k,f]=b.useState([]),[C,h]=b.useState(!1),[y,x]=b.useState([]),E=Array.from({length:3},()=>({imagenPrincipal:null,vistaPreviaPrincipal:"",imagenSecundaria1:null,vistaPreviaSecundaria1:"",imagenSecundaria2:null,vistaPreviaSecundaria2:"",titulo:"",parrafo1:""}));b.useEffect(()=>{x(E)},[]),b.useEffect(()=>{if(r===null){x(E);return}(async()=>{try{h(!0);const s=localStorage.getItem("token"),n=await fetch(T(S.endpoints.emailProducto.plantillaPorProducto(r)),{headers:{Authorization:`Bearer ${s}`,Accept:"application/json"}});if(n.status===404){alert("ℹ️ El producto seleccionado no tiene una plantilla asociada."),x(E);return}if(!n.ok)throw new Error("Error al obtener plantilla");const c=await n.json();if(!c?.secciones||c.secciones.length===0){alert("ℹ️ Este producto no tiene secciones configuradas en su plantilla."),x(E);return}const p=c.secciones.map(j=>({imagenPrincipal:null,vistaPreviaPrincipal:j.imagen_principal_url||"",imagenSecundaria1:null,vistaPreviaSecundaria1:j.imagen_secundaria1_url||"",imagenSecundaria2:null,vistaPreviaSecundaria2:j.imagen_secundaria2_url||"",titulo:j.titulo||"",subtitulo:j.subtitulo||"",parrafo1:j.parrafo1||""})),w=[...p,...Array(Math.max(0,3-p.length)).fill(E[0])];x(w)}catch(s){console.error("Error cargando plantilla del producto:",s),alert("❌ Ocurrió un error al cargar la plantilla del producto."),x(E)}finally{h(!1)}})()},[r]),b.useEffect(()=>{(async()=>{h(!0);try{const s=localStorage.getItem("token"),n=await fetch(T(S.endpoints.productos.all),{method:"GET",headers:{Authorization:`Bearer ${s}`,Accept:"application/json","Content-Type":"application/json"}});if(!n.ok)throw new Error(`Error HTTP: ${n.status}`);const c=await n.json();c.success&&Array.isArray(c.data)?f(c.data):Array.isArray(c)?f(c):f([])}catch(s){console.error("Error al obtener los productos:",s),f([]),alert("❌ No se pudieron cargar los productos. Intenta nuevamente.")}finally{h(!1)}})()},[]);const _=(t,s,n)=>{const c=[...y];c[t][s]=n;const p=n?URL.createObjectURL(n):"";s==="imagenPrincipal"&&(c[t].vistaPreviaPrincipal=p),s==="imagenSecundaria1"&&(c[t].vistaPreviaSecundaria1=p),s==="imagenSecundaria2"&&(c[t].vistaPreviaSecundaria2=p),x(c)},v=(t,s,n)=>{const c=[...y];c[t][s]=n,x(c)},N=(t,s)=>_(t,s,null),g=async t=>{if(t.preventDefault(),r===null){alert("⚠️ Debes seleccionar un producto antes de continuar.");return}const s=new FormData;s.append("producto_id",String(r)),y.forEach((n,c)=>{n.imagenPrincipal&&s.append(`secciones[${c}][imagen_principal]`,n.imagenPrincipal),n.imagenSecundaria1&&s.append(`secciones[${c}][imagenes_secundarias][]`,n.imagenSecundaria1),n.imagenSecundaria2&&s.append(`secciones[${c}][imagenes_secundarias][]`,n.imagenSecundaria2),s.append(`secciones[${c}][titulo]`,n.titulo),s.append(`secciones[${c}][parrafo1]`,n.parrafo1)}),d!=null&&s.append("_method","PUT");try{await l(s)}catch(n){console.error("Error al enviar plantilla:",n),alert("❌ No se pudo guardar la plantilla. Ver consola.")}},I=({emailIndex:t,tipoImagen:s,vistaPrevia:n,etiqueta:c})=>e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c}),n?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:n,alt:c,className:"w-full h-32 object-cover rounded-lg border-2 border-gray-300"}),e.jsx("button",{type:"button",onClick:()=>N(t,s),className:"absolute top-2 right-2 bg-red-500 text-white p-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(X,{size:12})})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition",children:[e.jsx(J,{className:"text-gray-400 text-3xl mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Subir imagen"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:p=>{const w=p.target.files?.[0]||null;_(t,s,w)}})]})]});return e.jsxs("form",{onSubmit:g,className:"space-y-8 max-h-[70vh] overflow-y-auto px-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecciona un producto"}),e.jsxs("select",{value:r??"",onChange:t=>m(t.target.value?Number(t.target.value):null),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Elige un producto --"}),k.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]}),C&&e.jsx("p",{className:"text-sm text-gray-400 italic mt-1",children:"Cargando..."}),!C&&k.length===0&&e.jsx("p",{className:"text-sm text-gray-500 italic mt-2",children:"No hay productos disponibles."})]}),y.map((t,s)=>e.jsxs("div",{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl shadow-md border border-blue-200",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm",children:s+1}),"Sección Email ",s+1]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(I,{emailIndex:s,tipoImagen:"imagenPrincipal",vistaPrevia:t.vistaPreviaPrincipal,etiqueta:"Imagen Principal"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(I,{emailIndex:s,tipoImagen:"imagenSecundaria1",vistaPrevia:t.vistaPreviaSecundaria1,etiqueta:"Imagen Secundaria 1"}),e.jsx(I,{emailIndex:s,tipoImagen:"imagenSecundaria2",vistaPrevia:t.vistaPreviaSecundaria2,etiqueta:"Imagen Secundaria 2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",value:t.titulo,onChange:n=>v(s,"titulo",n.target.value),placeholder:"Escribe el título aquí"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Párrafo 1"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",value:t.parrafo1,onChange:n=>v(s,"parrafo1",n.target.value),placeholder:"Escribe el párrafo aquí",rows:3})]})]})]},s)),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition",children:"Guardar plantilla"})]})}class ae{async getAllProductos(d=1,r=6){try{const m=`${S.endpoints.productos.list}?page=${d}&perPage=${r}`,f=await(await fetch(S.apiUrl+m)).json();return console.log("response from getAllProductos2:",f),f}catch(m){throw console.error("[ProductoService] Error obteniendo productos:",m),m}}async getProductoById(d){try{return await $.get(S.endpoints.productos.detail(d))}catch(r){throw console.error("[ProductoService] Error obteniendo producto:",r),r}}async getProductoByLink(d){try{return await $.get(S.endpoints.productos.link(d))}catch(r){throw console.error("[ProductoService] Error obteniendo producto por link:",r),r}}async createProducto(d){try{const r=this.buildFormData(d);return await $.authenticatedPostFormData(S.endpoints.productos.create,r)}catch(r){throw console.error("[ProductoService] Error creando producto:",r),r}}async updateProducto(d,r){try{const m=this.buildFormData(r);return await $.authenticatedPutFormData(S.endpoints.productos.update(d),m)}catch(m){throw console.error("[ProductoService] Error actualizando producto:",m),m}}async deleteProducto(d){try{return await $.authenticatedDelete(S.endpoints.productos.delete(d))}catch(r){throw console.error("[ProductoService] Error eliminando producto:",r),r}}buildFormData(d){const r=new FormData;return r.append("link",d.link),r.append("nombre",d.nombre),r.append("titulo",d.titulo),r.append("descripcion",d.descripcion),r.append("seccion",d.seccion),(d.imagen_principal_file||d.imagen_principal_file)&&r.append("imagen_principal",d.imagen_principal_file),d.imagenes_files&&d.imagenes_files.forEach((m,k)=>{r.append(`imagenes[${k}]`,m)}),r}async listAllProducts(){const d=S.apiUrl+S.endpoints.productos.all;return await(await fetch(d)).json()}}const M=new ae;function oe(){const[l,d]=b.useState([]),[r,m]=b.useState(!0),[k,f]=b.useState(null),[C,h]=b.useState({current_page:1,last_page:1,per_page:6,total:0});console.log("PRODUCTOS HOOK:",l);const y=async(v=1,N=C.per_page)=>{m(!0),f(null);try{const g=await M.getAllProductos(v,N);console.log("response from getAllProductos:",g.data),d(g.data),h({current_page:g.current_page,last_page:g.last_page,per_page:g.per_page,total:g.total})}catch(g){f(g instanceof Error?g.message:"Error desconocido al obtener productos"),console.error("Error en useProducts:",g)}finally{m(!1)}},x=async(v,N)=>{await y(v,N)};return b.useEffect(()=>{y(C.current_page,C.per_page)},[]),{productos:l,loading:r,error:k,pagination:C,refetch:x,createProduct:async v=>{m(!0),f(null);try{const N=await M.createProducto(v);return x(C.current_page),N.data}catch(N){return f(N instanceof Error?N.message:"Error desconocido al crear producto"),console.error("Error al crear producto:",N),null}finally{m(!1)}},updateProduct:async(v,N)=>{m(!0),f(null);try{const g=await M.updateProducto(v,N);if(!g.data)throw new Error("Producto no encontrado");return d(I=>I.map(t=>t.id===v?g.data:t)),g.data}catch(g){return f(g instanceof Error?g.message:"Error desconocido al actualizar producto"),console.error("Error al actualizar producto:",g),null}finally{m(!1)}}}}function xe(){const{productos:l,loading:d,pagination:r,refetch:m}=oe(),[k,f]=b.useState(!1),[C,h]=b.useState(!1),[y,x]=b.useState(void 0),{darkMode:E}=re(),_=async t=>{const s=T(S.endpoints.productos.create),n=localStorage.getItem("token");if(!n){P.fire("Error","No hay token de autenticación. Por favor inicia sesión.","error");return}try{const c=y?T(S.endpoints.productos.update(y.id)):s,p=await fetch(c,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${n}`,"X-Requested-With":"XMLHttpRequest"},body:t}),w=await p.json();if(p.ok)P.fire({title:w.message||"Producto guardado exitosamente",icon:"success"}),f(!1),m(r.current_page);else{let j=w.message||"Error desconocido";p.status===401?(j="Token expirado o inválido. Por favor inicia sesión nuevamente.",localStorage.removeItem("token")):p.status===403?j="Acceso denegado. Permisos insuficientes.":p.status===422&&(j="Datos inválidos: "+w.message),P.fire("Error",j,"error")}}catch{P.fire("Error","Hubo un error al insertar el producto","error")}},v=async t=>{const s=localStorage.getItem("token");if(!s){P.fire("Error","No hay token de autenticación. Por favor inicia sesión.","error");return}const n=T(S.endpoints.emailProducto.create);try{const c=await fetch(n,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${s}`},body:t}),p=await c.json();if(c.ok)P.fire({title:p.message||"Email enviado con éxito",icon:"success"}),h(!1);else{let w=p.message||"Error al enviar email";c.status===401?(w="Token expirado o inválido. Por favor inicia sesión nuevamente.",localStorage.removeItem("token")):c.status===422&&(w="Datos inválidos: "+p.message),P.fire("Error",w,"error")}}catch{P.fire("Error","No se pudo conectar con el servidor.","error")}},N=async t=>{const s=T(S.endpoints.productos.delete(t)),n=localStorage.getItem("token");if(!n){P.fire({title:"Error de autenticación",text:"No se encontró token de acceso. Por favor inicia sesión nuevamente.",icon:"error",confirmButtonText:"Entendido"});return}if((await P.fire({title:"¿Estás seguro?",text:"¡Esta acción no se puede deshacer!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const p=await fetch(s,{method:"DELETE",headers:{Accept:"application/json",Authorization:`Bearer ${n}`,"X-Requested-With":"XMLHttpRequest"}}),w=await p.json();if(p.ok)P.fire("¡Eliminado!",w.message,"success"),m(r.current_page);else{let j=w.message||"Error desconocido al eliminar";p.status===401?(j="Token expirado o inválido. Por favor inicia sesión nuevamente.",localStorage.removeItem("token")):p.status===403?j="Acceso denegado. No tienes permisos para eliminar productos.":p.status===404&&(j="El producto no existe o ya fue eliminado."),P.fire("Error",j,"error")}}catch{P.fire("Error","No se pudo conectar con el servidor.","error")}},g=t=>{m(t,r.per_page)},I=t=>{x(t),f(!0)};return b.useEffect(()=>(document.body.style.overflow=k?"hidden":"auto",()=>{document.body.style.overflow="auto"}),[k]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row gap-4 mb-4",children:[e.jsx("button",{onClick:()=>{x(void 0),f(!0)},className:"mt-4 bg-blue-950 hover:bg-blue-800 text-white text-lg px-10 py-1.5 rounded-full flex items-center gap-2",children:"Añadir Producto"}),e.jsx("button",{onClick:()=>h(!0),className:"mt-4 bg-green-700 hover:bg-green-600 text-white text-lg px-10 py-1.5 rounded-full flex items-center gap-2",children:"Envío de Emails"})]}),e.jsx("div",{className:"overflow-x-auto p-4",children:e.jsxs(ee,{tableType:"productos",children:[e.jsx("thead",{className:"hidden md:table-header-group",children:e.jsx("tr",{children:["ID","Nombre","Sección","Precio","Acción"].map(t=>e.jsx("th",{className:`px-4 py-2 text-white uppercase text-xs font-bold rounded-md ${E?"bg-cyan-900":"bg-cyan-400"}`,children:t},t))})}),e.jsx("tbody",{children:d?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-12",children:e.jsxs("div",{className:"flex justify-center items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-teal-500"}),e.jsx("span",{className:"text-teal-500 font-medium",children:"Cargando productos..."})]})})}):l.length>0?l.map((t,s)=>{const n=s%2===0&&E?"bg-white text-black":"text-black bg-white",c=t.id??`producto-${s}`;return e.jsxs("tr",{className:`text-center md:table-row block md:mb-0 mb-4 rounded-lg shadow-sm ${n}`,children:[e.jsx("td",{className:"px-4 py-2 border",children:t.id}),e.jsx("td",{className:"px-4 py-2 border",children:t.nombre}),e.jsx("td",{className:"px-4 py-2 border",children:t.seccion}),e.jsxs("td",{className:"px-4 py-2 border",children:["$",t.precio?.toFixed(2)]}),e.jsx("td",{className:"px-4 py-2 border",children:e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:()=>I(t),className:"p-2 text-yellow-600 hover:text-yellow-800 bg-yellow-100 rounded-lg shadow-sm",title:"Editar",children:e.jsx(Q,{size:18})}),e.jsx("button",{onClick:()=>N(t.id),className:"p-2 text-red-600 hover:text-red-800 bg-red-100 rounded-lg shadow-sm",title:"Eliminar",children:e.jsx(Y,{size:18})})]})})]},c)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-16 text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"bg-teal-50 p-6 rounded-full",children:e.jsx(Z,{className:"h-10 w-10 text-teal-300"})}),e.jsx("p",{className:"text-xl font-medium text-gray-600 mt-4",children:"No hay productos registrados"}),e.jsx("p",{className:"text-gray-400 max-w-md mx-auto",children:"Comienza agregando productos a tu catálogo con el botón 'Añadir Producto'"})]})})})})]})}),r.last_page>1&&e.jsxs("div",{className:"flex justify-center items-center mt-4 gap-2",children:[e.jsx("button",{onClick:()=>g(r.current_page-1),disabled:r.current_page===1,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:r.last_page},(t,s)=>{const n=s+1;return e.jsx("button",{onClick:()=>g(n),className:`px-3 py-2 rounded-md ${r.current_page===n?"bg-blue-950 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:n},n)})}),e.jsx("button",{onClick:()=>g(r.current_page+1),disabled:r.current_page===r.last_page,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"})]}),e.jsx(D,{isOpen:k,onClose:()=>{f(!1),x(void 0)},title:y?"Editar Datos":"Ingresar Datos",children:e.jsx(te,{initialData:y,onSubmit:_,isEditing:!!y})}),e.jsx(D,{isOpen:C,onClose:()=>h(!1),title:"Envio de Emails",children:e.jsx(se,{onSubmit:v})})]})}export{xe as default};
