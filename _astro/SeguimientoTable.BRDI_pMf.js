import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as c}from"./index.Be8AcK8B.js";import{i as R,j as $,d as _,k as z}from"./index.CvDk6RGp.js";import{g as k,c as v}from"./config.DZH0lvwJ.js";import{T as F}from"./TableContainer.C49vMdQY.js";import"./iconBase.Db4UJpFa.js";const L=()=>{const o=()=>{const s=localStorage.getItem("token");if(console.log("🔍 Token encontrado:",s?"✅ Sí":"❌ No"),console.log("🔍 Token (primeros 20 chars):",s?s.substring(0,20)+"...":"No token"),!s)throw new Error("No se encontró el token");return s};return{addCliente:async s=>{const r=o(),a=k(v.endpoints.clientes.create);console.log("🔍 ADD - URL completa:",a);const n=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(s)});if(console.log("🔍 ADD - Status:",n.status),console.log("🔍 ADD - URL final:",n.url),!n.ok){const x=await n.text();throw new Error(`Error al agregar cliente: ${n.status} - ${x}`)}return(await n.json()).data},updateCliente:async(s,r)=>{try{const a=o(),n=k(v.endpoints.clientes.update(s)),p={method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(r)};console.log("🔍 Headers de la petición:",p.headers);const x=await fetch(n,p);if(!x.ok){const i=await x.text();throw console.error("🚨 Error response body:",i),new Error(`Error ${x.status}: ${i}`)}const g=await x.json();return console.log("✅ Respuesta exitosa:",g),g.data}catch(a){throw console.error("🚨 Error completo:",a),a}},deleteCliente:async s=>{const r=o(),a=k(v.endpoints.clientes.delete(s));console.log("🔍 DELETE - URL completa:",a);const n=await fetch(a,{method:"DELETE",headers:{Authorization:`Bearer ${r}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!n.ok){const x=await n.text();throw new Error(`Error al eliminar cliente: ${n.status} - ${x}`)}return await n.json()}}},J=(o,d)=>{const[l,u]=c.useState({name:"",celular:"",email:"",producto_id:0,created_at:""}),[s,r]=c.useState(!1),{addCliente:a,updateCliente:n}=L();c.useEffect(()=>{o?(u({name:o.name,celular:o.celular,email:o.email,producto_id:o.producto_id,created_at:o.created_at}),r(!0)):(g(),r(!1))},[o]);const p=i=>{u({...l,[i.target.name]:i.target.value})},x=async i=>{i.preventDefault();const{name:y,celular:h,email:b}=l;if(!y.trim()||!h.trim()||!b.trim()){alert("⚠️ Todos los campos son obligatorios.");return}if(!/^\d+$/.test(h)){alert("⚠️ El teléfono solo debe contener números.");return}try{s?(await n(o.id,{name:y,celular:h,email:b,producto_id:l.producto_id}),alert(" Cliente actualizado correctamente")):(await a({name:y,celular:h,email:b}),alert(" Cliente registrado exitosamente")),d?.(),g()}catch(f){console.error("❌ Error en la operación:",f),alert(`❌ Error: ${f.message||"Error desconocido"}`)}},g=()=>{u({name:"",celular:"",email:"",producto_id:0,created_at:""}),r(!1)};return{formData:l,handleChange:p,handleSubmit:x}},W=({isOpen:o,setIsOpen:d,cliente:l,onRefetch:u})=>{const{formData:s,handleChange:r,handleSubmit:a}=J(l,()=>{u(),d(!1)});return o?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50 p-2 sm:p-4",children:e.jsxs("div",{style:{backgroundColor:"#528FC2"},className:"text-white px-6 py-6 sm:px-10 sm:py-8 rounded-2xl w-full max-w-lg sm:max-w-2xl",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-4 text-center sm:text-left",children:l?"EDITAR CLIENTE":"AÑADIR CLIENTE"}),e.jsxs("form",{onSubmit:a,className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Nombres"}),e.jsx("input",{type:"text",name:"name",value:s.name,onChange:r,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black text-sm sm:text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Teléfono"}),e.jsx("input",{type:"text",name:"celular",value:s.celular,onChange:r,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black text-sm sm:text-base"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Gmail"}),e.jsx("input",{type:"email",name:"email",value:s.email,onChange:r,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black text-sm sm:text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Producto ID"}),e.jsx("input",{type:"text",name:"producto_id",value:s.producto_id??"",onChange:r,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black text-sm sm:text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Fecha"}),e.jsx("input",{type:"text",name:"fecha",value:s.created_at,onChange:r,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black text-sm sm:text-base"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-6 sm:col-span-2",children:[e.jsx("button",{type:"submit",style:{backgroundColor:"#98D8DF"},className:"flex-1 sm:flex-none px-6 py-2 rounded-full text-base text-white hover:opacity-90 transition",children:l?"Guardar cambios":"Añadir cliente"}),e.jsx("button",{onClick:()=>d(!1),type:"button",className:"flex-1 sm:flex-none px-6 py-2 bg-gray-400 rounded-full text-base hover:bg-gray-500 transition",children:"Cancelar"})]})]})]})}):null},K=({isOpen:o,setIsOpen:d,clienteId:l,onRefetch:u})=>{const{deleteCliente:s}=L(),[r,a]=c.useState(!1),n=async()=>{try{a(!0),await s(l),u(),d(!1)}catch(p){console.error("Error al eliminar cliente:",p),alert("No se pudo eliminar el cliente")}finally{a(!1)}};return o?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg max-w-md w-full text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"¿Eliminar cliente?"}),e.jsx("p",{className:"text-gray-700 mb-6",children:"Esta acción es permanente y no se puede deshacer."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:n,disabled:r,className:"bg-red-600 text-white px-5 py-2 rounded-lg hover:bg-red-700 disabled:opacity-50",children:r?"Eliminando...":"Eliminar"}),e.jsx("button",{onClick:()=>d(!1),className:"bg-gray-200 text-gray-800 px-5 py-2 rounded-lg hover:bg-gray-300",children:"Cancelar"})]})]})}):null},Q=(o,d=1)=>{const[l,u]=c.useState([]),[s,r]=c.useState(1),[a,n]=c.useState(!0),[p,x]=c.useState(null);return c.useEffect(()=>{(async()=>{n(!0),x(null);try{const i=localStorage.getItem("token");if(!i)throw new Error("No se encontró el token de autenticación");const y=`${v.endpoints.clientes.list}?page=${d}`,h=k(y),b=await fetch(h,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}});if(!b.ok){const M=await b.text();throw new Error(`Error al obtener clientes: ${b.status} - ${M}`)}const f=await b.json();console.log("🚀 Respuesta completa:",f);const N=f.data||{},E=N.data||[],S=N.total||0,T=N.last_page||1;u(E),r(T)}catch(i){console.error("🚨 Error en fetchClientes:",i),x(i instanceof Error?i.message:"Ocurrió un error desconocido")}finally{n(!1)}})()},[o,d]),{clientes:l,totalPages:s,loading:a,error:p}},Y=({currentPage:o,totalPages:d,onPageChange:l})=>e.jsxs("div",{className:"flex justify-center items-center mt-4 gap-2",children:[e.jsx("button",{onClick:()=>l(o-1),disabled:o===1,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"Anterior"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:d},(u,s)=>{const r=s+1;return e.jsx("button",{onClick:()=>l(r),className:`px-3 py-2 rounded-md ${o===r?"bg-blue-950 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:r},r)})}),e.jsx("button",{onClick:()=>l(o+1),disabled:o===d,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:"Siguiente"})]}),ne=()=>{const[o,d]=c.useState(!1),[l,u]=c.useState(1),[s,r]=c.useState(!1),{clientes:a,totalPages:n,loading:p,error:x}=Q(o,l),[g,i]=c.useState({}),[y,h]=c.useState(!1),[b,f]=c.useState(null),[N,E]=c.useState(!1),[S,T]=c.useState(null),[M,q]=c.useState(!1),[Z,P]=c.useState(!1);if(c.useEffect(()=>{if(a&&a.length>0){const t={};a.forEach(j=>{t[j.id]={whatsapp:!0,gmail:!0}}),i(t)}else i({})},[a]),p)return e.jsx("p",{className:"text-center text-gray-500",children:"Cargando datos..."});if(x)return e.jsxs("p",{className:"text-center text-red-500",children:["Error: ",x]});const A=()=>d(t=>!t),D=t=>{f(t),h(!0)},U=()=>{f(null),h(!0)},C=(t,j,w)=>{i(m=>({...m,[t]:{...m[t],[j]:w}}))},I=t=>{T(t),E(!0)},G=()=>{A(),h(!1)},O=()=>{r(!s)},B=()=>{q(!0)},X=()=>{P(!0)},H=()=>e.jsxs(F,{tableType:"seguimiento",headerContent:e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("button",{className:"bg-sky-600 text-white px-4 py-2 rounded-xl font-semibold opacity-80 hover:opacity-100 transition-opacity",onClick:B,children:"MENSAJES"}),e.jsx("button",{className:"bg-sky-600 text-white px-4 py-2 rounded-xl font-semibold opacity-80 hover:opacity-100 transition-opacity",onClick:O,children:"SEGUIMIENTO"}),e.jsx("button",{className:"bg-sky-600 text-white px-4 py-2 rounded-xl font-semibold opacity-80 hover:opacity-100 transition-opacity",onClick:X,children:"MONITOREO"})]}),children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 bg-cyan-400 text-white text-xs font-bold rounded-md w-12",children:"ID"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white text-xs font-bold rounded-md",children:"NOMBRE"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white text-xs font-bold rounded-md",children:"WHATSAPP"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white text-xs font-bold rounded-md",children:"RESPUESTA"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white text-xs font-bold rounded-md",children:"GMAIL"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white text-xs font-bold rounded-md",children:"RESPUESTA"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white text-xs font-bold rounded-md",children:"ACCIÓN"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-4 text-gray-500",children:"No hay clientes disponibles."})}):a.map((t,j)=>{const w=j%2===0?"bg-gray-100":"bg-white",m=g[t.id]||{whatsapp:!0,gmail:!0};return e.jsxs("tr",{className:`${w} hover:bg-gray-50`,children:[e.jsx("td",{className:"px-2 py-3 text-center font-bold text-sm border-r",children:t.id}),e.jsx("td",{className:"px-4 py-3 text-center font-medium text-sm border-r",children:t.name||e.jsx("div",{className:"bg-gray-300 h-4 rounded animate-pulse font-bold"})}),e.jsx("td",{className:"px-4 py-3 text-center border-r",children:e.jsx("span",{className:"text-black px-2 py-1 rounded text-xs font-bold",children:m.whatsapp?"ENVIADO":"NO ENVIADO"})}),e.jsx("td",{className:"px-4 py-3 text-center border-r",children:e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{className:`w-10 h-10 flex justify-center items-center rounded-full transition-colors ${m.whatsapp?"bg-gray-200 cursor-not-allowed opacity-50":"bg-red-100 text-red-500 hover:bg-red-500 hover:text-white"}`,onClick:()=>C(t.id,"whatsapp",!1),title:"Marcar como no enviado","aria-label":"Marcar como no enviado",disabled:m.whatsapp===!1,children:e.jsx(R,{size:20})}),e.jsx("button",{className:`w-10 h-10 flex justify-center items-center rounded-full transition-colors ${m.whatsapp?"bg-green-100 text-green-500 hover:bg-green-500 hover:text-white":"bg-gray-200 cursor-not-allowed opacity-50"}`,onClick:()=>C(t.id,"whatsapp",!0),title:"Marcar como enviado","aria-label":"Marcar como enviado",disabled:m.whatsapp===!0,children:e.jsx($,{size:20})})]})}),e.jsx("td",{className:"px-4 py-3 text-center border-r",children:e.jsx("span",{className:"text-black px-2 py-1 rounded text-xs font-bold",children:m.gmail?"ENVIADO":"NO ENVIADO"})}),e.jsx("td",{className:"px-4 py-3 text-center border-r",children:e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{className:`w-10 h-10 flex justify-center items-center rounded-full transition-colors ${m.gmail?"bg-gray-200 cursor-not-allowed opacity-50":"bg-red-100 text-red-500 hover:bg-red-500 hover:text-white"}`,onClick:()=>C(t.id,"gmail",!1),title:"Marcar como no enviado","aria-label":"Marcar como no enviado",disabled:m.gmail===!1,children:e.jsx(R,{size:20})}),e.jsx("button",{className:`w-10 h-10 flex justify-center items-center rounded-full transition-colors ${m.gmail?"bg-green-100 text-green-500 hover:bg-green-500 hover:text-white":"bg-gray-200 cursor-not-allowed opacity-50"}`,onClick:()=>C(t.id,"gmail",!0),title:"Marcar como enviado","aria-label":"Marcar como enviado",disabled:m.gmail===!0,children:e.jsx($,{size:20})})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx("button",{className:"w-10 h-10 flex justify-center items-center rounded-full bg-red-100 text-red-500 hover:bg-red-500 hover:text-white transition-colors",title:"Eliminar",onClick:()=>I(t.id),"aria-label":"Eliminar",children:e.jsx(_,{size:20})}),e.jsx("button",{className:"w-10 h-10 flex justify-center items-center rounded-full bg-green-100 text-green-600 hover:bg-green-600 hover:text-white transition-colors",title:"Editar",onClick:()=>D(t),"aria-label":"Editar",children:e.jsx(z,{size:20})})]})})]},t.id)})})]}),V=()=>e.jsxs(F,{tableType:"seguimiento",headerContent:e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("button",{className:"bg-sky-600 text-white px-4 py-2 rounded-xl font-semibold opacity-80 hover:opacity-100 transition-opacity",children:"MENSAJES"}),e.jsx("button",{className:"bg-sky-600 text-white px-4 py-2 rounded-xl font-semibold opacity-80 hover:opacity-100 transition-opacity",onClick:O,children:"MEDIO DE SEGUIMIENTO"}),e.jsx("button",{className:"bg-sky-600 text-white px-4 py-2 rounded-xl font-semibold opacity-80 hover:opacity-100 transition-opacity",children:"MONITOREO"})]}),children:[e.jsx("thead",{className:"hidden md:table-header-group",children:e.jsx("tr",{children:["ID","Nombre","Gmail","Teléfono","Producto","Fecha","Acción"].map(t=>e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:t},t))})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-4 text-gray-500",children:"No hay clientes disponibles."})}):a.map((t,j)=>{const w=j%2===0?"bg-[#d9d9d9]":"bg-[#d9d9d94d]";return e.jsxs("tr",{className:`text-center md:table-row block md:mb-0 mb-4 rounded-lg shadow-sm ${w}`,children:[e.jsx("td",{"data-label":"ID",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:t.id}),e.jsx("td",{"data-label":"Nombre",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:t.name}),e.jsx("td",{"data-label":"Gmail",className:"px-4 py-2 border border-gray-300 block md:table-cell",children:t.email}),e.jsx("td",{"data-label":"Teléfono",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:t.celular}),e.jsx("td",{"data-label":"Producto",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:t.nombre_producto||"N/A"}),e.jsx("td",{"data-label":"Fecha",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:t.created_at}),e.jsx("td",{"data-label":"Acción",className:"px-4 py-2 border border-gray-300 block md:table-cell",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-center gap-2 rounded-xl p-1",children:[e.jsx("button",{className:"p-2 text-red-600 hover:text-red-800 transition",title:"Eliminar",onClick:()=>I(t.id),children:e.jsx(_,{size:18})}),e.jsx("button",{className:"p-2 text-green-600 hover:text-green-800 transition",title:"Editar",onClick:()=>D(t),children:e.jsx(z,{size:18})})]})})]},t.id)})})]});return e.jsxs("div",{className:"overflow-x-auto p-4",children:[s?H():V(),!s&&e.jsx("button",{className:"mt-4 ml-2 p-2 pl-4 bg-blue-900 text-white rounded-lg",onClick:U,children:"Agregar Cliente"}),e.jsx(W,{isOpen:y,setIsOpen:h,cliente:b,onRefetch:G}),S!==null&&e.jsx(K,{isOpen:N,setIsOpen:E,clienteId:S,onRefetch:A}),e.jsx(Y,{currentPage:l,totalPages:n,onPageChange:t=>u(t)})]})};export{ne as default};
