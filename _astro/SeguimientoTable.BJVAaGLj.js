import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as c}from"./index.ai7qpRr1.js";import{G as v,F as S}from"./index.CilsAXPC.js";function T(t){return v({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",strokeWidth:"2",d:"M1.7507,16.0022 C3.3517,20.0982 7.3367,23.0002 11.9997,23.0002 C18.0747,23.0002 22.9997,18.0752 22.9997,12.0002 M22.2497,7.9982 C20.6487,3.9012 16.6627,1.0002 11.9997,1.0002 C5.9247,1.0002 0.9997,5.9252 0.9997,12.0002 M8.9997,16.0002 L0.9997,16.0002 L0.9997,24.0002 M22.9997,0.0002 L22.9997,8.0002 L14.9997,8.0002"},child:[]}]})(t)}const y=()=>{const t=()=>{const n=localStorage.getItem("token");if(!n)throw new Error("No se encontró el token");return n};return{addCliente:async n=>{const s=t(),l=await fetch("https://apiyuntas.yuntasproducciones.com/api/v1/clientes",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(n)});if(!l.ok)throw new Error("Error al agregar cliente");return(await l.json()).data},updateCliente:async(n,s)=>{const i=t(),l=`https://apiyuntas.yuntasproducciones.com/api/v1/clientes/${n}`,x=await fetch(l,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(s)});if(!x.ok)throw new Error("Error al actualizar cliente");return(await x.json()).data},deleteCliente:async n=>{const s=t(),i=`https://apiyuntas.yuntasproducciones.com/api/v1/clientes/${n}`,l=await fetch(i,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}});if(!l.ok)throw new Error("Error al eliminar cliente");return await l.json()}}},I=(t,o)=>{const[a,u]=c.useState({name:"",celular:"",email:""}),[n,s]=c.useState(!1),{addCliente:i,updateCliente:l}=y();c.useEffect(()=>{t?(u({name:t.name,celular:t.celular,email:t.email}),s(!0)):(b(),s(!1))},[t]);const x=d=>{u({...a,[d.target.name]:d.target.value})},h=async d=>{d.preventDefault();const{name:p,celular:m,email:g}=a;if(!p.trim()||!m.trim()||!g.trim()){alert("⚠️ Todos los campos son obligatorios.");return}if(!/^\d+$/.test(m)){alert("⚠️ El teléfono solo debe contener números.");return}try{n?(await l(t.id,{name:p,celular:m,email:g}),alert("✅ Cliente actualizado correctamente")):(await i({name:p,celular:m,email:g}),alert("✅ Cliente registrado exitosamente")),o?.(),b()}catch(f){console.error("❌ Error en la operación:",f),alert(`❌ Error: ${f.message||"Error desconocido"}`)}},b=()=>{u({name:"",celular:"",email:""}),s(!1)};return{formData:a,handleChange:x,handleSubmit:h}},A=({isOpen:t,setIsOpen:o,cliente:a,onRefetch:u})=>{const{formData:n,handleChange:s,handleSubmit:i}=I(a,()=>{u(),o(!1)});return t?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"bg-blue-800 text-white px-10 py-8 rounded-4xl w-3/5",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:a?"EDITAR CLIENTE":"AÑADIR CLIENTE"}),e.jsxs("form",{onSubmit:i,className:"grid grid-cols-2 gap-4 gap-x-12",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Nombres"}),e.jsx("input",{type:"text",name:"name",value:n.name,onChange:s,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Teléfono"}),e.jsx("input",{type:"text",name:"celular",value:n.celular,onChange:s,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block",children:"Gmail"}),e.jsx("input",{type:"email",name:"email",value:n.email,onChange:s,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{className:"flex gap-2 mt-8 col-span-2",children:[e.jsx("button",{type:"submit",className:"px-10 bg-blue-950 py-1 rounded-full text-lg hover:bg-blue-900",children:a?"Guardar cambios":"Añadir cliente"}),e.jsx("button",{onClick:()=>o(!1),type:"button",className:"px-10 bg-gray-400 py-1 rounded-full text-lg hover:bg-gray-500",children:"Cancelar"})]})]})]})}):null},D=({isOpen:t,setIsOpen:o,clienteId:a,onRefetch:u})=>{const{deleteCliente:n}=y(),[s,i]=c.useState(!1),l=async()=>{try{i(!0),await n(a),u(),o(!1)}catch(x){console.error("Error al eliminar cliente:",x),alert("No se pudo eliminar el cliente")}finally{i(!1)}};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg max-w-md w-full text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"¿Eliminar cliente?"}),e.jsx("p",{className:"text-gray-700 mb-6",children:"Esta acción es permanente y no se puede deshacer."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:l,disabled:s,className:"bg-red-600 text-white px-5 py-2 rounded-lg hover:bg-red-700 disabled:opacity-50",children:s?"Eliminando...":"Eliminar"}),e.jsx("button",{onClick:()=>o(!1),className:"bg-gray-200 text-gray-800 px-5 py-2 rounded-lg hover:bg-gray-300",children:"Cancelar"})]})]})}):null},M=(t,o=1)=>{const[a,u]=c.useState([]),[n,s]=c.useState(1),[i,l]=c.useState(!0),[x,h]=c.useState(null);return c.useEffect(()=>{(async()=>{l(!0),h(null);try{const d=localStorage.getItem("token");if(!d)throw new Error("No se encontró el token de autenticación");const p=await fetch("https://apiyuntas.yuntasproducciones.com/api/v1/clientes",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}});if(!p.ok)throw new Error(`Error al obtener clientes: ${p.statusText}`);const m=await p.json(),g=m.data?.data||[],f=Math.ceil(m.total/10)||1;u(g),s(f)}catch(d){console.error("🚨 Error en fetchClientes:",d),h(d instanceof Error?d.message:"Ocurrió un error desconocido")}finally{l(!1)}})()},[t,o]),{clientes:a,totalPages:n,loading:i,error:x}},O=({currentPage:t,totalPages:o,onPageChange:a})=>e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx("button",{onClick:()=>a(t-1),disabled:t===1,className:"pagination-btn",children:"Anterior"}),e.jsxs("span",{className:"text-gray-700 font-bold",children:["Página ",t," de ",o]}),e.jsx("button",{onClick:()=>a(t+1),disabled:t===o,className:"pagination-btn",children:"Siguiente"})]}),$=()=>{const[t,o]=c.useState(!1),[a,u]=c.useState(1),{clientes:n,totalPages:s,loading:i,error:l}=M(t,a),[x,h]=c.useState(!1),[b,d]=c.useState(null),[p,m]=c.useState(!1),[g,f]=c.useState(null);if(i)return e.jsx("p",{className:"text-center text-gray-500",children:"Cargando datos..."});if(l)return e.jsxs("p",{className:"text-center text-red-500",children:["Error: ",l]});const j=()=>o(r=>!r),N=r=>{d(r),h(!0)},C=()=>{d(null),h(!0)},E=r=>{f(r),m(!0)},w=()=>{j(),h(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full border-separate border-spacing-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-900 text-white",children:[e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"ID"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"NOMBRE"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"GMAIL"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"TELÉFONO"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"SECCIÓN"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"FECHA"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"ACCIÓN"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-4 text-gray-500",children:"No hay clientes disponibles."})}):n.map((r,k)=>e.jsxs("tr",{className:`text-center ${k%2===0?"bg-gray-100":"bg-gray-300"}`,children:[e.jsx("td",{className:"px-4 font-bold rounded-xl",children:r.id}),e.jsx("td",{className:"px-4 font-bold rounded-xl",children:r.name}),e.jsx("td",{className:"px-4 rounded-xl",children:r.email}),e.jsx("td",{className:"px-4 font-bold rounded-xl",children:r.celular}),e.jsx("td",{className:"px-4 font-bold rounded-xl",children:r.seccion||"N/A"}),e.jsx("td",{className:"px-4 font-bold rounded-xl",children:r.created_at}),e.jsx("td",{className:"px-4 rounded-xl",children:e.jsxs("div",{className:"flex justify-center gap-2 rounded-xl p-1",children:[e.jsx("button",{className:"p-2 text-red-600 hover:text-red-800 transition",title:"Eliminar",onClick:()=>E(r.id),children:e.jsx(S,{size:18})}),e.jsx("button",{className:"p-2 text-green-600 hover:text-green-800 transition",title:"Editar",onClick:()=>N(r),children:e.jsx(T,{size:18})})]})})]},r.id))})]}),e.jsx("button",{className:"mt-4 ml-2 p-2 pl-4 bg-blue-900 text-white rounded-lg",onClick:C,children:"Agregar Cliente"}),e.jsx(A,{isOpen:x,setIsOpen:h,cliente:b,onRefetch:w}),g!==null&&e.jsx(D,{isOpen:p,setIsOpen:m,clienteId:g,onRefetch:j}),e.jsx(O,{currentPage:a,totalPages:s,onPageChange:r=>u(r)})]})};export{$ as default};
