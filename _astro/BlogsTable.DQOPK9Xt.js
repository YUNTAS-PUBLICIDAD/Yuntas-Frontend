import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as x,R as A}from"./index.ai7qpRr1.js";import{d as xe,l as he}from"./index.DPvrmFMZ.js";import{g as G,c as J}from"./config.DqK_gEEU.js";import{S as Y}from"./sweetalert2.esm.all.B0Dix5B2.js";import{T as ve}from"./TableContainer.BM3tcAM5.js";import{d as we,S as _e,c as je,P as le,A as ye}from"./autoplay.C5Y-zvcZ.js";import{u as Ee}from"./useDarkMode.B3UsSFEU.js";import"./iconBase.CsihB_xR.js";const Ne=({isOpen:a,setIsOpen:e,blogToEdit:r,onSuccess:n})=>{const[b,d]=x.useState([]),[h,w]=x.useState(""),[s,k]=x.useState(!1),[u,v]=x.useState(!1),[N,C]=x.useState(null),[O,c]=x.useState(null),[m,i]=x.useState(""),[j,E]=x.useState(!1),[o,S]=x.useState(""),y={producto_id:"",subtitulo:"",link:"",meta_titulo:"",meta_descripcion:"",imagen_principal:null,text_alt_principal:"",alt_imagen_card:"",imagenes_secundarias:[null,null,null],alt_imagenes_secundarias:["","",""],parrafos:["","",""],url_video:""},[l,P]=x.useState(y);x.useEffect(()=>{if(a)if(r){const f=r.producto_id?.toString()||"";P({producto_id:f,subtitulo:r.subtitulo||"",link:r.link||"",meta_titulo:r.etiqueta?.meta_titulo||"",meta_descripcion:r.etiqueta?.meta_descripcion||"",imagen_principal:null,text_alt_principal:r.text_alt_principal||"",alt_imagen_card:r.alt_imagen_card||"",imagenes_secundarias:[null,null,null],alt_imagenes_secundarias:[r.imagenes?.[0]?.text_alt||"",r.imagenes?.[1]?.text_alt||"",r.imagenes?.[2]?.text_alt||""],parrafos:[r.parrafos?.[0]?.parrafo||"",r.parrafos?.[1]?.parrafo||"",r.parrafos?.[2]?.parrafo||""],url_video:r.url_video||""}),w(r.nombre_producto||"")}else P(y),w("")},[a,r]),x.useEffect(()=>{(async()=>{if(a){k(!0);try{const p=localStorage.getItem("token"),_=await fetch(G(J.endpoints.productos.all),{method:"GET",headers:{Authorization:`Bearer ${p}`,Accept:"application/json","Content-Type":"application/json"}});if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);const I=await _.json();I.success&&Array.isArray(I.data)?d(I.data):Array.isArray(I)?d(I):d([])}catch(p){console.error("Error al obtener productos:",p),d([]),alert("❌ Error al cargar los productos. Por favor, intenta de nuevo.")}finally{k(!1)}}})()},[a]);const g=f=>{P({...l,[f.target.name]:f.target.value})},q=f=>{P({...l,[f.target.name]:f.target.value})},R=(f,p)=>{const _=f.target.files?.[0];if(_){if(_.size>2048*1024){Y.fire({icon:"warning",title:"¡Imagen muy grande!",text:"Máx. 2 MB."}),f.target&&(f.target.value="");return}P({...l,[p]:_})}},M=(f,p)=>{const _=f.target.files?.[0]||null;if(_&&_.size>2048*1024){Y.fire({icon:"warning",title:"¡Imagen muy grande!",text:"Máx. 2 MB."}),f.target&&(f.target.value="");return}const I=[...l.imagenes_secundarias];I[p]=_,P({...l,imagenes_secundarias:I})},H=(f,p)=>{const _=[...l.alt_imagenes_secundarias];_[p]=f.target.value,P({...l,alt_imagenes_secundarias:_})},Z=(f,p)=>{const _=[...l.parrafos];_[p]=f.target.value,P({...l,parrafos:_})},Q=f=>{const p=document.getElementById(`parrafo-${f}`);if(!p)return;const _=p.selectionStart,I=p.selectionEnd;if(_===I){Y.fire("Selecciona texto","Selecciona una palabra o frase antes de insertar el enlace.","warning");return}const B=p.value.substring(_,I);C(f),c({start:_,end:I}),i(B),v(!0)},te=()=>{if(N===null||O===null||!o.trim())return;const f=l.parrafos[N],p=`<a href="${o}" target="_blank" rel="noopener noreferrer">${m}</a>`,_=f.slice(0,O.start)+p+f.slice(O.end),I=[...l.parrafos];I[N]=_,P({...l,parrafos:I}),C(null),c(null),i(""),S(""),v(!1)},ae=f=>{const p=document.getElementById(`parrafo-${f}`);if(!p)return;const _=p.selectionStart,I=p.selectionEnd,B=p.value.substring(_,I);if(!B){Y.fire("Selecciona texto","Selecciona una palabra o frase para enlazar a un producto.","warning");return}C(f),c({start:_,end:I}),i(B),E(!0)},re=f=>{if(N===null||O===null)return;const p=l.parrafos[N],I=`<a href="/products/producto/?link=${f.link}" style="color: blue; text-decoration: underline;">${m}</a>`,B=p.slice(0,O.start)+I+p.slice(O.end),L=[...l.parrafos];L[N]=B,P({...l,parrafos:L}),C(null),c(null),i(""),E(!1)},$=()=>{e(!1),C(null),c(null),i(""),v(!1),E(!1),S(""),P(y)},D=async f=>{f.preventDefault();const p=!!r;if(!l.producto_id)return alert("⚠️ Debe seleccionar un producto.");if(!l.subtitulo.trim())return alert("⚠️ El subtítulo es obligatorio.");if(!p&&!l.imagen_principal)return alert("⚠️ La imagen principal es obligatoria para crear.");const _=l.parrafos.filter(B=>B.trim());if(_.length===0)return alert("⚠️ Debe haber al menos un párrafo con contenido.");const I=/^[a-z0-9]+(?:-[a-z0-9]+)*$/;if(l.link&&!I.test(l.link))return alert("⚠️ El link debe ser URL-friendly (solo minúsculas, guiones y números).");try{k(!0);const B=localStorage.getItem("token"),L=new FormData;L.append("producto_id",l.producto_id),L.append("subtitulo",l.subtitulo),L.append("url_video",l.url_video),l.link?.trim()&&L.append("link",l.link.trim());const ne={meta_titulo:l.meta_titulo?.trim()||"",meta_descripcion:l.meta_descripcion?.trim()||""};(ne.meta_titulo||ne.meta_descripcion)&&L.append("etiqueta",JSON.stringify(ne)),l.text_alt_principal?.trim()&&L.append("text_alt_principal",l.text_alt_principal.trim()),l.alt_imagen_card?.trim()&&L.append("alt_imagen_card",l.alt_imagen_card.trim()),l.imagen_principal&&L.append("imagen_principal",l.imagen_principal),l.imagenes_secundarias.filter(z=>z!==null).forEach(z=>L.append("imagenes[]",z)),l.alt_imagenes_secundarias.forEach((z,V)=>{(l.imagenes_secundarias[V]!==null||p&&z.trim())&&L.append("alt_imagenes[]",z.trim())}),_.forEach(z=>L.append("parrafos[]",z.trim()));const ge=p?G(J.endpoints.blogs.update(r.id)):G(J.endpoints.blogs.create);p&&L.append("_method","PUT");const X=await fetch(ge,{method:"POST",body:L,headers:{Authorization:`Bearer ${B}`,Accept:"application/json"}});let T;try{T=await X.json()}catch{T=await X.text()}if(X.ok)alert(`✅ Blog ${p?"actualizado":"creado"} correctamente.`),$(),n?.();else if(T.errors){let z=`❌ Errores de validación:
`;Object.keys(T.errors).forEach(V=>{const be=Array.isArray(T.errors[V])?T.errors[V]:[T.errors[V]];z+=`• ${V}: ${be.join(", ")}
`}),alert(z)}else alert(`❌ Error (${X.status}): ${T.message||JSON.stringify(T)}`)}catch(B){console.error("❌ Error en la solicitud:",B),alert("❌ Error en la conexión con el servidor.")}finally{k(!1)}};return a?t.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:t.jsxs("div",{className:"bg-white text-black px-4 sm:px-6 md:px-8 py-6 rounded-lg max-h-[90vh] w-full max-w-5xl mx-2 overflow-y-auto",children:[t.jsx("h2",{className:"text-2xl font-bold mb-6 text-center md:text-left",children:r?"Editar Blog":"Añadir Blog"}),t.jsxs("form",{onSubmit:D,encType:"multipart/form-data",className:"space-y-8",children:[t.jsxs("div",{className:"bg-blue-50 p-4 sm:p-6 rounded-lg border border-blue-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"Información Principal & SEO"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"col-span-1 md:col-span-4",children:[t.jsxs("label",{className:"block mb-2 font-medium",children:["Producto ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("select",{name:"producto_id",value:l.producto_id,onChange:q,required:!0,className:"w-full bg-white text-black p-2 rounded-md border border-gray-300",disabled:s,children:[t.jsx("option",{value:"",children:s?"Cargando productos...":"-- Selecciona un producto --"}),b.map(f=>t.jsx("option",{value:f.id.toString(),children:f.nombre||`Producto ${f.id}`},f.id))]}),t.jsx("small",{className:"text-gray-500",children:"Selecciona el producto relacionado con este blog. Requerido."}),h&&t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Producto seleccionado: ",t.jsx("strong",{children:h})]})]}),t.jsxs("div",{className:"col-span-1 md:col-span-2",children:[t.jsxs("label",{className:"block font-medium mb-1",children:["Subtítulo ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{name:"subtitulo",value:l.subtitulo,onChange:g,className:"w-full border border-gray-300 rounded px-3 py-2",required:!0}),t.jsx("small",{className:"text-gray-500 block mt-1",children:"Máx. 120 caracteres (letras, números y espacios)."})]}),t.jsxs("div",{className:"col-span-1 md:col-span-2",children:[t.jsx("label",{className:"block font-medium mb-1",children:"Meta título"}),t.jsx("input",{type:"text",name:"meta_titulo",value:l.meta_titulo||"",onChange:g,placeholder:"Título optimizado para SEO",className:"w-full border border-gray-300 rounded px-3 py-2"}),t.jsx("small",{className:"text-gray-500 block mt-1",children:"Máx. 70 caracteres (letras, números y espacios)."})]}),t.jsxs("div",{className:"col-span-1 md:col-span-2",children:[t.jsx("label",{className:"block font-medium mb-1",children:"Meta descripción"}),t.jsx("input",{type:"text",name:"meta_descripcion",value:l.meta_descripcion||"",onChange:g,placeholder:"Descripción optimizada para SEO",className:"w-full border border-gray-300 rounded px-3 py-2"}),t.jsx("small",{className:"text-gray-500 block mt-1",children:"Máx. 160 caracteres (letras, números y espacios)."})]}),t.jsxs("div",{className:"col-span-1 md:col-span-4",children:[t.jsx("label",{className:"block font-medium mb-1",children:"Link (URL amigable)"}),t.jsx("input",{type:"text",name:"link",value:l.link,onChange:g,placeholder:"ejemplo: mi-blog-post",className:"w-full border border-gray-300 rounded px-3 py-2"}),t.jsx("small",{className:"text-gray-500",children:"Escribe solo minúsculas y guiones. Máx. 255 letras o números."})]})]})]}),t.jsxs("div",{className:"bg-green-50 p-4 sm:p-6 rounded-lg border border-green-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-4",children:"Imágenes"}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"border border-green-400 rounded p-4",children:[t.jsxs("label",{className:"block font-medium mb-2",children:["Imagen Principal ",!r&&t.jsx("span",{className:"text-red-500",children:"*"})]}),r?.imagen_principal&&t.jsx("img",{src:r.imagen_principal,alt:l.text_alt_principal||"Imagen principal",className:"w-full h-48 sm:h-64 object-cover rounded mb-4 border"}),t.jsx("input",{type:"file",accept:"image/*",onChange:f=>R(f,"imagen_principal"),className:"w-full file:py-2 file:px-3 file:border-0 file:bg-green-100 file:text-green-700 hover:file:bg-green-200"}),t.jsx("small",{className:"text-gray-500",children:"Peso máximo: 2 MB."}),t.jsx("input",{type:"text",name:"text_alt_principal",placeholder:"Texto ALT para SEO",value:l.text_alt_principal,onChange:g,className:"mt-2 w-full border border-gray-300 rounded px-3 py-2"})]}),t.jsxs("div",{className:"border border-green-400 rounded p-4",children:[t.jsx("label",{className:"block font-semibold mb-4",children:"Imágenes Secundarias"}),t.jsx("small",{className:"text-gray-500",children:"Imágenes adicionales del artículo. Se creará un registro por archivo en la tabla imagen_blogs."}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:l.imagenes_secundarias.map((f,p)=>t.jsxs("div",{className:"flex flex-col items-center",children:[r?.imagenes?.[p]?.ruta_imagen&&t.jsx("img",{src:r.imagenes[p].ruta_imagen,alt:l.alt_imagenes_secundarias[p]||`Imagen secundaria #${p+1}`,className:"w-full h-32 object-cover rounded mb-2 border"}),t.jsx("input",{type:"file",accept:"image/*",onChange:_=>M(_,p),className:"w-full file:py-2 file:px-3 file:border-0 file:bg-green-100 file:text-green-700 hover:file:bg-green-200"}),t.jsxs("small",{className:"text-gray-500",children:["Archivo de imagen secundaria #",p+1,".",t.jsx("br",{}),"Tamaño máximo: 2 MB."]}),t.jsx("input",{type:"text",placeholder:`Texto ALT imagen secundaria #${p+1}`,value:l.alt_imagenes_secundarias[p],onChange:_=>H(_,p),className:"w-full border border-gray-300 rounded px-3 py-2 mt-2"})]},p))})]})]})]}),t.jsxs("div",{className:"bg-purple-50 p-4 sm:p-6 rounded-lg border border-purple-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-4",children:"Video"}),t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL del Video *"}),t.jsx("input",{type:"url",name:"url_video",value:l.url_video,onChange:g,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),t.jsx("small",{className:"text-gray-500",children:"Solo minúsculas y guiones. Hasta 255 letras, números o espacios."})]}),t.jsxs("div",{className:"bg-yellow-50 p-4 sm:p-6 rounded-lg border border-yellow-200",children:[t.jsxs("h3",{className:"text-lg font-semibold text-yellow-800 mb-4",children:["Párrafos ",t.jsx("span",{className:"text-red-500",children:"*"})]}),l.parrafos.map((f,p)=>t.jsxs("div",{className:"relative mb-6",children:[t.jsx("textarea",{id:`parrafo-${p}`,value:f,onChange:_=>Z(_,p),className:"w-full border border-gray-300 rounded px-3 py-2 pr-20",rows:4,placeholder:`Párrafo ${p+1} (opcional)`}),t.jsx("small",{className:"text-gray-500",children:"Máx. 100 caracteres (letras, números y espacios)."}),t.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[t.jsx("button",{type:"button",onClick:()=>Q(p),className:"bg-blue-500 hover:bg-blue-700 text-white p-2 rounded-full shadow-lg transition",children:"🔗"}),t.jsx("button",{type:"button",onClick:()=>ae(p),className:"bg-green-500 hover:bg-green-700 text-white p-2 rounded-full shadow-lg transition",children:"🛒"})]})]},p))]}),t.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4",children:[t.jsx("button",{type:"button",onClick:$,className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",disabled:s,children:"Cancelar"}),t.jsx("button",{type:"submit",disabled:s,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded disabled:opacity-50",children:s?"Procesando...":r?"Actualizar":"Crear"})]})]}),u&&t.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-[60]",children:t.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[t.jsx("h3",{className:"text-lg font-bold mb-4",children:"Insertar Enlace"}),t.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Texto seleccionado: ",t.jsxs("strong",{children:['"',m,'"']})]}),t.jsx("input",{type:"url",value:o,onChange:f=>S(f.target.value),placeholder:"https://ejemplo.com",className:"w-full border border-gray-300 rounded px-3 py-2 mb-4",required:!0}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:()=>v(!1),className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",children:"Cancelar"}),t.jsx("button",{type:"button",onClick:te,disabled:!o.trim(),className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-300 text-white px-4 py-2 rounded",children:"Insertar"})]})]})}),j&&t.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-[60]",children:t.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[t.jsx("h3",{className:"text-lg font-bold mb-4",children:"Enlazar a Producto"}),t.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Texto seleccionado: ",t.jsxs("strong",{children:['"',m,'"']})]}),t.jsxs("select",{onChange:f=>{const p=parseInt(f.target.value),_=b.find(I=>I.id===p);_&&re(_)},className:"w-full border border-gray-300 rounded px-3 py-2 mb-4",children:[t.jsx("option",{value:"",children:"-- Seleccionar producto --"}),b.map(f=>t.jsx("option",{value:f.id,children:f.nombre},f.id))]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{type:"button",onClick:()=>E(!1),className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",children:"Cancelar"})})]})})]})}):null},oe=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopedSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideNextClass","slidePrevClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function F(a){return typeof a=="object"&&a!==null&&a.constructor&&Object.prototype.toString.call(a).slice(8,-1)==="Object"&&!a.__swiper__}function U(a,e){const r=["__proto__","constructor","prototype"];Object.keys(e).filter(n=>r.indexOf(n)<0).forEach(n=>{typeof a[n]>"u"?a[n]=e[n]:F(e[n])&&F(a[n])&&Object.keys(e[n]).length>0?e[n].__swiper__?a[n]=e[n]:U(a[n],e[n]):a[n]=e[n]})}function ce(a){return a===void 0&&(a={}),a.navigation&&typeof a.navigation.nextEl>"u"&&typeof a.navigation.prevEl>"u"}function de(a){return a===void 0&&(a={}),a.pagination&&typeof a.pagination.el>"u"}function ue(a){return a===void 0&&(a={}),a.scrollbar&&typeof a.scrollbar.el>"u"}function pe(a){a===void 0&&(a="");const e=a.split(" ").map(n=>n.trim()).filter(n=>!!n),r=[];return e.forEach(n=>{r.indexOf(n)<0&&r.push(n)}),r.join(" ")}function Se(a){return a===void 0&&(a=""),a?a.includes("swiper-wrapper")?a:`swiper-wrapper ${a}`:"swiper-wrapper"}function Ce(a){let{swiper:e,slides:r,passedParams:n,changedParams:b,nextEl:d,prevEl:h,scrollbarEl:w,paginationEl:s}=a;const k=b.filter(g=>g!=="children"&&g!=="direction"&&g!=="wrapperClass"),{params:u,pagination:v,navigation:N,scrollbar:C,virtual:O,thumbs:c}=e;let m,i,j,E,o,S,y,l;b.includes("thumbs")&&n.thumbs&&n.thumbs.swiper&&u.thumbs&&!u.thumbs.swiper&&(m=!0),b.includes("controller")&&n.controller&&n.controller.control&&u.controller&&!u.controller.control&&(i=!0),b.includes("pagination")&&n.pagination&&(n.pagination.el||s)&&(u.pagination||u.pagination===!1)&&v&&!v.el&&(j=!0),b.includes("scrollbar")&&n.scrollbar&&(n.scrollbar.el||w)&&(u.scrollbar||u.scrollbar===!1)&&C&&!C.el&&(E=!0),b.includes("navigation")&&n.navigation&&(n.navigation.prevEl||h)&&(n.navigation.nextEl||d)&&(u.navigation||u.navigation===!1)&&N&&!N.prevEl&&!N.nextEl&&(o=!0);const P=g=>{e[g]&&(e[g].destroy(),g==="navigation"?(e.isElement&&(e[g].prevEl.remove(),e[g].nextEl.remove()),u[g].prevEl=void 0,u[g].nextEl=void 0,e[g].prevEl=void 0,e[g].nextEl=void 0):(e.isElement&&e[g].el.remove(),u[g].el=void 0,e[g].el=void 0))};b.includes("loop")&&e.isElement&&(u.loop&&!n.loop?S=!0:!u.loop&&n.loop?y=!0:l=!0),k.forEach(g=>{if(F(u[g])&&F(n[g]))U(u[g],n[g]),(g==="navigation"||g==="pagination"||g==="scrollbar")&&"enabled"in n[g]&&!n[g].enabled&&P(g);else{const q=n[g];(q===!0||q===!1)&&(g==="navigation"||g==="pagination"||g==="scrollbar")?q===!1&&P(g):u[g]=n[g]}}),k.includes("controller")&&!i&&e.controller&&e.controller.control&&u.controller&&u.controller.control&&(e.controller.control=u.controller.control),b.includes("children")&&r&&O&&u.virtual.enabled&&(O.slides=r,O.update(!0)),b.includes("children")&&r&&u.loop&&(l=!0),m&&c.init()&&c.update(!0),i&&(e.controller.control=u.controller.control),j&&(e.isElement&&(!s||typeof s=="string")&&(s=document.createElement("div"),s.classList.add("swiper-pagination"),s.part.add("pagination"),e.el.appendChild(s)),s&&(u.pagination.el=s),v.init(),v.render(),v.update()),E&&(e.isElement&&(!w||typeof w=="string")&&(w=document.createElement("div"),w.classList.add("swiper-scrollbar"),w.part.add("scrollbar"),e.el.appendChild(w)),w&&(u.scrollbar.el=w),C.init(),C.updateSize(),C.setTranslate()),o&&(e.isElement&&((!d||typeof d=="string")&&(d=document.createElement("div"),d.classList.add("swiper-button-next"),d.innerHTML=e.hostEl.constructor.nextButtonSvg,d.part.add("button-next"),e.el.appendChild(d)),(!h||typeof h=="string")&&(h=document.createElement("div"),h.classList.add("swiper-button-prev"),h.innerHTML=e.hostEl.constructor.prevButtonSvg,h.part.add("button-prev"),e.el.appendChild(h))),d&&(u.navigation.nextEl=d),h&&(u.navigation.prevEl=h),N.init(),N.update()),b.includes("allowSlideNext")&&(e.allowSlideNext=n.allowSlideNext),b.includes("allowSlidePrev")&&(e.allowSlidePrev=n.allowSlidePrev),b.includes("direction")&&e.changeDirection(n.direction,!1),(S||l)&&e.loopDestroy(),(y||l)&&e.loopCreate(),e.update()}function Pe(a,e){a===void 0&&(a={}),e===void 0&&(e=!0);const r={on:{}},n={},b={};U(r,we),r._emitClasses=!0,r.init=!1;const d={},h=oe.map(s=>s.replace(/_/,"")),w=Object.assign({},a);return Object.keys(w).forEach(s=>{typeof a[s]>"u"||(h.indexOf(s)>=0?F(a[s])?(r[s]={},b[s]={},U(r[s],a[s]),U(b[s],a[s])):(r[s]=a[s],b[s]=a[s]):s.search(/on[A-Z]/)===0&&typeof a[s]=="function"?e?n[`${s[2].toLowerCase()}${s.substr(3)}`]=a[s]:r.on[`${s[2].toLowerCase()}${s.substr(3)}`]=a[s]:d[s]=a[s])}),["navigation","pagination","scrollbar"].forEach(s=>{r[s]===!0&&(r[s]={}),r[s]===!1&&delete r[s]}),{params:r,passedParams:b,rest:d,events:n}}function ke(a,e){let{el:r,nextEl:n,prevEl:b,paginationEl:d,scrollbarEl:h,swiper:w}=a;ce(e)&&n&&b&&(w.params.navigation.nextEl=n,w.originalParams.navigation.nextEl=n,w.params.navigation.prevEl=b,w.originalParams.navigation.prevEl=b),de(e)&&d&&(w.params.pagination.el=d,w.originalParams.pagination.el=d),ue(e)&&h&&(w.params.scrollbar.el=h,w.originalParams.scrollbar.el=h),w.init(r)}function Ie(a,e,r,n,b){const d=[];if(!e)return d;const h=s=>{d.indexOf(s)<0&&d.push(s)};if(r&&n){const s=n.map(b),k=r.map(b);s.join("")!==k.join("")&&h("children"),n.length!==r.length&&h("children")}return oe.filter(s=>s[0]==="_").map(s=>s.replace(/_/,"")).forEach(s=>{if(s in a&&s in e)if(F(a[s])&&F(e[s])){const k=Object.keys(a[s]),u=Object.keys(e[s]);k.length!==u.length?h(s):(k.forEach(v=>{a[s][v]!==e[s][v]&&h(s)}),u.forEach(v=>{a[s][v]!==e[s][v]&&h(s)}))}else a[s]!==e[s]&&h(s)}),d}const Oe=a=>{!a||a.destroyed||!a.params.virtual||a.params.virtual&&!a.params.virtual.enabled||(a.updateSlides(),a.updateProgress(),a.updateSlidesClasses(),a.parallax&&a.params.parallax&&a.params.parallax.enabled&&a.parallax.setTranslate())};function ee(){return ee=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(a[n]=r[n])}return a},ee.apply(this,arguments)}function fe(a){return a.type&&a.type.displayName&&a.type.displayName.includes("SwiperSlide")}function me(a){const e=[];return A.Children.toArray(a).forEach(r=>{fe(r)?e.push(r):r.props&&r.props.children&&me(r.props.children).forEach(n=>e.push(n))}),e}function Ae(a){const e=[],r={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return A.Children.toArray(a).forEach(n=>{if(fe(n))e.push(n);else if(n.props&&n.props.slot&&r[n.props.slot])r[n.props.slot].push(n);else if(n.props&&n.props.children){const b=me(n.props.children);b.length>0?b.forEach(d=>e.push(d)):r["container-end"].push(n)}else r["container-end"].push(n)}),{slides:e,slots:r}}function $e(a,e,r){if(!r)return null;const n=u=>{let v=u;return u<0?v=e.length+u:v>=e.length&&(v=v-e.length),v},b=a.isHorizontal()?{[a.rtlTranslate?"right":"left"]:`${r.offset}px`}:{top:`${r.offset}px`},{from:d,to:h}=r,w=a.params.loop?-e.length:0,s=a.params.loop?e.length*2:e.length,k=[];for(let u=w;u<s;u+=1)u>=d&&u<=h&&k.push(e[n(u)]);return k.map((u,v)=>A.cloneElement(u,{swiper:a,style:b,key:`slide-${v}`}))}function K(a,e){return typeof window>"u"?x.useEffect(a,e):x.useLayoutEffect(a,e)}const ie=x.createContext(null),Le=x.createContext(null),se=x.forwardRef(function(a,e){let{className:r,tag:n="div",wrapperTag:b="div",children:d,onSwiper:h,...w}=a===void 0?{}:a,s=!1;const[k,u]=x.useState("swiper"),[v,N]=x.useState(null),[C,O]=x.useState(!1),c=x.useRef(!1),m=x.useRef(null),i=x.useRef(null),j=x.useRef(null),E=x.useRef(null),o=x.useRef(null),S=x.useRef(null),y=x.useRef(null),l=x.useRef(null),{params:P,passedParams:g,rest:q,events:R}=Pe(w),{slides:M,slots:H}=Ae(d),Z=()=>{O(!C)};Object.assign(P.on,{_containerClasses($,D){u(D)}});const Q=()=>{Object.assign(P.on,R),s=!0;const $={...P};if(delete $.wrapperClass,i.current=new _e($),i.current.virtual&&i.current.params.virtual.enabled){i.current.virtual.slides=M;const D={cache:!1,slides:M,renderExternal:N,renderExternalUpdate:!1};U(i.current.params.virtual,D),U(i.current.originalParams.virtual,D)}};m.current||Q(),i.current&&i.current.on("_beforeBreakpoint",Z);const te=()=>{s||!R||!i.current||Object.keys(R).forEach($=>{i.current.on($,R[$])})},ae=()=>{!R||!i.current||Object.keys(R).forEach($=>{i.current.off($,R[$])})};x.useEffect(()=>()=>{i.current&&i.current.off("_beforeBreakpoint",Z)}),x.useEffect(()=>{!c.current&&i.current&&(i.current.emitSlidesClasses(),c.current=!0)}),K(()=>{if(e&&(e.current=m.current),!!m.current)return i.current.destroyed&&Q(),ke({el:m.current,nextEl:o.current,prevEl:S.current,paginationEl:y.current,scrollbarEl:l.current,swiper:i.current},P),h&&h(i.current),()=>{i.current&&!i.current.destroyed&&i.current.destroy(!0,!1)}},[]),K(()=>{te();const $=Ie(g,j.current,M,E.current,D=>D.key);return j.current=g,E.current=M,$.length&&i.current&&!i.current.destroyed&&Ce({swiper:i.current,slides:M,passedParams:g,changedParams:$,nextEl:o.current,prevEl:S.current,scrollbarEl:l.current,paginationEl:y.current}),()=>{ae()}}),K(()=>{Oe(i.current)},[v]);function re(){return P.virtual?$e(i.current,M,v):M.map(($,D)=>A.cloneElement($,{swiper:i.current,swiperSlideIndex:D}))}return A.createElement(n,ee({ref:m,className:pe(`${k}${r?` ${r}`:""}`)},q),A.createElement(Le.Provider,{value:i.current},H["container-start"],A.createElement(b,{className:Se(P.wrapperClass)},H["wrapper-start"],re(),H["wrapper-end"]),ce(P)&&A.createElement(A.Fragment,null,A.createElement("div",{ref:S,className:"swiper-button-prev"}),A.createElement("div",{ref:o,className:"swiper-button-next"})),ue(P)&&A.createElement("div",{ref:l,className:"swiper-scrollbar"}),de(P)&&A.createElement("div",{ref:y,className:"swiper-pagination"}),H["container-end"]))});se.displayName="Swiper";const W=x.forwardRef(function(a,e){let{tag:r="div",children:n,className:b="",swiper:d,zoom:h,lazy:w,virtualIndex:s,swiperSlideIndex:k,...u}=a===void 0?{}:a;const v=x.useRef(null),[N,C]=x.useState("swiper-slide"),[O,c]=x.useState(!1);function m(o,S,y){S===v.current&&C(y)}K(()=>{if(typeof k<"u"&&(v.current.swiperSlideIndex=k),e&&(e.current=v.current),!(!v.current||!d)){if(d.destroyed){N!=="swiper-slide"&&C("swiper-slide");return}return d.on("_slideClass",m),()=>{d&&d.off("_slideClass",m)}}}),K(()=>{d&&v.current&&!d.destroyed&&C(d.getSlideClasses(v.current))},[d]);const i={isActive:N.indexOf("swiper-slide-active")>=0,isVisible:N.indexOf("swiper-slide-visible")>=0,isPrev:N.indexOf("swiper-slide-prev")>=0,isNext:N.indexOf("swiper-slide-next")>=0},j=()=>typeof n=="function"?n(i):n,E=()=>{c(!0)};return A.createElement(r,ee({ref:v,className:pe(`${N}${b?` ${b}`:""}`),"data-swiper-slide-index":s,onLoad:E},u),h&&A.createElement(ie.Provider,{value:i},A.createElement("div",{className:"swiper-zoom-container","data-swiper-zoom":typeof h=="number"?h:void 0},j(),w&&!O&&A.createElement("div",{className:"swiper-lazy-preloader"}))),!h&&A.createElement(ie.Provider,{value:i},j(),w&&!O&&A.createElement("div",{className:"swiper-lazy-preloader"})))});W.displayName="SwiperSlide";function Be(a){let{swiper:e,extendParams:r,on:n,emit:b}=a;r({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),e.navigation={nextEl:null,prevEl:null};const d=c=>(Array.isArray(c)?c:[c]).filter(m=>!!m);function h(c){let m;return c&&typeof c=="string"&&e.isElement&&(m=e.el.querySelector(c),m)?m:(c&&(typeof c=="string"&&(m=[...document.querySelectorAll(c)]),e.params.uniqueNavElements&&typeof c=="string"&&m.length>1&&e.el.querySelectorAll(c).length===1&&(m=e.el.querySelector(c))),c&&!m?c:m)}function w(c,m){const i=e.params.navigation;c=d(c),c.forEach(j=>{j&&(j.classList[m?"add":"remove"](...i.disabledClass.split(" ")),j.tagName==="BUTTON"&&(j.disabled=m),e.params.watchOverflow&&e.enabled&&j.classList[e.isLocked?"add":"remove"](i.lockClass))})}function s(){const{nextEl:c,prevEl:m}=e.navigation;if(e.params.loop){w(m,!1),w(c,!1);return}w(m,e.isBeginning&&!e.params.rewind),w(c,e.isEnd&&!e.params.rewind)}function k(c){c.preventDefault(),!(e.isBeginning&&!e.params.loop&&!e.params.rewind)&&(e.slidePrev(),b("navigationPrev"))}function u(c){c.preventDefault(),!(e.isEnd&&!e.params.loop&&!e.params.rewind)&&(e.slideNext(),b("navigationNext"))}function v(){const c=e.params.navigation;if(e.params.navigation=je(e,e.originalParams.navigation,e.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(c.nextEl||c.prevEl))return;let m=h(c.nextEl),i=h(c.prevEl);Object.assign(e.navigation,{nextEl:m,prevEl:i}),m=d(m),i=d(i);const j=(E,o)=>{E&&E.addEventListener("click",o==="next"?u:k),!e.enabled&&E&&E.classList.add(...c.lockClass.split(" "))};m.forEach(E=>j(E,"next")),i.forEach(E=>j(E,"prev"))}function N(){let{nextEl:c,prevEl:m}=e.navigation;c=d(c),m=d(m);const i=(j,E)=>{j.removeEventListener("click",E==="next"?u:k),j.classList.remove(...e.params.navigation.disabledClass.split(" "))};c.forEach(j=>i(j,"next")),m.forEach(j=>i(j,"prev"))}n("init",()=>{e.params.navigation.enabled===!1?O():(v(),s())}),n("toEdge fromEdge lock unlock",()=>{s()}),n("destroy",()=>{N()}),n("enable disable",()=>{let{nextEl:c,prevEl:m}=e.navigation;if(c=d(c),m=d(m),e.enabled){s();return}[...c,...m].filter(i=>!!i).forEach(i=>i.classList.add(e.params.navigation.lockClass))}),n("click",(c,m)=>{let{nextEl:i,prevEl:j}=e.navigation;i=d(i),j=d(j);const E=m.target;if(e.params.navigation.hideOnClick&&!j.includes(E)&&!i.includes(E)){if(e.pagination&&e.params.pagination&&e.params.pagination.clickable&&(e.pagination.el===E||e.pagination.el.contains(E)))return;let o;i.length?o=i[0].classList.contains(e.params.navigation.hiddenClass):j.length&&(o=j[0].classList.contains(e.params.navigation.hiddenClass)),b(o===!0?"navigationShow":"navigationHide"),[...i,...j].filter(S=>!!S).forEach(S=>S.classList.toggle(e.params.navigation.hiddenClass))}});const C=()=>{e.el.classList.remove(...e.params.navigation.navigationDisabledClass.split(" ")),v(),s()},O=()=>{e.el.classList.add(...e.params.navigation.navigationDisabledClass.split(" ")),N()};Object.assign(e.navigation,{enable:C,disable:O,update:s,init:v,destroy:N})}const We=()=>{const[a,e]=x.useState([]),[r,n]=x.useState(1),b=5,[d,h]=x.useState({current_page:1,last_page:1,per_page:b,total:0}),[w,s]=x.useState(null),[k,u]=x.useState(!0),[v,N]=x.useState(!1),{darkMode:C}=Ee(),O=async(o=1)=>{u(!0);try{const S=localStorage.getItem("token"),y=await fetch(`${G(J.endpoints.blogs.list)}?page=${o}&per_page=${b}`,{headers:{Authorization:`Bearer ${S}`,Accept:"application/json"}});if(!y.ok)throw new Error(`HTTP error! status: ${y.status}`);const l=await y.json();l.success&&l.data&&Array.isArray(l.data.data)?(e(l.data.data),h({current_page:l.data.current_page??o,last_page:l.data.last_page,per_page:l.data.per_page,total:l.data.total})):e([])}catch(S){console.error("❌ Error al cargar datos:",S),e([])}finally{u(!1)}};x.useEffect(()=>{O(r)},[r]);const c=o=>{o>=1&&o<=d.last_page&&n(o)},m=async o=>{const S=localStorage.getItem("token");if(window.confirm("¿Estás seguro de que deseas eliminar este blog?"))try{const l=await fetch(G(J.endpoints.blogs.delete(o)),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`}});if(l.ok)O(r),alert("✅ Blog eliminado exitosamente");else{const P=await l.json().catch(()=>({}));alert(`❌ Error al eliminar el blog: ${P.message||"Error desconocido"}`)}}catch{alert("❌ Error al conectar con el servidor")}},i=o=>o?o.startsWith("http")?o:`https://apiyuntas.yuntaspublicidad.com${o}`:"/placeholder-image.jpg",j=(o,S=50)=>o?o.length>S?o.substring(0,S)+"...":o:"",E=()=>{s(null),N(!0)};return t.jsxs("div",{className:"overflow-x-auto p-2 sm:p-4",children:[t.jsxs(ve,{tableType:"blogs",exportData:a,onAddNew:E,children:[t.jsx("thead",{className:"hidden md:table-header-group",children:t.jsx("tr",{className:"bg-blue-950 text-white",children:["ID","PRODUCTO","SUBTÍTULO","IMAGEN","FECHA","ACCIÓN"].map(o=>t.jsx("th",{className:`px-4 py-2 text-white uppercase text-xs font-bold rounded-md ${C?"bg-cyan-900":"bg-cyan-400"}`,children:o},o))})}),t.jsx("tbody",{children:k?t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-500 block md:table-cell",children:"Cargando blogs..."})}):a.length>0?a.map((o,S)=>t.jsxs("tr",{className:`md:table-row block md:mb-0 mb-6 rounded-xl shadow-md overflow-hidden border ${S%2===0&&C?"bg-white text-black":"text-black bg-white"}`,children:[t.jsx("td",{"data-label":"ID",className:`block md:table-cell px-4 py-2 border-b font-bold before:content-['ID'] before:font-semibold before:block md:before:hidden ${C?"bg-gray-300":""}`,children:o.id}),t.jsx("td",{"data-label":"Producto",className:`block md:table-cell px-4 py-2 border-b font-semibold before:content-['Producto'] before:font-semibold before:block md:before:hidden ${C?"bg-gray-300":""}`,children:j(o.nombre_producto||"Sin nombre",30)}),t.jsx("td",{"data-label":"Subtítulo",className:`block md:table-cell px-4 py-2 border-b before:content-['Subtítulo'] before:font-semibold before:block md:before:hidden ${C?"bg-gray-300":""}`,children:j(o.subtitulo,40)}),t.jsxs("td",{"data-label":"Imagen",className:`block md:table-cell px-4 py-2 border-b border-gray-200 relative md:static before:content-['Imagen'] before:font-semibold before:block md:before:hidden ${C?"bg-gray-300":""}`,children:[t.jsx("div",{className:"block md:hidden w-full",children:t.jsxs(se,{modules:[Be,le],spaceBetween:10,slidesPerView:1,pagination:{clickable:!0},navigation:!0,className:"w-full max-w-[320px] rounded-lg shadow-md",children:[t.jsx(W,{children:t.jsx("img",{src:i(o.imagen_principal),alt:o.nombre_producto||"Blog",className:"w-full h-48 object-cover rounded-lg"})}),o.imagenes?.map((y,l)=>t.jsx(W,{children:t.jsx("img",{src:i(y.ruta_imagen),alt:y.text_alt||"Imagen extra",className:"w-full h-48 object-cover rounded-lg"})},l))]})}),t.jsx("div",{className:"hidden md:block w-full",children:!o.imagenes||o.imagenes.length===0?t.jsx("img",{src:i(o.imagen_principal),alt:o.nombre_producto||"Blog",className:"w-full max-w-[120px] h-20 object-cover rounded-lg shadow-md",onError:y=>{const l=y.target;l.src="/placeholder-image.jpg"}}):t.jsxs(se,{modules:[le,ye],spaceBetween:10,slidesPerView:1,loop:o.imagenes.length>=3,rewind:o.imagenes.length===2,autoplay:{delay:2e3,disableOnInteraction:!1},pagination:{clickable:!0},className:"w-full max-w-[120px] h-20 rounded-lg shadow-md",children:[t.jsx(W,{children:t.jsx("img",{src:i(o.imagen_principal),alt:o.nombre_producto||"Blog",className:"w-full h-20 object-cover rounded-lg",onError:y=>{const l=y.target;l.src="/placeholder-image.jpg"}})}),o.imagenes.map((y,l)=>t.jsx(W,{children:t.jsx("img",{src:i(y.ruta_imagen),alt:y.text_alt||"Imagen extra",className:"w-full h-20 object-cover rounded-lg",onError:P=>{const g=P.target;g.src="/placeholder-image.jpg"}})},l))]})})]}),t.jsx("td",{"data-label":"Fecha",className:`block md:table-cell px-4 py-2 border-b text-sm before:content-['Fecha'] before:font-semibold before:block md:before:hidden ${C?"bg-gray-300":""}`,children:o.created_at?new Date(o.created_at).toLocaleDateString("es-ES"):"N/A"}),t.jsx("td",{"data-label":"Acción",className:`block md:table-cell px-4 py-3 border-b before:content-['Acción'] before:font-semibold before:block md:before:hidden ${C?"bg-gray-300":""}`,children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-3 mt-2 sm:mt-0",children:[t.jsxs("button",{className:"flex items-center justify-center gap-2 p-2 text-red-600 hover:text-red-800 transition bg-red-100 rounded-lg shadow-sm",title:"Eliminar",onClick:()=>m(o.id),children:[t.jsx(xe,{size:18}),t.jsx("span",{className:"md:hidden font-medium",children:"Borrar"})]}),t.jsxs("button",{className:"flex items-center justify-center gap-2 p-2 text-yellow-600 hover:text-yellow-800 transition bg-yellow-100 rounded-lg shadow-sm",title:"Editar",onClick:()=>{s(o),N(!0)},children:[t.jsx(he,{size:18}),t.jsx("span",{className:"md:hidden font-medium",children:"Editar"})]})]})})]},o.id)):t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-500",children:"No hay blogs disponibles"})})})]}),d.last_page>1&&t.jsxs("div",{className:"flex flex-wrap justify-center items-center mt-4 gap-2",children:[t.jsx("button",{onClick:()=>c(r-1),disabled:r===1,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-800 transition-colors",children:"Anterior"}),Array.from({length:d.last_page},(o,S)=>{const y=S+1;return t.jsx("button",{onClick:()=>c(y),className:`px-3 py-2 rounded-md ${r===y?"bg-blue-950 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:y},y)}),t.jsx("button",{onClick:()=>c(r+1),disabled:r===d.last_page,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-800 transition-colors",children:"Siguiente"})]}),t.jsx("button",{onClick:E,className:"mt-4 mb-6 bg-blue-950 hover:bg-blue-800 text-white text-lg px-8 sm:px-10 py-2 rounded-full w-full sm:w-auto",children:"Añadir Blog"}),t.jsx(Ne,{isOpen:v,setIsOpen:N,blogToEdit:w,onSuccess:()=>{s(null),N(!1),O(r)}})]})};export{We as default};
