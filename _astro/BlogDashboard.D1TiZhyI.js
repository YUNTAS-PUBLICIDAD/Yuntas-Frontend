import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as f}from"./index.ai7qpRr1.js";import{h as j}from"./httpService.KKQD0fA1.js";import{c as C}from"./config.DqK_gEEU.js";class S{getAllBlogs(){return j.get(C.endpoints.blogs.list)}getBlogByLink(r){return j.get(`/api/blogs/link/${r}`)}createBlog(r){const a=this._buildCreateFormData(r);return j.authenticatedPostFormData(C.endpoints.blogs.create,a)}updateBlog(r,a){const s=this._buildUpdateFormData(a);return s.append("_method","PATCH"),j.authenticatedPostFormData(`/api/blogs/${r}`,s)}deleteBlog(r){return j.authenticatedDelete(`/api/blogs/${r}`)}_buildCreateFormData(r){const a=new FormData;return a.append("producto_id",r.producto_id||""),a.append("subtitulo",r.subtitulo||""),a.append("meta_titulo",r.meta_titulo||""),a.append("meta_descripcion",r.meta_descripcion||""),a.append("link",r.link||""),a.append("url_video",r.url_video||""),r.parrafos&&r.parrafos.length>0&&r.parrafos.forEach((s,o)=>{a.append(`parrafos[${o}]`,s.texto)}),r.imagen_principal&&a.append("imagen_principal",r.imagen_principal),r.alt_imagen_principal&&a.append("text_alt_principal",r.alt_imagen_principal),r.imagenes_secundarias&&r.imagenes_secundarias.length>0&&r.imagenes_secundarias.forEach((s,o)=>{s.archivo&&(a.append(`imagenes[${o}]`,s.archivo),a.append(`alt_imagenes[${o}]`,s.alt||""))}),a}_buildUpdateFormData(r){const a=new FormData;return a.append("producto_id",r.producto_id||""),a.append("subtitulo",r.subtitulo||""),a.append("meta_titulo",r.meta_titulo||""),a.append("meta_descripcion",r.meta_descripcion||""),a.append("link",r.link||""),a.append("url_video",r.url_video||""),r.parrafos&&r.parrafos.length>0&&r.parrafos.forEach((s,o)=>{a.append(`parrafos[${o}]`,s.texto)}),r.alt_imagen_principal&&a.append("text_alt_principal",r.alt_imagen_principal),r.imagen_principal instanceof File&&a.append("imagen_principal",r.imagen_principal),r.imagenes_secundarias&&r.imagenes_secundarias.length>0&&r.imagenes_secundarias.forEach((s,o)=>{s.archivo instanceof File&&a.append(`imagenes[${o}]`,s.archivo),a.append(`alt_imagenes[${o}]`,s.alt||"")}),a}generateLinkFromTitle(r){return r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim()}}const w=new S;function F(){const[y,r]=f.useState([]),[a,s]=f.useState(!0),[o,b]=f.useState(null),h=async()=>{try{s(!0),b(null);const c=await w.getAllBlogs();r(c.data)}catch(c){b(c instanceof Error?c.message:"Error desconocido al obtener blogs"),console.error("Error en useBlogs:",c)}finally{s(!1)}},d=async()=>{await h()};return f.useEffect(()=>{h()},[]),{blogs:y,loading:a,error:o,refetch:d}}function D(){const[y,r]=f.useState(!1),[a,s]=f.useState(null);return{loading:y,error:a,createBlog:async c=>{try{return r(!0),s(null),(await w.createBlog(c)).data}catch(t){const i=t instanceof Error?t.message:"Error desconocido al crear el blog";return s(i),console.error("Error creando blog:",t),null}finally{r(!1)}},updateBlog:async(c,t)=>{try{return r(!0),s(null),(await w.updateBlog(c,t)).data}catch(i){const x=i instanceof Error?i.message:"Error desconocido al actualizar el blog";return s(x),console.error("Error actualizando blog:",i),null}finally{r(!1)}},deleteBlog:async c=>{try{return r(!0),s(null),await w.deleteBlog(c),!0}catch(t){const i=t instanceof Error?t.message:"Error desconocido al eliminar el blog";return s(i),console.error("Error eliminando blog:",t),!1}finally{r(!1)}},clearError:()=>s(null)}}class L{static MAX_FILE_SIZE=10*1024*1024;static ALLOWED_MIME_TYPES=["image/jpeg","image/jpg","image/png","image/webp"];static validateImage(r){return r?this.ALLOWED_MIME_TYPES.includes(r.type)?r.size>this.MAX_FILE_SIZE?{valid:!1,error:`El archivo es demasiado grande. Tamaño máximo: ${this.formatFileSize(this.MAX_FILE_SIZE)}`}:{valid:!0}:{valid:!1,error:`Tipo de archivo no permitido. Use: ${this.ALLOWED_MIME_TYPES.join(", ")}`}:{valid:!1,error:"No se ha seleccionado ningún archivo"}}static formatFileSize(r){if(r===0)return"0 Bytes";const a=1024,s=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(r)/Math.log(a));return parseFloat((r/Math.pow(a,o)).toFixed(2))+" "+s[o]}static createPreviewUrl(r){return r&&r.type.startsWith("image/")?URL.createObjectURL(r):null}static revokePreviewUrl(r){r&&URL.revokeObjectURL(r)}static async resizeImage(r,a=1920,s=1080,o=.8){return new Promise((b,h)=>{const d=document.createElement("canvas"),c=d.getContext("2d"),t=new Image;t.onload=()=>{let{width:i,height:x}=t;if(i>a||x>s){const u=Math.min(a/i,s/x);i*=u,x*=u}d.width=i,d.height=x,c?.drawImage(t,0,0,i,x),d.toBlob(u=>{if(u){const m=new File([u],r.name,{type:r.type,lastModified:Date.now()});b(m)}else h(new Error("Error al redimensionar la imagen"))},r.type,o)},t.onerror=()=>h(new Error("Error al cargar la imagen")),t.src=URL.createObjectURL(r)})}static generateUniqueFileName(r){const a=Date.now(),s=Math.random().toString(36).substring(2,15),o=r.split(".").pop();return`${a}_${s}.${o}`}static async extractImageMetadata(r){return new Promise((a,s)=>{const o=new Image;o.onload=()=>{a({width:o.naturalWidth,height:o.naturalHeight,size:r.size,type:r.type,name:r.name})},o.onerror=()=>s(new Error("Error al cargar la imagen")),o.src=URL.createObjectURL(r)})}}const I=({isOpen:y,onClose:r,blogToEdit:a,onSuccess:s})=>{const{createBlog:o,updateBlog:b,loading:h,error:d,clearError:c}=D(),[t,i]=f.useState({titulo:"",link:"",producto_id:"",parrafo:"",descripcion:"",imagen_principal:null,titulo_blog:"",subtitulo_beneficio:"",url_video:"",titulo_video:"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]}),[x,u]=f.useState(!1);f.useEffect(()=>{a&&(i({titulo:a.titulo,link:a.link,producto_id:a.producto_id.toString(),parrafo:a.parrafo,descripcion:a.descripcion,imagen_principal:null,titulo_blog:a.tituloBlog||"",subtitulo_beneficio:a.subTituloBlog||"",url_video:a.videoBlog||"",titulo_video:a.tituloVideoBlog||"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]}),u(!0))},[a]),f.useEffect(()=>{t.titulo&&!x&&i(n=>({...n,link:w.generateLinkFromTitle(t.titulo)}))},[t.titulo,x]);const m=n=>{const{name:l,value:g}=n.target;l==="titulo"&&u(!1),l==="link"&&u(!0),i(p=>({...p,[l]:g}))},B=n=>{const{name:l,files:g}=n.target;if(g&&g[0]){const p=g[0],_=L.validateImage(p);if(!_.valid){alert(_.error);return}i(E=>({...E,[l]:p}))}},N=(n,l,g)=>{if(l==="url_imagen"&&g instanceof File){const p=L.validateImage(g);if(!p.valid){alert(p.error);return}}i(p=>({...p,imagenes:p.imagenes?.map((_,E)=>E===n?{..._,[l]:g}:_)||[]}))},k=async n=>{if(n.preventDefault(),c(),!t.titulo||!t.link||!t.parrafo||!t.descripcion){alert("Por favor, completa todos los campos obligatorios.");return}if(!t.titulo_blog||!t.subtitulo_beneficio||!t.url_video||!t.titulo_video){alert("Por favor, completa todos los campos de información adicional del blog.");return}if(!a&&!t.imagen_principal){alert("Por favor, selecciona una imagen principal.");return}if(!t.imagenes||t.imagenes.length===0||!t.imagenes[0].url_imagen){alert("Por favor, selecciona al menos una imagen adicional.");return}try{let l=null;a?l=await b(a.id,t):l=await o(t),l&&(s?.(l),v())}catch(l){console.error("Error al guardar el blog:",l)}},v=()=>{i({titulo:"",link:"",producto_id:"",parrafo:"",descripcion:"",imagen_principal:null,titulo_blog:"",subtitulo_beneficio:"",url_video:"",titulo_video:"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]}),u(!1),c(),r()};return y?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:a?"Editar Blog":"Crear Nuevo Blog"}),e.jsx("button",{onClick:v,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),d&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:d}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título *"}),e.jsx("input",{type:"text",name:"titulo",value:t.titulo,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Link (URL amigable) *"}),e.jsx("input",{type:"text",name:"link",value:t.link,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID del Producto (opcional)"}),e.jsx("input",{type:"number",name:"producto_id",value:t.producto_id,onChange:m,placeholder:"Deja vacío si no tienes productos aún",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Puedes asociar este blog a un producto específico (opcional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Párrafo *"}),e.jsx("textarea",{name:"parrafo",value:t.parrafo,onChange:m,required:!0,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción *"}),e.jsx("textarea",{name:"descripcion",value:t.descripcion,onChange:m,required:!0,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Imagen Principal ",!a&&"*"]}),e.jsx("input",{type:"file",name:"imagen_principal",onChange:B,accept:"image/*",required:!a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título del Blog *"}),e.jsx("input",{type:"text",name:"titulo_blog",value:t.titulo_blog,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subtítulo *"}),e.jsx("input",{type:"text",name:"subtitulo_beneficio",value:t.subtitulo_beneficio,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL del Video *"}),e.jsx("input",{type:"url",name:"url_video",value:t.url_video,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título del Video *"}),e.jsx("input",{type:"text",name:"titulo_video",value:t.titulo_video,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-3",children:"Imágenes Adicionales * (Al menos 1 requerida)"}),t.imagenes?.map((n,l)=>e.jsxs("div",{className:"border border-gray-200 rounded-md p-4 mb-4",children:[e.jsxs("h4",{className:"text-md font-medium text-gray-600 mb-2",children:["Imagen ",l+1]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Archivo de Imagen ",l===0?"*":""]}),e.jsx("input",{type:"file",accept:"image/*",required:l===0,onChange:g=>{const p=g.target.files?.[0];p&&N(l,"url_imagen",p)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Párrafo de la Imagen"}),e.jsx("textarea",{value:n.parrafo_imagen,onChange:g=>N(l,"parrafo_imagen",g.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]},l))]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:v,className:"px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Guardando...":a?"Actualizar":"Crear"})]})]})]})})}):null},M=()=>{const{blogs:y,loading:r,error:a,refetch:s}=F(),{deleteBlog:o,loading:b}=D(),[h,d]=f.useState(!1),[c,t]=f.useState(null),[i,x]=f.useState(""),u=y.filter(n=>n.titulo.toLowerCase().includes(i.toLowerCase())||n.descripcion.toLowerCase().includes(i.toLowerCase())),m=n=>{t(n),d(!0)},B=async n=>{window.confirm("¿Estás seguro de que quieres eliminar este blog?")&&await o(n)&&s()},N=()=>{d(!1),t(null)},k=n=>{s()},v=n=>new Date(n).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"});return r?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):a?e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:["Error cargando blogs: ",a]}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Gestión de Blogs"}),e.jsx("button",{onClick:()=>d(!0),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Crear Nuevo Blog"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Buscar blogs...",value:i,onChange:n=>x(n.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:u.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:i?"No se encontraron blogs que coincidan con tu búsqueda.":"No hay blogs disponibles."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Imagen"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Título"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(n=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("img",{src:n.imagenPrincipal,alt:n.titulo,className:"h-16 w-16 rounded-lg object-cover"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:n.titulo}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",n.id]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:n.descripcion})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:v(n.created_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>m(n),className:"text-blue-600 hover:text-blue-900 bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded",children:"Editar"}),e.jsx("button",{onClick:()=>B(n.id),disabled:b,className:"text-red-600 hover:text-red-900 bg-red-100 hover:bg-red-200 px-3 py-1 rounded disabled:opacity-50",children:b?"Eliminando...":"Eliminar"}),e.jsx("a",{href:`/blogs/${n.id}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:text-green-900 bg-green-100 hover:bg-green-200 px-3 py-1 rounded",children:"Ver"})]})})]},n.id))})]})})}),e.jsx(I,{isOpen:h,onClose:N,blogToEdit:c,onSuccess:k})]})},$=()=>e.jsx("div",{children:e.jsx(M,{})});export{$ as default};
