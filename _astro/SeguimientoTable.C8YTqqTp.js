import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.ai7qpRr1.js";import{c as S}from"./index.C2rrZm7j.js";import{G as T}from"./iconBase.CsihB_xR.js";import{T as D}from"./TableContainer.BXE2yXaj.js";function A(t){return T({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",strokeWidth:"2",d:"M1.7507,16.0022 C3.3517,20.0982 7.3367,23.0002 11.9997,23.0002 C18.0747,23.0002 22.9997,18.0752 22.9997,12.0002 M22.2497,7.9982 C20.6487,3.9012 16.6627,1.0002 11.9997,1.0002 C5.9247,1.0002 0.9997,5.9252 0.9997,12.0002 M8.9997,16.0002 L0.9997,16.0002 L0.9997,24.0002 M22.9997,0.0002 L22.9997,8.0002 L14.9997,8.0002"},child:[]}]})(t)}const j=()=>{const t=()=>{const a=localStorage.getItem("token");if(!a)throw new Error("No se encontró el token");return a};return{addCliente:async a=>{const l=t(),r=await fetch("https://apiyuntas.yuntaspublicidad.com/api/v1/clientes",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(a)});if(!r.ok)throw new Error("Error al agregar cliente");return(await r.json()).data},updateCliente:async(a,l)=>{const c=t(),r=`https://apiyuntas.yuntaspublicidad.com/api/v1/clientes/${a}`,m=await fetch(r,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(l)});if(!m.ok)throw new Error("Error al actualizar cliente");return(await m.json()).data},deleteCliente:async a=>{const l=t(),c=`https://apiyuntas.yuntaspublicidad.com/api/v1/clientes/${a}`,r=await fetch(c,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}});if(!r.ok)throw new Error("Error al eliminar cliente");return await r.json()}}},I=(t,o)=>{const[s,u]=i.useState({name:"",celular:"",email:"",seccion:"",created_at:""}),[a,l]=i.useState(!1),{addCliente:c,updateCliente:r}=j();i.useEffect(()=>{t?(u({name:t.name,celular:t.celular,email:t.email,seccion:t.seccion,created_at:t.created_at}),l(!0)):(f(),l(!1))},[t]);const m=d=>{u({...s,[d.target.name]:d.target.value})},x=async d=>{d.preventDefault();const{name:p,celular:h,email:b}=s;if(!p.trim()||!h.trim()||!b.trim()){alert("⚠️ Todos los campos son obligatorios.");return}if(!/^\d+$/.test(h)){alert("⚠️ El teléfono solo debe contener números.");return}try{a?(await r(t.id,{name:p,celular:h,email:b}),alert(" Cliente actualizado correctamente")):(await c({name:p,celular:h,email:b}),alert(" Cliente registrado exitosamente")),o?.(),f()}catch(g){console.error("❌ Error en la operación:",g),alert(`❌ Error: ${g.message||"Error desconocido"}`)}},f=()=>{u({name:"",celular:"",email:"",seccion:"",created_at:""}),l(!1)};return{formData:s,handleChange:m,handleSubmit:x}},M=({isOpen:t,setIsOpen:o,cliente:s,onRefetch:u})=>{const{formData:a,handleChange:l,handleSubmit:c}=I(s,()=>{u(),o(!1)});return t?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{style:{backgroundColor:"#528FC2"},className:"text-white px-10 py-8 rounded-4xl w-3/5",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:s?"EDITAR CLIENTE":"AÑADIR CLIENTE"}),e.jsxs("form",{onSubmit:c,className:"grid grid-cols-2 gap-4 gap-x-12",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Nombres"}),e.jsx("input",{type:"text",name:"name",value:a.name,onChange:l,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Teléfono"}),e.jsx("input",{type:"text",name:"celular",value:a.celular,onChange:l,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block",children:"Gmail"}),e.jsx("input",{type:"email",name:"email",value:a.email,onChange:l,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Sección"}),e.jsx("input",{type:"text",name:"seccion",value:a.seccion,onChange:l,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Fecha"}),e.jsx("input",{type:"text",name:"fecha",value:a.created_at,onChange:l,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{className:"flex gap-2 mt-8 col-span-2",children:[e.jsx("button",{type:"submit",style:{backgroundColor:"#98D8DF"},className:"px-10 py-1 rounded-full text-lg text-white hover:opacity-90 transition",children:s?"Guardar cambios":"Añadir cliente"}),e.jsx("button",{onClick:()=>o(!1),type:"button",className:"px-10 bg-gray-400 py-1 rounded-full text-lg hover:bg-gray-500",children:"Cancelar"})]})]})]})}):null},F=({isOpen:t,setIsOpen:o,clienteId:s,onRefetch:u})=>{const{deleteCliente:a}=j(),[l,c]=i.useState(!1),r=async()=>{try{c(!0),await a(s),u(),o(!1)}catch(m){console.error("Error al eliminar cliente:",m),alert("No se pudo eliminar el cliente")}finally{c(!1)}};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg max-w-md w-full text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"¿Eliminar cliente?"}),e.jsx("p",{className:"text-gray-700 mb-6",children:"Esta acción es permanente y no se puede deshacer."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:r,disabled:l,className:"bg-red-600 text-white px-5 py-2 rounded-lg hover:bg-red-700 disabled:opacity-50",children:l?"Eliminando...":"Eliminar"}),e.jsx("button",{onClick:()=>o(!1),className:"bg-gray-200 text-gray-800 px-5 py-2 rounded-lg hover:bg-gray-300",children:"Cancelar"})]})]})}):null},z=(t,o=1)=>{const[s,u]=i.useState([]),[a,l]=i.useState(1),[c,r]=i.useState(!0),[m,x]=i.useState(null);return i.useEffect(()=>{(async()=>{r(!0),x(null);try{const d=localStorage.getItem("token");if(!d)throw new Error("No se encontró el token de autenticación");const p=await fetch("https://apiyuntas.yuntaspublicidad.com/api/v1/clientes",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}});if(!p.ok)throw new Error(`Error al obtener clientes: ${p.statusText}`);const h=await p.json();console.log("🚀 Datos obtenidos:",h.data);const b=h.data||[];console.log("🚀 Clientes obtenidos:",b);const g=Math.ceil(h.total/10)||1;u(b),l(g)}catch(d){console.error("🚨 Error en fetchClientes:",d),x(d instanceof Error?d.message:"Ocurrió un error desconocido")}finally{r(!1)}})()},[t,o]),{clientes:s,totalPages:a,loading:c,error:m}},L=({currentPage:t,totalPages:o,onPageChange:s})=>e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx("button",{onClick:()=>s(t-1),disabled:t===1,className:"pagination-btn",children:"Anterior"}),e.jsxs("span",{className:"text-gray-700 font-bold",children:["Página ",t," de ",o]}),e.jsx("button",{onClick:()=>s(t+1),disabled:t===o,className:"pagination-btn",children:"Siguiente"})]}),_=()=>{const[t,o]=i.useState(!1),[s,u]=i.useState(1),{clientes:a,totalPages:l,loading:c,error:r}=z(t,s),[m,x]=i.useState(!1),[f,d]=i.useState(null),[p,h]=i.useState(!1),[b,g]=i.useState(null);if(c)return e.jsx("p",{className:"text-center text-gray-500",children:"Cargando datos..."});if(r)return e.jsxs("p",{className:"text-center text-red-500",children:["Error: ",r]});const y=()=>o(n=>!n),N=n=>{d(n),x(!0)},C=()=>{d(null),x(!0)},w=n=>{g(n),h(!0)},k=()=>{y(),x(!1)};return e.jsxs("div",{className:"overflow-x-auto p-4",children:[e.jsxs(D,{tableType:"seguimiento",children:[e.jsx("thead",{className:"hidden md:table-header-group",children:e.jsx("tr",{children:["ID","Nombre","Gmail","Teléfono","Sección","Fecha","Acción"].map(n=>e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:n},n))})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-4 text-gray-500",children:"No hay clientes disponibles."})}):a.map((n,E)=>{const v=E%2===0?"bg-[#d9d9d9]":"bg-[#d9d9d94d]";return e.jsxs("tr",{className:`text-center md:table-row block md:mb-0 mb-4 rounded-lg shadow-sm ${v}`,children:[e.jsx("td",{"data-label":"ID",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:n.id}),e.jsx("td",{"data-label":"Nombre",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:n.name}),e.jsx("td",{"data-label":"Gmail",className:"px-4 py-2 border border-gray-300 block md:table-cell",children:n.email}),e.jsx("td",{"data-label":"Teléfono",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:n.celular}),e.jsx("td",{"data-label":"Sección",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:n.seccion||"N/A"}),e.jsx("td",{"data-label":"Fecha",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:n.created_at}),e.jsx("td",{"data-label":"Acción",className:"px-4 py-2 border border-gray-300 block md:table-cell",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-center gap-2 rounded-xl p-1",children:[e.jsx("button",{className:"p-2 text-red-600 hover:text-red-800 transition",title:"Eliminar",onClick:()=>w(n.id),children:e.jsx(S,{size:18})}),e.jsx("button",{className:"p-2 text-green-600 hover:text-green-800 transition",title:"Editar",onClick:()=>N(n),children:e.jsx(A,{size:18})})]})})]},n.id)})})]}),e.jsx("button",{className:"mt-4 ml-2 p-2 pl-4 bg-blue-900 text-white rounded-lg",onClick:C,children:"Agregar Cliente"}),e.jsx(M,{isOpen:m,setIsOpen:x,cliente:f,onRefetch:k}),b!==null&&e.jsx(F,{isOpen:p,setIsOpen:h,clienteId:b,onRefetch:y}),e.jsx(L,{currentPage:s,totalPages:l,onPageChange:n=>u(n)})]})};export{_ as default};
