import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as p}from"./index.ai7qpRr1.js";import{b as N}from"./blogService.CDTwhboX.js";import"./httpService.BWjNqOJ0.js";import"./config.CT_CG-Xn.js";function L(){const[y,t]=p.useState([]),[a,n]=p.useState(!0),[i,b]=p.useState(null),h=async()=>{try{n(!0),b(null);const c=await N.getAllBlogs();t(c.data)}catch(c){b(c instanceof Error?c.message:"Error desconocido al obtener blogs"),console.error("Error en useBlogs:",c)}finally{n(!1)}},d=async()=>{await h()};return p.useEffect(()=>{h()},[]),{blogs:y,loading:a,error:i,refetch:d}}function C(){const[y,t]=p.useState(!1),[a,n]=p.useState(null);return{loading:y,error:a,createBlog:async c=>{try{return t(!0),n(null),(await N.createBlog(c)).data}catch(r){const o=r instanceof Error?r.message:"Error desconocido al crear el blog";return n(o),console.error("Error creando blog:",r),null}finally{t(!1)}},updateBlog:async(c,r)=>{try{return t(!0),n(null),(await N.updateBlog(c,r)).data}catch(o){const f=o instanceof Error?o.message:"Error desconocido al actualizar el blog";return n(f),console.error("Error actualizando blog:",o),null}finally{t(!1)}},deleteBlog:async c=>{try{return t(!0),n(null),await N.deleteBlog(c),!0}catch(r){const o=r instanceof Error?r.message:"Error desconocido al eliminar el blog";return n(o),console.error("Error eliminando blog:",r),!1}finally{t(!1)}},clearError:()=>n(null)}}class k{static MAX_FILE_SIZE=10*1024*1024;static ALLOWED_MIME_TYPES=["image/jpeg","image/jpg","image/png","image/webp"];static validateImage(t){return t?this.ALLOWED_MIME_TYPES.includes(t.type)?t.size>this.MAX_FILE_SIZE?{valid:!1,error:`El archivo es demasiado grande. Tamaño máximo: ${this.formatFileSize(this.MAX_FILE_SIZE)}`}:{valid:!0}:{valid:!1,error:`Tipo de archivo no permitido. Use: ${this.ALLOWED_MIME_TYPES.join(", ")}`}:{valid:!1,error:"No se ha seleccionado ningún archivo"}}static formatFileSize(t){if(t===0)return"0 Bytes";const a=1024,n=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,i)).toFixed(2))+" "+n[i]}static createPreviewUrl(t){return t&&t.type.startsWith("image/")?URL.createObjectURL(t):null}static revokePreviewUrl(t){t&&URL.revokeObjectURL(t)}static async resizeImage(t,a=1920,n=1080,i=.8){return new Promise((b,h)=>{const d=document.createElement("canvas"),c=d.getContext("2d"),r=new Image;r.onload=()=>{let{width:o,height:f}=r;if(o>a||f>n){const u=Math.min(a/o,n/f);o*=u,f*=u}d.width=o,d.height=f,c?.drawImage(r,0,0,o,f),d.toBlob(u=>{if(u){const m=new File([u],t.name,{type:t.type,lastModified:Date.now()});b(m)}else h(new Error("Error al redimensionar la imagen"))},t.type,i)},r.onerror=()=>h(new Error("Error al cargar la imagen")),r.src=URL.createObjectURL(t)})}static generateUniqueFileName(t){const a=Date.now(),n=Math.random().toString(36).substring(2,15),i=t.split(".").pop();return`${a}_${n}.${i}`}static async extractImageMetadata(t){return new Promise((a,n)=>{const i=new Image;i.onload=()=>{a({width:i.naturalWidth,height:i.naturalHeight,size:t.size,type:t.type,name:t.name})},i.onerror=()=>n(new Error("Error al cargar la imagen")),i.src=URL.createObjectURL(t)})}}const S=({isOpen:y,onClose:t,blogToEdit:a,onSuccess:n})=>{const{createBlog:i,updateBlog:b,loading:h,error:d,clearError:c}=C(),[r,o]=p.useState({titulo:"",link:"",producto_id:"",parrafo:"",descripcion:"",imagen_principal:null,titulo_blog:"",subtitulo_beneficio:"",url_video:"",titulo_video:"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]}),[f,u]=p.useState(!1);p.useEffect(()=>{a&&(o({titulo:a.titulo,link:a.link,producto_id:a.producto_id.toString(),parrafo:a.parrafo,descripcion:a.descripcion,imagen_principal:null,titulo_blog:a.tituloBlog||"",subtitulo_beneficio:a.subTituloBlog||"",url_video:a.videoBlog||"",titulo_video:a.tituloVideoBlog||"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]}),u(!0))},[a]),p.useEffect(()=>{r.titulo&&!f&&o(s=>({...s,link:N.generateLinkFromTitle(r.titulo)}))},[r.titulo,f]);const m=s=>{const{name:l,value:g}=s.target;l==="titulo"&&u(!1),l==="link"&&u(!0),o(x=>({...x,[l]:g}))},_=s=>{const{name:l,files:g}=s.target;if(g&&g[0]){const x=g[0],j=k.validateImage(x);if(!j.valid){alert(j.error);return}o(E=>({...E,[l]:x}))}},w=(s,l,g)=>{if(l==="url_imagen"&&g instanceof File){const x=k.validateImage(g);if(!x.valid){alert(x.error);return}}o(x=>({...x,imagenes:x.imagenes?.map((j,E)=>E===s?{...j,[l]:g}:j)||[]}))},B=async s=>{if(s.preventDefault(),c(),!r.titulo||!r.link||!r.parrafo||!r.descripcion){alert("Por favor, completa todos los campos obligatorios.");return}if(!r.titulo_blog||!r.subtitulo_beneficio||!r.url_video||!r.titulo_video){alert("Por favor, completa todos los campos de información adicional del blog.");return}if(!a&&!r.imagen_principal){alert("Por favor, selecciona una imagen principal.");return}if(!r.imagenes||r.imagenes.length===0||!r.imagenes[0].url_imagen){alert("Por favor, selecciona al menos una imagen adicional.");return}try{let l=null;a?l=await b(a.id,r):l=await i(r),l&&(n?.(l),v())}catch(l){console.error("Error al guardar el blog:",l)}},v=()=>{o({titulo:"",link:"",producto_id:"",parrafo:"",descripcion:"",imagen_principal:null,titulo_blog:"",subtitulo_beneficio:"",url_video:"",titulo_video:"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]}),u(!1),c(),t()};return y?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:a?"Editar Blog":"Crear Nuevo Blog"}),e.jsx("button",{onClick:v,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),d&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:d}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título *"}),e.jsx("input",{type:"text",name:"titulo",value:r.titulo,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Link (URL amigable) *"}),e.jsx("input",{type:"text",name:"link",value:r.link,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID del Producto (opcional)"}),e.jsx("input",{type:"number",name:"producto_id",value:r.producto_id,onChange:m,placeholder:"Deja vacío si no tienes productos aún",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Puedes asociar este blog a un producto específico (opcional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Párrafo *"}),e.jsx("textarea",{name:"parrafo",value:r.parrafo,onChange:m,required:!0,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción *"}),e.jsx("textarea",{name:"descripcion",value:r.descripcion,onChange:m,required:!0,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Imagen Principal ",!a&&"*"]}),e.jsx("input",{type:"file",name:"imagen_principal",onChange:_,accept:"image/*",required:!a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título del Blog *"}),e.jsx("input",{type:"text",name:"titulo_blog",value:r.titulo_blog,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subtítulo *"}),e.jsx("input",{type:"text",name:"subtitulo_beneficio",value:r.subtitulo_beneficio,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL del Video *"}),e.jsx("input",{type:"url",name:"url_video",value:r.url_video,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título del Video *"}),e.jsx("input",{type:"text",name:"titulo_video",value:r.titulo_video,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-3",children:"Imágenes Adicionales * (Al menos 1 requerida)"}),r.imagenes?.map((s,l)=>e.jsxs("div",{className:"border border-gray-200 rounded-md p-4 mb-4",children:[e.jsxs("h4",{className:"text-md font-medium text-gray-600 mb-2",children:["Imagen ",l+1]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Archivo de Imagen ",l===0?"*":""]}),e.jsx("input",{type:"file",accept:"image/*",required:l===0,onChange:g=>{const x=g.target.files?.[0];x&&w(l,"url_imagen",x)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Párrafo de la Imagen"}),e.jsx("textarea",{value:s.parrafo_imagen,onChange:g=>w(l,"parrafo_imagen",g.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]},l))]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:v,className:"px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Guardando...":a?"Actualizar":"Crear"})]})]})]})})}):null},I=()=>{const{blogs:y,loading:t,error:a,refetch:n}=L(),{deleteBlog:i,loading:b}=C(),[h,d]=p.useState(!1),[c,r]=p.useState(null),[o,f]=p.useState(""),u=y.filter(s=>s.titulo.toLowerCase().includes(o.toLowerCase())||s.descripcion.toLowerCase().includes(o.toLowerCase())),m=s=>{r(s),d(!0)},_=async s=>{window.confirm("¿Estás seguro de que quieres eliminar este blog?")&&await i(s)&&n()},w=()=>{d(!1),r(null)},B=s=>{n()},v=s=>new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"});return t?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):a?e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:["Error cargando blogs: ",a]}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Gestión de Blogs"}),e.jsx("button",{onClick:()=>d(!0),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Crear Nuevo Blog"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Buscar blogs...",value:o,onChange:s=>f(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:u.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:o?"No se encontraron blogs que coincidan con tu búsqueda.":"No hay blogs disponibles."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Imagen"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Título"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("img",{src:s.imagenPrincipal,alt:s.titulo,className:"h-16 w-16 rounded-lg object-cover"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.titulo}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",s.id]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:s.descripcion})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:v(s.created_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>m(s),className:"text-blue-600 hover:text-blue-900 bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded",children:"Editar"}),e.jsx("button",{onClick:()=>_(s.id),disabled:b,className:"text-red-600 hover:text-red-900 bg-red-100 hover:bg-red-200 px-3 py-1 rounded disabled:opacity-50",children:b?"Eliminando...":"Eliminar"}),e.jsx("a",{href:`/blogs/${s.id}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:text-green-900 bg-green-100 hover:bg-green-200 px-3 py-1 rounded",children:"Ver"})]})})]},s.id))})]})})}),e.jsx(S,{isOpen:h,onClose:w,blogToEdit:c,onSuccess:B})]})},U=()=>e.jsx("div",{children:e.jsx(I,{})});export{U as default};
