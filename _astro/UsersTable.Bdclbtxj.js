import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{a as T,F as I}from"./index.yBaegBIJ.js";import{r as t}from"./index.ai7qpRr1.js";import{I as u,S as N}from"./Input.BSeqB-1Z.js";import"./iconBase.CsihB_xR.js";const E=({onClose:m,onUserAdded:b,initialData:o,isEditing:r})=>{const[x,h]=t.useState(o?.name||""),[n,g]=t.useState(o?.email||""),[a,i]=t.useState(o?.celular||""),[p,c]=t.useState(o?.roles?.join(", ")||""),[l,A]=t.useState(""),[v,k]=t.useState(""),[f,j]=t.useState(!1),[C,y]=t.useState(""),U=async s=>{if(s.preventDefault(),j(!0),y(""),!r&&l!==v){y("Las contraseñas no coinciden."),j(!1);return}const B=localStorage.getItem("token");try{const d={name:x,email:n,celular:a,roles:p.split(",").map(w=>w.trim()).filter(Boolean)};r?(d._method="PUT",l&&(d.password=l)):d.password=l;const S=await fetch(`https://apiyuntas.yuntaspublicidad.com/api/v1/users${r&&o?`/${o.id}`:""}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${B}`},body:JSON.stringify(d)});if(!S.ok){const w=await S.json();throw new Error(w.message||"Error al guardar usuario")}b(),m()}catch(d){y(d.message)}finally{j(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-[#1e293b]/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-2xl font-bold",onClick:m,children:"×"}),e.jsx("h3",{className:"text-2xl font-bold mb-6 text-blue-900 border-b-2 border-blue-700 pb-2 w-fit",children:r?"Editar Usuario":"Ingresar Usuario"}),e.jsxs("form",{onSubmit:U,className:"grid max-sm:grid-cols-1 grid-cols-2 gap-5",children:[e.jsx(u,{label:"Nombre",name:"name",value:x,onChange:s=>h(s.target.value),required:!0,className:""}),e.jsx(u,{label:"Email",name:"email",value:n,onChange:s=>g(s.target.value),required:!0,type:"email",className:""}),e.jsx(u,{label:"Celular",name:"celular",value:a,onChange:s=>i(s.target.value),className:""}),e.jsx(u,{label:"Roles (separados por coma)",name:"roles",value:p,onChange:s=>c(s.target.value),required:!0,className:""}),e.jsx(u,{label:"Contraseña",name:"password",value:l,onChange:s=>A(s.target.value),type:"password",className:"",required:!r}),e.jsx(u,{label:"Confirmar contraseña",name:"confirmPassword",value:v,onChange:s=>k(s.target.value),type:"password",className:"",required:!r}),C&&e.jsx("div",{className:"col-span-2 text-red-600 text-sm",children:C}),e.jsxs("div",{className:"col-span-2 flex justify-end gap-3 mt-4",children:[e.jsx("button",{type:"button",className:"px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300 transition",onClick:m,disabled:f,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-lg font-semibold bg-blue-600 text-white hover:bg-blue-700 transition",disabled:f,children:f?r?"Guardando...":"Agregando...":r?"Guardar cambios":"Agregar usuario"})]})]})]})})};function F(){const[m,b]=t.useState([]),[o,r]=t.useState(!1),[x,h]=t.useState(null),n=async()=>{const a=localStorage.getItem("token"),p=await(await fetch("https://apiyuntas.yuntaspublicidad.com/api/v1/users",{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${a}`}})).json();b(p.data||[])},g=async a=>{const i=localStorage.getItem("token");if((await N.fire({title:"¿Estás seguro?",text:"Esta acción eliminará el usuario permanentemente.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const c=await fetch(`https://apiyuntas.yuntaspublicidad.com/api/v1/users/${a}`,{method:"DELETE",headers:{Accept:"application/json",Authorization:`Bearer ${i}`}});if(!c.ok){const l=await c.json();throw new Error(l.message||"Error al eliminar usuario")}await n(),N.fire("Eliminado","El usuario ha sido eliminado.","success")}catch(c){N.fire("Error",c.message,"error")}};return t.useEffect(()=>{n()},[]),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Usuarios"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-xl mb-4 font-semibold hover:bg-blue-700 transition",onClick:()=>r(!0),children:"Agregar usuario"}),o&&e.jsx(E,{onClose:()=>r(!1),onUserAdded:n}),x&&e.jsx(E,{onClose:()=>h(null),onUserAdded:n,initialData:x,isEditing:!0}),e.jsxs("table",{className:"w-full border-separate border-spacing-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-950 text-white",children:[e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"ID"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"Email"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"Acción"})]})}),e.jsx("tbody",{children:m.map((a,i)=>e.jsxs("tr",{className:`text-center ${i%2===0?"bg-gray-100":"bg-gray-300"}`,children:[e.jsx("td",{className:"p-2 font-bold rounded-xl",children:a.id}),e.jsx("td",{className:"p-2 font-bold rounded-xl",children:a.name}),e.jsx("td",{className:"p-2 font-bold rounded-xl",children:a.email}),e.jsx("td",{className:"p-2 rounded-xl",children:e.jsxs("div",{className:"flex justify-center gap-5 rounded-xl",children:[e.jsx("button",{className:"text-green-600 hover:text-green-800 transition cursor-pointer",title:"Editar",onClick:()=>h(a),children:e.jsx(T,{size:18})}),e.jsx("button",{className:"text-red-600 hover:text-red-800 transition cursor-pointer",title:"Eliminar",onClick:()=>g(a.id),children:e.jsx(I,{size:18})})]})})]},a.id))})]})]})}export{F as default};
