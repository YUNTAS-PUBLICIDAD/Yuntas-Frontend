import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{e as B,c as T}from"./index.C2rrZm7j.js";import{r}from"./index.ai7qpRr1.js";import{S as w}from"./sweetalert2.esm.all.B0Dix5B2.js";import{T as I}from"./TableContainer.BXE2yXaj.js";import"./iconBase.CsihB_xR.js";const y=({label:d,type:c="text",rows:o,name:t,value:u,placeholder:m,onChange:x,className:p,required:l=!1,disabled:g=!1,defaultValue:a})=>e.jsxs("div",{className:`flex flex-col w-full ${p}`,children:[d&&e.jsx("label",{htmlFor:t,className:"mb-1 font-semibold text-gray-700",children:d}),c==="textarea"?e.jsx("textarea",{id:t,name:t,value:u,placeholder:m,rows:o,required:l,disabled:g,defaultValue:a,className:"px-4 py-2 text-black border border-gray-300 rounded-lg shadow-sm focus:outline-none  focus:ring-2 focus:ring-[#6886e9] focus:border-[#6886e9] transition duration-200 disabled:bg-gray-100 disabled:cursor-not-allowed"}):e.jsx("input",{id:t,type:c,name:t,value:u,placeholder:m,onChange:x,required:l,disabled:g,defaultValue:a,className:`px-4 py-2 text-black border border-gray-300 rounded-lg shadow-sm focus:outline-none  focus:ring-2 focus:ring-[#6886e9] focus:border-[#6886e9] transition duration-200 disabled:bg-gray-100 disabled:cursor-not-allowed ${p}`})]}),A=({onClose:d,onUserAdded:c,initialData:o,isEditing:t})=>{const[u,m]=r.useState(o?.name||""),[x,p]=r.useState(o?.email||""),[l,g]=r.useState(o?.celular||""),[a,f]=r.useState(o?.roles?.join(", ")||""),[n,i]=r.useState(""),[b,N]=r.useState(""),[h,v]=r.useState(!1),[S,C]=r.useState(""),$=async s=>{if(s.preventDefault(),v(!0),C(""),!t&&n!==b){C("Las contraseñas no coinciden."),v(!1);return}const U=localStorage.getItem("token");try{const j={name:u,email:x,celular:l,roles:a.split(",").map(k=>k.trim()).filter(Boolean)};t?(j._method="PUT",n&&(j.password=n)):j.password=n;const E=await fetch(`https://apiyuntas.yuntaspublicidad.com/api/v1/users${t&&o?`/${o.id}`:""}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${U}`},body:JSON.stringify(j)});if(!E.ok){const k=await E.json();throw new Error(k.message||"Error al guardar usuario")}c(),d()}catch(j){C(j.message)}finally{v(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-[#1e293b]/60 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-2xl font-bold",onClick:d,children:"×"}),e.jsx("h3",{className:"text-2xl font-bold mb-6 text-blue-900 border-b-2 border-blue-700 pb-2 w-fit",children:t?"Editar Usuario":"Ingresar Usuario"}),e.jsxs("form",{onSubmit:$,className:"grid max-sm:grid-cols-1 grid-cols-2 gap-5",children:[e.jsx(y,{label:"Nombre",name:"name",value:u,onChange:s=>m(s.target.value),required:!0,className:""}),e.jsx(y,{label:"Email",name:"email",value:x,onChange:s=>p(s.target.value),required:!0,type:"email",className:""}),e.jsx(y,{label:"Celular",name:"celular",value:l,onChange:s=>g(s.target.value),className:""}),e.jsx(y,{label:"Roles (separados por coma)",name:"roles",value:a,onChange:s=>f(s.target.value),required:!0,className:""}),e.jsx(y,{label:"Contraseña",name:"password",value:n,onChange:s=>i(s.target.value),type:"password",className:"",required:!t}),e.jsx(y,{label:"Confirmar contraseña",name:"confirmPassword",value:b,onChange:s=>N(s.target.value),type:"password",className:"",required:!t}),S&&e.jsx("div",{className:"col-span-2 text-red-600 text-sm",children:S}),e.jsxs("div",{className:"col-span-2 flex justify-end gap-3 mt-4",children:[e.jsx("button",{type:"button",className:"px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300 transition",onClick:d,disabled:h,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-lg font-semibold bg-blue-600 text-white hover:bg-blue-700 transition",disabled:h,children:h?t?"Guardando...":"Agregando...":t?"Guardar cambios":"Agregar usuario"})]})]})]})})};function G(){const[d,c]=r.useState(!0),[o,t]=r.useState([]),[u,m]=r.useState(!1),[x,p]=r.useState(null),l=async()=>{c(!0);try{const a=localStorage.getItem("token"),n=await(await fetch("https://apiyuntas.yuntaspublicidad.com/api/v1/users",{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${a}`}})).json();t(n.data||[])}catch(a){console.error("Error al obtener usuarios:",a),w.fire({icon:"error",title:"Error",text:"Hubo un error al cargar los usuarios",confirmButtonColor:"#14b8a6"})}finally{c(!1)}},g=async a=>{const f=localStorage.getItem("token");if((await w.fire({title:"¿Estás seguro?",text:"Esta acción eliminará el usuario permanentemente.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const i=await fetch(`https://apiyuntas.yuntaspublicidad.com/api/v1/users/${a}`,{method:"DELETE",headers:{Accept:"application/json",Authorization:`Bearer ${f}`}});if(!i.ok){const b=await i.json();throw new Error(b.message||"Error al eliminar usuario")}await l(),w.fire("Eliminado","El usuario ha sido eliminado.","success")}catch(i){w.fire("Error",i.message,"error")}};return r.useEffect(()=>{l()},[]),e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Usuarios"}),e.jsx(I,{tableType:"usuarios",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full responsive-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 bg-cyan-400 dark:bg-cyan-600 text-white uppercase text-xs font-bold rounded-md",children:"ID"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 dark:bg-cyan-600 text-white uppercase text-xs font-bold rounded-md",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 dark:bg-cyan-600 text-white uppercase text-xs font-bold rounded-md",children:"Email"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 dark:bg-cyan-600 text-white uppercase text-xs font-bold rounded-md",children:"Acción"})]})}),e.jsx("tbody",{children:d?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-2",children:e.jsxs("div",{className:"flex justify-center items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-teal-500"}),e.jsx("span",{className:"text-teal-500 font-medium",children:"Cargando usuarios..."})]})})}):o.length>0?o.map((a,f)=>{const n=f%2===0,i=n?"bg-gray-100":"bg-gray-200",b=n?"dark:bg-gray-800":"dark:bg-gray-700",N="text-gray-900 dark:text-gray-100",h=`px-4 py-2 rounded-md font-bold ${i} ${b} ${N}`;return e.jsxs("tr",{children:[e.jsx("td",{"data-label":"ID",className:h,children:a.id}),e.jsx("td",{"data-label":"Nombre",className:h,children:a.name}),e.jsx("td",{"data-label":"Email",className:h,children:a.email}),e.jsx("td",{"data-label":"Acción",className:`px-4 py-2 rounded-md ${i} ${b} ${N}`,children:e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{className:"text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300 transition cursor-pointer",title:"Editar",onClick:()=>p(a),children:e.jsx(B,{size:18})}),e.jsx("button",{className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 transition cursor-pointer",title:"Eliminar",onClick:()=>g(a.id),children:e.jsx(T,{size:18})})]})})]},a.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-12",children:e.jsx("span",{className:"text-gray-500",children:"No hay usuarios registrados"})})})})]})})}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-xl font-semibold hover:bg-blue-700 transition",onClick:()=>m(!0),children:"Agregar usuario"})}),u&&e.jsx(A,{onClose:()=>m(!1),onUserAdded:l}),x&&e.jsx(A,{onClose:()=>p(null),onUserAdded:l,initialData:x,isEditing:!0})]})}export{G as default};
