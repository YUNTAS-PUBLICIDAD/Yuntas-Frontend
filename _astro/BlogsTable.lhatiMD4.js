import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as c}from"./index.ai7qpRr1.js";import{F as C,e as E}from"./index.yBaegBIJ.js";import{g,c as x}from"./config.DAMyqOaI.js";import{S as w}from"./sweetalert2.esm.all.B0Dix5B2.js";import"./iconBase.CsihB_xR.js";const S=({onBlogAdded:m})=>{const[d,_]=c.useState(!1),[v,u]=c.useState([]),[t,i]=c.useState({producto_id:0,titulo:"",link:"",parrafo:"",descripcion:"",imagen_principal:null,titulo_blog:"",subtitulo_beneficio:"",url_video:"",titulo_video:"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]});c.useEffect(()=>{d&&fetch(g(x.endpoints.blogs.list),{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json"}}).then(a=>a.json()).then(a=>{const n=a?.data?.map(s=>parseInt(s.link)).filter(s=>Number.isInteger(s)&&s>0),l=h(n||[]);i(s=>({...s,link:String(l)}))}).catch(a=>console.error("Error al obtener blogs:",a))},[d]),c.useEffect(()=>{d&&fetch(g(x.endpoints.productos.list),{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json"}}).then(a=>a.json()).then(a=>{console.log("Respuesta productos:",a),u(a||[])}).catch(a=>console.error("Error al obtener productos:",a))},[d]);function h(a){const n=new Set(a);let l=1;for(;n.has(l);)l++;return l}const r=a=>{const{name:n,value:l}=a.target;if(n==="link"){const s=l.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replaceAll(" ","-");i(p=>({...p,link:s}))}else i(s=>({...s,[n]:l}))},b=a=>{a.target.files&&a.target.files[0]&&i({...t,imagen_principal:a.target.files[0]})},f=(a,n)=>{if(a.target.files&&a.target.files[0]){const l=[...t.imagenes];l[n]={...l[n],url_imagen:a.target.files[0]},i({...t,imagenes:l})}},j=(a,n)=>{const l=[...t.imagenes];l[n]={...l[n],parrafo_imagen:a.target.value},i({...t,imagenes:l})},N=()=>{_(!1),i({producto_id:0,titulo:"",link:"",parrafo:"",descripcion:"",imagen_principal:null,titulo_blog:"",subtitulo_beneficio:"",url_video:"",titulo_video:"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]})},o=async a=>{if(a.preventDefault(),!t.titulo||!t.link||!t.parrafo||!t.descripcion||!t.subtitulo_beneficio||!t.titulo_blog||!t.titulo_video||!t.url_video||!t.imagen_principal||t.imagenes.some(n=>!n.url_imagen)){w.fire({icon:"warning",title:"Campos obligatorios",text:"⚠️ Todos los campos son obligatorios."});return}try{const n=localStorage.getItem("token"),l=new FormData;if(console.log("Producto ID a enviar:",t.producto_id),t.producto_id&&!isNaN(t.producto_id))l.append("producto_id",String(t.producto_id));else{alert("⚠️ Debes seleccionar un producto válido.");return}l.append("titulo",t.titulo),l.append("link",t.link),l.append("parrafo",t.parrafo),l.append("descripcion",t.descripcion),l.append("subtitulo_beneficio",t.subtitulo_beneficio),l.append("titulo_blog",t.titulo_blog),l.append("titulo_video",t.titulo_video),l.append("url_video",t.url_video),l.append("imagen_principal",t.imagen_principal),t.imagenes.forEach((k,y)=>{k.url_imagen&&l.append(`imagenes[${y}][imagen]`,k.url_imagen),l.append(`imagenes[${y}][parrafo_imagen]`,k.parrafo_imagen)});const s=await fetch(g(x.endpoints.blogs.create),{method:"POST",body:l,headers:{Authorization:`Bearer ${n}`,Accept:"application/json"}}),p=await s.json();console.log("Respuesta del servidor:",p),s.ok?(await w.fire({icon:"success",title:"Blog añadido exitosamente",showConfirmButton:!0}),N()):w.fire({icon:"error",title:"Error",text:`❌ Error: ${p.message}`}),m&&m()}catch(n){console.error("Error al enviar los datos:",n),alert(`❌ Error: ${n}`)}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>_(!0),className:"mt-4 bg-blue-950 hover:bg-blue-950 text-white text-lg px-10 py-1.5 rounded-full flex items-center gap-2",children:"Añadir Blog"}),d&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"h-3/4 overflow-y-scroll bg-blue-950 text-white px-10 py-8 rounded-4xl w-3/5",children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-4",children:"Añadir Nuevo Blog"}),e.jsxs("form",{encType:"multipart/form-data",onSubmit:o,className:"grid grid-cols-2 gap-4 gap-x-12",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Título"}),e.jsx("input",{type:"text",name:"titulo",value:t.titulo,onChange:r,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Link"}),e.jsx("input",{type:"text",name:"link",value:t.link,onChange:r,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Párrafo"}),e.jsx("input",{type:"text",name:"parrafo",value:t.parrafo,onChange:r,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block",children:"Descripción"}),e.jsx("input",{type:"text",name:"descripcion",value:t.descripcion,onChange:r,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block",children:"Subtítulo Beneficio"}),e.jsx("input",{type:"text",name:"subtitulo_beneficio",value:t.subtitulo_beneficio,onChange:r,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Título Blog"}),e.jsx("input",{type:"text",name:"titulo_blog",value:t.titulo_blog,onChange:r,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Título Video"}),e.jsx("input",{type:"text",name:"titulo_video",value:t.titulo_video,onChange:r,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block",children:"URL del Video"}),e.jsx("input",{type:"text",name:"url_video",value:t.url_video,onChange:r,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block",children:"Producto"}),e.jsxs("select",{name:"producto_id",value:t.producto_id||"",onChange:a=>i({...t,producto_id:Number(a.target.value)}),required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black",children:[e.jsx("option",{value:"",children:"Selecciona un producto"}),v.map(a=>e.jsx("option",{value:a.id,children:a.nombre||a.titulo},a.id))]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block",children:"Imagen Principal"}),e.jsx("input",{type:"file",accept:"image/png, image/jpeg, image/jpg",name:"imagen_principal",onChange:b,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),t.imagenes.map((a,n)=>e.jsxs("div",{className:"col-span-2",children:[e.jsxs("label",{className:"block",children:["Imagen ",n+1]}),e.jsx("input",{type:"file",accept:"image/*",onChange:l=>{f(l,n)},required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"}),e.jsx("textarea",{onChange:l=>{j(l,n)},required:!0,placeholder:"Descripción de la imagen...",className:"w-full bg-white outline-none p-2 rounded-md text-black mt-2 min-h-36"})]},n)),e.jsxs("div",{className:"flex gap-2 mt-8",children:[e.jsx("button",{type:"submit",className:"admin-act-btn",children:"Añadir Blog"}),e.jsx("button",{onClick:N,type:"button",className:"cancel-btn",children:"Cancelar"})]})]})]})})]})},F=()=>{const[m,d]=c.useState([]),[_,v]=c.useState(null),[u,t]=c.useState(1),i=10;c.useEffect(()=>{(async()=>{try{const n=await(await fetch(g(x.endpoints.blogs.list))).json();console.log("Datos recibidos:",n),d(n.data||[])}catch(a){console.error("❌ Error al cargar datos:",a)}})()},[]);const h=u*i,r=h-i,b=m.slice(r,h),f=o=>{t(o)},j=Math.ceil(m.length/i),N=async o=>{const a=localStorage.getItem("token");if(window.confirm("¿Estás seguro de que deseas eliminar este elemento?"))try{(await fetch(g(x.endpoints.blogs.delete(o)),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}})).ok?(d(s=>s.filter(p=>p.id!==o)),alert("Blog eliminado exitosamente")):alert("Error al eliminar el Blog")}catch(l){console.error("Error al eliminar:",l),alert("Error al conectar con el servidor")}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-separate border-spacing-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-950 text-white",children:[e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"ID"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"TÍTULO"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"PÁRRAFO"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"DESCRIPCIÓN"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"IMAGEN"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"ACCIÓN"})]})}),e.jsx("tbody",{children:b.length>0?b.map(o=>e.jsxs("tr",{className:`text-center ${o.id%2===0?"bg-gray-100":"bg-gray-300"}`,children:[e.jsx("td",{className:"px-4 font-bold rounded-xl",children:o.id}),e.jsx("td",{className:"px-4 font-bold rounded-xl",children:o.titulo}),e.jsx("td",{className:"px-4 rounded-xl",children:o.parrafo}),e.jsx("td",{className:"px-4 rounded-xl",children:o.descripcion}),e.jsx("td",{className:"px-4 rounded-xl",children:e.jsx("img",{src:o.imagenPrincipal,alt:o.titulo,className:"w-16 h-16 rounded-md mx-auto"})}),e.jsx("td",{className:"px-4 rounded-xl",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{className:"p-2 text-red-600 hover:text-red-800 transition",title:"Eliminar",onClick:()=>N(o.id),children:e.jsx(C,{size:18})}),e.jsx("button",{className:"p-2 text-yellow-600 hover:text-yellow-800 transition",title:"Editar",onClick:()=>v(o),children:e.jsx(E,{size:18})})]})})]},o.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-500",children:"Cargando datos..."})})})]})}),e.jsxs("div",{className:"flex justify-center mt-4",children:[e.jsx("button",{onClick:()=>f(u-1),disabled:u===1,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50",children:"Anterior"}),e.jsx("span",{className:"mx-4 self-center",children:`Página ${u} de ${j}`}),e.jsx("button",{onClick:()=>f(u+1),disabled:u===j,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50",children:"Siguiente"})]}),e.jsx(S,{})]})};export{F as default};
