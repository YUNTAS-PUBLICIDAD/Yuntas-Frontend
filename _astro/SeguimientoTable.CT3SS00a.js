import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as u}from"./index.ai7qpRr1.js";import{d as S,l as A}from"./index.C5s5t-Qp.js";import{g as y,c as N}from"./config.DqK_gEEU.js";import{T as R}from"./TableContainer.BXE2yXaj.js";import"./iconBase.CsihB_xR.js";const T=()=>{const t=()=>{const s=localStorage.getItem("token");if(console.log("üîç Token encontrado:",s?"‚úÖ S√≠":"‚ùå No"),console.log("üîç Token (primeros 20 chars):",s?s.substring(0,20)+"...":"No token"),!s)throw new Error("No se encontr√≥ el token");return s};return{addCliente:async s=>{const r=t(),l=y(N.endpoints.clientes.create);console.log("üîç ADD - URL completa:",l);const a=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(s)});if(console.log("üîç ADD - Status:",a.status),console.log("üîç ADD - URL final:",a.url),!a.ok){const c=await a.text();throw new Error(`Error al agregar cliente: ${a.status} - ${c}`)}return(await a.json()).data},updateCliente:async(s,r)=>{try{const l=t(),a=y(N.endpoints.clientes.update(s)),x={method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(r)};console.log("üîç Headers de la petici√≥n:",x.headers);const c=await fetch(a,x);if(!c.ok){const i=await c.text();throw console.error("üö® Error response body:",i),new Error(`Error ${c.status}: ${i}`)}const h=await c.json();return console.log("‚úÖ Respuesta exitosa:",h),h.data}catch(l){throw console.error("üö® Error completo:",l),l}},deleteCliente:async s=>{const r=t(),l=y(N.endpoints.clientes.delete(s));console.log("üîç DELETE - URL completa:",l);const a=await fetch(l,{method:"DELETE",headers:{Authorization:`Bearer ${r}`,Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!a.ok){const c=await a.text();throw new Error(`Error al eliminar cliente: ${a.status} - ${c}`)}return await a.json()}}},$=(t,d)=>{const[n,m]=u.useState({name:"",celular:"",email:"",producto_id:0,created_at:""}),[s,r]=u.useState(!1),{addCliente:l,updateCliente:a}=T();u.useEffect(()=>{t?(m({name:t.name,celular:t.celular,email:t.email,producto_id:t.producto_id,created_at:t.created_at}),r(!0)):(h(),r(!1))},[t]);const x=i=>{m({...n,[i.target.name]:i.target.value})},c=async i=>{i.preventDefault();const{name:g,celular:b,email:p}=n;if(!g.trim()||!b.trim()||!p.trim()){alert("‚ö†Ô∏è Todos los campos son obligatorios.");return}if(!/^\d+$/.test(b)){alert("‚ö†Ô∏è El tel√©fono solo debe contener n√∫meros.");return}try{s?(await a(t.id,{name:g,celular:b,email:p,producto_id:n.producto_id}),alert(" Cliente actualizado correctamente")):(await l({name:g,celular:b,email:p}),alert(" Cliente registrado exitosamente")),d?.(),h()}catch(f){console.error("‚ùå Error en la operaci√≥n:",f),alert(`‚ùå Error: ${f.message||"Error desconocido"}`)}},h=()=>{m({name:"",celular:"",email:"",producto_id:0,created_at:""}),r(!1)};return{formData:n,handleChange:x,handleSubmit:c}},I=({isOpen:t,setIsOpen:d,cliente:n,onRefetch:m})=>{const{formData:s,handleChange:r,handleSubmit:l}=$(n,()=>{m(),d(!1)});return t?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50 p-2 sm:p-4",children:e.jsxs("div",{style:{backgroundColor:"#528FC2"},className:"text-white px-6 py-6 sm:px-10 sm:py-8 rounded-2xl w-full max-w-lg sm:max-w-2xl",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-4 text-center sm:text-left",children:n?"EDITAR CLIENTE":"A√ëADIR CLIENTE"}),e.jsxs("form",{onSubmit:l,className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Nombres"}),e.jsx("input",{type:"text",name:"name",value:s.name,onChange:r,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black text-sm sm:text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Tel√©fono"}),e.jsx("input",{type:"text",name:"celular",value:s.celular,onChange:r,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black text-sm sm:text-base"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm mb-1",children:"Gmail"}),e.jsx("input",{type:"email",name:"email",value:s.email,onChange:r,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black text-sm sm:text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Producto ID"}),e.jsx("input",{type:"text",name:"producto_id",value:s.producto_id??"",onChange:r,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black text-sm sm:text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Fecha"}),e.jsx("input",{type:"text",name:"fecha",value:s.created_at,onChange:r,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black text-sm sm:text-base"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-6 sm:col-span-2",children:[e.jsx("button",{type:"submit",style:{backgroundColor:"#98D8DF"},className:"flex-1 sm:flex-none px-6 py-2 rounded-full text-base text-white hover:opacity-90 transition",children:n?"Guardar cambios":"A√±adir cliente"}),e.jsx("button",{onClick:()=>d(!1),type:"button",className:"flex-1 sm:flex-none px-6 py-2 bg-gray-400 rounded-full text-base hover:bg-gray-500 transition",children:"Cancelar"})]})]})]})}):null},_=({isOpen:t,setIsOpen:d,clienteId:n,onRefetch:m})=>{const{deleteCliente:s}=T(),[r,l]=u.useState(!1),a=async()=>{try{l(!0),await s(n),m(),d(!1)}catch(x){console.error("Error al eliminar cliente:",x),alert("No se pudo eliminar el cliente")}finally{l(!1)}};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg max-w-md w-full text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"¬øEliminar cliente?"}),e.jsx("p",{className:"text-gray-700 mb-6",children:"Esta acci√≥n es permanente y no se puede deshacer."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:a,disabled:r,className:"bg-red-600 text-white px-5 py-2 rounded-lg hover:bg-red-700 disabled:opacity-50",children:r?"Eliminando...":"Eliminar"}),e.jsx("button",{onClick:()=>d(!1),className:"bg-gray-200 text-gray-800 px-5 py-2 rounded-lg hover:bg-gray-300",children:"Cancelar"})]})]})}):null},F=(t,d=1)=>{const[n,m]=u.useState([]),[s,r]=u.useState(1),[l,a]=u.useState(!0),[x,c]=u.useState(null);return u.useEffect(()=>{(async()=>{a(!0),c(null);try{const i=localStorage.getItem("token");if(!i)throw new Error("No se encontr√≥ el token de autenticaci√≥n");const g=`${N.endpoints.clientes.list}?page=${d}`,b=y(g),p=await fetch(b,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}});if(!p.ok){const k=await p.text();throw new Error(`Error al obtener clientes: ${p.status} - ${k}`)}const f=await p.json();console.log("üöÄ Respuesta completa:",f);const j=f.data||{},w=j.data||[],E=j.total||0,C=j.last_page||1;m(w),r(C)}catch(i){console.error("üö® Error en fetchClientes:",i),c(i instanceof Error?i.message:"Ocurri√≥ un error desconocido")}finally{a(!1)}})()},[t,d]),{clientes:n,totalPages:s,loading:l,error:x}},L=({currentPage:t,totalPages:d,onPageChange:n})=>e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx("button",{onClick:()=>n(t-1),disabled:t===1,className:"pagination-btn",children:"Anterior"}),e.jsxs("span",{className:"text-gray-700 font-bold",children:["P√°gina ",t," de ",d]}),e.jsx("button",{onClick:()=>n(t+1),disabled:t===d,className:"pagination-btn",children:"Siguiente"})]}),X=()=>{const[t,d]=u.useState(!1),[n,m]=u.useState(1),{clientes:s,totalPages:r,loading:l,error:a}=F(t,n),[x,c]=u.useState(!1),[h,i]=u.useState(null),[g,b]=u.useState(!1),[p,f]=u.useState(null);if(l)return e.jsx("p",{className:"text-center text-gray-500",children:"Cargando datos..."});if(a)return e.jsxs("p",{className:"text-center text-red-500",children:["Error: ",a]});const j=()=>d(o=>!o),w=o=>{i(o),c(!0)},E=()=>{i(null),c(!0)},C=o=>{f(o),b(!0)},k=()=>{j(),c(!1)};return e.jsxs("div",{className:"overflow-x-auto p-4",children:[e.jsxs(R,{tableType:"seguimiento",children:[e.jsx("thead",{className:"hidden md:table-header-group",children:e.jsx("tr",{children:["ID","Nombre","Gmail","Tel√©fono","Producto","Fecha","Acci√≥n"].map(o=>e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:o},o))})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-4 text-gray-500",children:"No hay clientes disponibles."})}):s.map((o,D)=>{const v=D%2===0?"bg-[#d9d9d9]":"bg-[#d9d9d94d]";return e.jsxs("tr",{className:`text-center md:table-row block md:mb-0 mb-4 rounded-lg shadow-sm ${v}`,children:[e.jsx("td",{"data-label":"ID",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:o.id}),e.jsx("td",{"data-label":"Nombre",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:o.name}),e.jsx("td",{"data-label":"Gmail",className:"px-4 py-2 border border-gray-300 block md:table-cell",children:o.email}),e.jsx("td",{"data-label":"Tel√©fono",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:o.celular}),e.jsx("td",{"data-label":"Producto",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:o.nombre_producto||"N/A"}),e.jsx("td",{"data-label":"Fecha",className:"px-4 py-2 font-bold border border-gray-300 block md:table-cell",children:o.created_at}),e.jsx("td",{"data-label":"Acci√≥n",className:"px-4 py-2 border border-gray-300 block md:table-cell",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-center gap-2 rounded-xl p-1",children:[e.jsx("button",{className:"p-2 text-red-600 hover:text-red-800 transition",title:"Eliminar",onClick:()=>C(o.id),children:e.jsx(S,{size:18})}),e.jsx("button",{className:"p-2 text-green-600 hover:text-green-800 transition",title:"Editar",onClick:()=>w(o),children:e.jsx(A,{size:18})})]})})]},o.id)})})]}),e.jsx("button",{className:"mt-4 ml-2 p-2 pl-4 bg-blue-900 text-white rounded-lg",onClick:E,children:"Agregar Cliente"}),e.jsx(I,{isOpen:x,setIsOpen:c,cliente:h,onRefetch:k}),p!==null&&e.jsx(_,{isOpen:g,setIsOpen:b,clienteId:p,onRefetch:j}),e.jsx(L,{currentPage:n,totalPages:r,onPageChange:o=>m(o)})]})};export{X as default};
