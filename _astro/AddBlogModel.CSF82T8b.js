import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{g as E,c as R}from"./config.CelHcebK.js";import{r as m}from"./index.Be8AcK8B.js";import{S}from"./sweetalert2.esm.all.Bj_ZQUAw.js";const pe=({isOpen:j,setIsOpen:V,blogToEdit:n,onSuccess:G})=>{const[P,_]=m.useState([]),[U,D]=m.useState(""),[y,v]=m.useState(!1),[K,O]=m.useState(!1),[p,I]=m.useState(null),[x,L]=m.useState(null),[b,$]=m.useState(null),[k,A]=m.useState(""),[Q,F]=m.useState(!1),[w,H]=m.useState(""),M={producto_id:"",subtitulo:"",link:"",meta_titulo:"",meta_descripcion:"",imagen_principal:null,text_alt_principal:"",alt_imagen_card:"",imagenes_secundarias:[null,null,null],alt_imagenes_secundarias:["","",""],parrafo1:"",beneficios:["","",""],parrafo2:"",url_video:""},[a,c]=m.useState(M),z=r=>r?typeof r=="string"?r:r.parrafo||"":"";m.useEffect(()=>{if(j)if(n){const r=n.producto_id?.toString()||"";let t=z(n.parrafos?.[0]),s=["","",""];if(Array.isArray(n.parrafos))for(let i=1;i<=3;i++)s[i-1]=z(n.parrafos[i]);let l=z(n.parrafos?.[4]);c({producto_id:r,subtitulo:n.subtitulo||"",link:n.link||"",meta_titulo:n.etiqueta?.meta_titulo||"",meta_descripcion:n.etiqueta?.meta_descripcion||"",imagen_principal:null,text_alt_principal:n.text_alt_principal||"",alt_imagen_card:n.alt_imagen_card||"",imagenes_secundarias:[null,null,null],alt_imagenes_secundarias:[n.imagenes?.[0]?.text_alt||"",n.imagenes?.[1]?.text_alt||"",n.imagenes?.[2]?.text_alt||""],parrafo1:t,beneficios:s,parrafo2:l,url_video:n.url_video||""}),D(n.nombre_producto||"")}else c(M),D("")},[j,n]),m.useEffect(()=>{(async()=>{if(j){v(!0);try{const t=localStorage.getItem("token"),s=await fetch(E(R.endpoints.productos.all),{method:"GET",headers:{Authorization:`Bearer ${t}`,Accept:"application/json","Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const l=await s.json();l.success&&Array.isArray(l.data)?_(l.data):Array.isArray(l)?_(l):_([])}catch(t){console.error("Error al obtener productos:",t),_([]),alert("âŒ Error al cargar los productos. Por favor, intenta de nuevo.")}finally{v(!1)}}})()},[j]);const h=r=>{c({...a,[r.target.name]:r.target.value})},T=r=>{c({...a,[r.target.name]:r.target.value})},W=(r,t)=>{const s=r.target.files?.[0];if(s){if(s.size>2048*1024){S.fire({icon:"warning",title:"Â¡Imagen muy grande!",text:"MÃ¡x. 2 MB."}),r.target&&(r.target.value="");return}c({...a,[t]:s})}},X=(r,t)=>{const s=r.target.files?.[0]||null;if(s&&s.size>2048*1024){S.fire({icon:"warning",title:"Â¡Imagen muy grande!",text:"MÃ¡x. 2 MB."}),r.target&&(r.target.value="");return}const l=[...a.imagenes_secundarias];l[t]=s,c({...a,imagenes_secundarias:l})},Y=(r,t)=>{const s=[...a.alt_imagenes_secundarias];s[t]=r.target.value,c({...a,alt_imagenes_secundarias:s})},Z=r=>{c({...a,parrafo1:r.target.value})},ee=r=>{c({...a,parrafo2:r.target.value})},ae=(r,t)=>{const s=[...a.beneficios];s[t]=r.target.value,c({...a,beneficios:s})},B=(r,t)=>{let s="";r==="parrafo1"?s="parrafo1":r==="parrafo2"?s="parrafo2":r==="beneficio"&&t!==void 0&&(s=`beneficio-${t}`);const l=document.getElementById(s);if(!l)return;const i=l.selectionStart,o=l.selectionEnd;if(i===o){S.fire("Selecciona texto","Selecciona una palabra o frase antes de insertar el enlace.","warning");return}const g=l.value.substring(i,o);I(r),L(t!==void 0?t:null),$({start:i,end:o}),A(g),O(!0)},re=()=>{if(!p||!b||!w.trim())return;const t=`<strong><a href="${w}" target="_blank" rel="noopener noreferrer">${k}</a></strong>`,s=l=>l.slice(0,b.start)+t+l.slice(b.end);if(p==="parrafo1")c({...a,parrafo1:s(a.parrafo1)});else if(p==="parrafo2")c({...a,parrafo2:s(a.parrafo2)});else if(p==="beneficio"&&x!==null){const l=[...a.beneficios];l[x]=s(l[x]),c({...a,beneficios:l})}N()},q=(r,t)=>{let s="";r==="parrafo1"?s="parrafo1":r==="parrafo2"?s="parrafo2":r==="beneficio"&&t!==void 0&&(s=`beneficio-${t}`);const l=document.getElementById(s);if(!l)return;const i=l.selectionStart,o=l.selectionEnd,g=l.value.substring(i,o);if(!g){S.fire("Selecciona texto","Selecciona una palabra o frase para enlazar a un producto.","warning");return}I(r),L(t!==void 0?t:null),$({start:i,end:o}),A(g),F(!0)},te=r=>{if(!p||!b)return;const t=k,s=`<strong><a href="/products/${r.link}" title="${r.nombre}">${t}</a></strong>`,l=i=>i.slice(0,b.start)+s+i.slice(b.end);if(p==="parrafo1")c({...a,parrafo1:l(a.parrafo1)});else if(p==="parrafo2")c({...a,parrafo2:l(a.parrafo2)});else if(p==="beneficio"&&x!==null){const i=[...a.beneficios];i[x]=l(i[x]),c({...a,beneficios:i})}N()},N=()=>{I(null),L(null),$(null),A(""),O(!1),F(!1),H("")},J=()=>{V(!1),N(),c(M)},se=async r=>{r.preventDefault();const t=!!n;if(!a.producto_id)return alert("âš ï¸ Debe seleccionar un producto.");if(!a.subtitulo.trim())return alert("âš ï¸ El subtÃ­tulo es obligatorio.");if(!t&&!a.imagen_principal)return alert("âš ï¸ La imagen principal es obligatoria para crear.");if(a.beneficios.filter(i=>i&&i.trim()).length<3)return alert("âš ï¸ Debe haber al menos 3 beneficios con contenido.");if(!a.parrafo1.trim())return alert("âš ï¸ El pÃ¡rrafo 1 (introducciÃ³n) es obligatorio.");if(!a.parrafo2.trim())return alert("âš ï¸ El pÃ¡rrafo 2 (conclusiÃ³n/testimonio) es obligatorio.");const l=/^[a-z0-9]+(?:-[a-z0-9]+)*$/;if(a.link&&!l.test(a.link))return alert("âš ï¸ El link debe ser URL-friendly (Solo letras minÃºsculas, guiones y nÃºmeros).");try{v(!0);const i=localStorage.getItem("token"),o=new FormData;o.append("producto_id",a.producto_id),o.append("subtitulo",a.subtitulo),o.append("url_video",a.url_video),a.link?.trim()&&o.append("link",a.link.trim());const g={meta_titulo:a.meta_titulo?.trim()||"",meta_descripcion:a.meta_descripcion?.trim()||""};(g.meta_titulo||g.meta_descripcion)&&o.append("etiqueta",JSON.stringify(g)),a.text_alt_principal?.trim()&&o.append("text_alt_principal",a.text_alt_principal.trim()),a.alt_imagen_card?.trim()&&o.append("alt_imagen_card",a.alt_imagen_card.trim()),a.imagen_principal&&o.append("imagen_principal",a.imagen_principal),a.imagenes_secundarias.filter(d=>d!==null).forEach(d=>o.append("imagenes[]",d)),a.alt_imagenes_secundarias.forEach((d,f)=>{(a.imagenes_secundarias[f]!==null||t&&d.trim())&&o.append("alt_imagenes[]",d.trim())}),o.append("parrafos[0]",a.parrafo1.trim()),a.beneficios.forEach((d,f)=>{d&&d.trim()&&o.append(`parrafos[${f+1}]`,d.trim())});const le=a.beneficios.length+1;o.append(`parrafos[${le}]`,a.parrafo2.trim());const ne=t?E(R.endpoints.blogs.update(n.id)):E(R.endpoints.blogs.create);t&&o.append("_method","PUT");const C=await fetch(ne,{method:"POST",body:o,headers:{Authorization:`Bearer ${i}`,Accept:"application/json"}});let u;try{u=await C.json()}catch{u=await C.text()}if(C.ok)alert(`âœ… Blog ${t?"actualizado":"creado"} correctamente.`),J(),G?.();else if(u.errors){let d=`âŒ Errores de validaciÃ³n:
`;Object.keys(u.errors).forEach(f=>{const ie=Array.isArray(u.errors[f])?u.errors[f]:[u.errors[f]];d+=`â€¢ ${f}: ${ie.join(", ")}
`}),alert(d)}else alert(`âŒ Error (${C.status}): ${u.message||JSON.stringify(u)}`)}catch(i){console.error("âŒ Error en la solicitud:",i),alert("âŒ Error en la conexiÃ³n con el servidor.")}finally{v(!1)}};return j?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"bg-white text-black px-4 sm:px-6 md:px-8 py-6 rounded-lg max-h-[90vh] w-full max-w-5xl mx-2 overflow-y-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-center md:text-left",children:n?"Editar Blog":"AÃ±adir Blog"}),e.jsxs("form",{onSubmit:se,encType:"multipart/form-data",className:"space-y-8",children:[e.jsxs("div",{className:"bg-blue-50 p-4 sm:p-6 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"InformaciÃ³n Principal & SEO"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"col-span-1 md:col-span-4",children:[e.jsxs("label",{className:"block mb-2 font-medium",children:["Producto ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"producto_id",value:a.producto_id,onChange:T,required:!0,className:"w-full bg-white text-black p-2 rounded-md border border-gray-300",disabled:y,children:[e.jsx("option",{value:"",children:y?"Cargando productos...":"-- Selecciona un producto --"}),P.map(r=>e.jsx("option",{value:r.id.toString(),children:r.nombre||`Producto ${r.id}`},r.id))]}),e.jsx("small",{className:"text-gray-500",children:"Selecciona el producto relacionado con este blog. Requerido."}),U&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Producto seleccionado: ",e.jsx("strong",{children:U})]})]}),e.jsxs("div",{className:"col-span-1 md:col-span-2",children:[e.jsxs("label",{className:"block font-medium mb-1",children:["SubtÃ­tulo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"subtitulo",value:a.subtitulo,onChange:h,className:"w-full border border-gray-300 rounded px-3 py-2",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"MÃ¡x. 120 caracteres (letras, nÃºmeros y espacios)."})]}),e.jsxs("div",{className:"col-span-1 md:col-span-2",children:[e.jsx("label",{className:"block font-medium mb-1",children:"Meta tÃ­tulo"}),e.jsx("input",{type:"text",name:"meta_titulo",value:a.meta_titulo||"",onChange:h,placeholder:"TÃ­tulo optimizado para SEO",className:"w-full border border-gray-300 rounded px-3 py-2"}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"MÃ¡x. 70 caracteres (letras, nÃºmeros y espacios)."})]}),e.jsxs("div",{className:"col-span-1 md:col-span-4",children:[e.jsx("label",{className:"block font-medium mb-1",children:"Meta descripciÃ³n"}),e.jsx("textarea",{name:"meta_descripcion",value:a.meta_descripcion||"",onChange:h,placeholder:"DescripciÃ³n optimizada para SEO",className:"w-full border border-gray-300 rounded px-3 py-2"}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"MÃ¡x. 160 caracteres (letras, nÃºmeros y espacios)."})]}),e.jsxs("div",{className:"col-span-1 md:col-span-4",children:[e.jsx("label",{className:"block font-medium mb-1",children:"Link (URL amigable)"}),e.jsx("input",{type:"text",name:"link",value:a.link,onChange:h,placeholder:"ejemplo: mi-blog-post",className:"w-full border border-gray-300 rounded px-3 py-2"}),e.jsx("small",{className:"text-gray-500",children:"Escribe solo letras y guiones. MÃ¡x. 255 letras o nÃºmeros."})]})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 sm:p-6 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-4",children:"ImÃ¡genes"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border border-green-400 rounded p-4",children:[e.jsxs("label",{className:"block font-medium mb-2",children:["Imagen Principal"," ",!n&&e.jsx("span",{className:"text-red-500",children:"*"})]}),n?.imagen_principal&&e.jsx("img",{src:n.imagen_principal,alt:a.text_alt_principal||"Imagen principal",className:"w-full h-48 sm:h-64 object-cover rounded mb-4 border"}),e.jsx("input",{type:"file",accept:"image/*",onChange:r=>W(r,"imagen_principal"),className:"w-full file:py-2 file:px-3 file:border-0 file:bg-green-100 file:text-green-700 hover:file:bg-green-200"}),e.jsx("small",{className:"text-gray-500",children:"Peso mÃ¡ximo: 2 MB."}),e.jsx("input",{type:"text",name:"text_alt_principal",placeholder:"Texto ALT para SEO",value:a.text_alt_principal,onChange:h,className:"mt-2 w-full border border-gray-300 rounded px-3 py-2"})]}),e.jsxs("div",{className:"border border-green-400 rounded p-4",children:[e.jsx("label",{className:"block font-semibold mb-4",children:"ImÃ¡genes Secundarias"}),e.jsx("small",{className:"text-gray-500",children:"ImÃ¡genes adicionales del artÃ­culo. Se crearÃ¡ un registro por archivo en la tabla imagen_blogs."}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:a.imagenes_secundarias.map((r,t)=>e.jsxs("div",{className:"flex flex-col items-center",children:[n?.imagenes?.[t]?.ruta_imagen&&e.jsx("img",{src:n.imagenes[t].ruta_imagen,alt:a.alt_imagenes_secundarias[t]||`Imagen secundaria #${t+1}`,className:"w-full h-32 object-cover rounded mb-2 border"}),e.jsx("input",{type:"file",accept:"image/*",onChange:s=>X(s,t),className:"w-full file:py-2 file:px-3 file:border-0 file:bg-green-100 file:text-green-700 hover:file:bg-green-200"}),e.jsxs("small",{className:"text-gray-500",children:["Archivo de imagen secundaria #",t+1,".",e.jsx("br",{}),"TamaÃ±o mÃ¡ximo: 2 MB."]}),e.jsx("input",{type:"text",placeholder:`Texto ALT imagen secundaria #${t+1}`,value:a.alt_imagenes_secundarias[t],onChange:s=>Y(s,t),className:"w-full border border-gray-300 rounded px-3 py-2 mt-2"})]},t))})]})]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 sm:p-6 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-4",children:"Video"}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL del Video *"}),e.jsx("input",{type:"url",name:"url_video",value:a.url_video,onChange:h,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("small",{className:"text-gray-500",children:"Solo minÃºsculas y guiones. Hasta 255 letras, nÃºmeros o espacios."})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 sm:p-6 rounded-lg border border-yellow-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-yellow-800 mb-4",children:["Contenido del Blog ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative mb-8",children:[e.jsxs("label",{htmlFor:"parrafo1",className:"block text-sm font-medium text-gray-700 mb-2",children:["PÃ¡rrafo 1 (IntroducciÃ³n) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"parrafo1",value:a.parrafo1,onChange:Z,className:"w-full border border-gray-300 rounded px-3 py-2 pr-20",rows:5,placeholder:"Escribe aquÃ­ la introducciÃ³n del blog...",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Este pÃ¡rrafo aparecerÃ¡ en la primera secciÃ³n del blog."}),e.jsxs("div",{className:"absolute top-10 right-2 flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>B("parrafo1"),className:"bg-blue-500 hover:bg-blue-700 text-white p-2 rounded-full shadow-lg transition text-sm",title:"Insertar enlace URL",children:"ðŸ”— URL"}),e.jsx("button",{type:"button",onClick:()=>q("parrafo1"),className:"bg-green-500 hover:bg-green-700 text-white p-2 rounded-full shadow-lg transition text-sm",title:"Enlazar producto",children:"ðŸ›’ Producto"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:["Lista de Beneficios ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("small",{className:"text-gray-500 block mb-4",children:"3 beneficios requeridos. Cada beneficio aparecerÃ¡ como un Ã­tem en la lista."}),a.beneficios.map((r,t)=>e.jsxs("div",{className:"relative mb-4 p-4 bg-white rounded border",children:[e.jsxs("label",{htmlFor:`beneficio-${t}`,className:"block text-sm font-medium text-gray-700 mb-2",children:["Beneficio ",t+1," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:`beneficio-${t}`,value:r,onChange:s=>ae(s,t),className:"w-full border border-gray-300 rounded px-3 py-2 pr-20",rows:3,placeholder:`Describe el beneficio ${t+1}...`,required:!0}),e.jsxs("div",{className:"absolute top-12 right-6 flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>B("beneficio",t),className:"bg-blue-500 hover:bg-blue-700 text-white p-2 rounded-full shadow-lg transition text-sm",title:"Insertar enlace URL",children:"ðŸ”—"}),e.jsx("button",{type:"button",onClick:()=>q("beneficio",t),className:"bg-green-500 hover:bg-green-700 text-white p-2 rounded-full shadow-lg transition text-sm",title:"Enlazar producto",children:"ðŸ›’"})]})]},t))]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsxs("label",{htmlFor:"parrafo2",className:"block text-sm font-medium text-gray-700 mb-2",children:["PÃ¡rrafo 2 (ConclusiÃ³n/Testimonio) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"parrafo2",value:a.parrafo2,onChange:ee,className:"w-full border border-gray-300 rounded px-3 py-2 pr-20",rows:5,placeholder:"Escribe aquÃ­ la conclusiÃ³n o testimonio del blog...",required:!0}),e.jsx("small",{className:"text-gray-500 block mt-1",children:"Este pÃ¡rrafo aparecerÃ¡ en la secciÃ³n de testimonio del cliente."}),e.jsxs("div",{className:"absolute top-10 right-2 flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>B("parrafo2"),className:"bg-blue-500 hover:bg-blue-700 text-white p-2 rounded-full shadow-lg transition text-sm",title:"Insertar enlace URL",children:"ðŸ”— URL"}),e.jsx("button",{type:"button",onClick:()=>q("parrafo2"),className:"bg-green-500 hover:bg-green-700 text-white p-2 rounded-full shadow-lg transition text-sm",title:"Enlazar producto",children:"ðŸ›’ Producto"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4",children:[e.jsx("button",{type:"button",onClick:J,className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",disabled:y,children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:y,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded disabled:opacity-50",children:y?"Procesando...":n?"Actualizar":"Crear"})]})]}),K&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-[60]",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Insertar Enlace"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Texto seleccionado: ",e.jsxs("strong",{children:['"',k,'"']})]}),e.jsx("input",{type:"url",value:w,onChange:r=>H(r.target.value),placeholder:"https://ejemplo.com",className:"w-full border border-gray-300 rounded px-3 py-2 mb-4",required:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:N,className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:re,disabled:!w.trim(),className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-300 text-white px-4 py-2 rounded",children:"Insertar"})]})]})}),Q&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-[60]",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Enlazar a Producto"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Texto seleccionado: ",e.jsxs("strong",{children:['"',k,'"']})]}),e.jsxs("select",{onChange:r=>{const t=parseInt(r.target.value),s=P.find(l=>l.id===t);s&&te(s)},className:"w-full border border-gray-300 rounded px-3 py-2 mb-4",children:[e.jsx("option",{value:"",children:"-- Seleccionar producto --"}),P.map(r=>e.jsx("option",{value:r.id,children:r.nombre},r.id))]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:N,className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",children:"Cancelar"})})]})})]})}):null};export{pe as A};
