import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.ai7qpRr1.js";import{g as C,c as R}from"./config.CT_CG-Xn.js";import{z as f}from"./index.ByYdXFAB.js";const O={src:"/_astro/yuleLove.CH0xEpdJ.jpg"},M="asesoriaModalLastClosed",D=1*60*1e3,k=f.object({nombre:f.string().min(1,"El nombre es obligatorio").max(100,"El nombre no puede exceder 100 caracteres").regex(/^[a-zA-ZáéíóúÁÉÍÓÚñÑüÜ\s]+$/,"El nombre solo puede contener letras y espacios"),email:f.string().min(1,"El email es obligatorio").email("El formato del correo electrónico es inválido").max(100,"El email no puede exceder 100 caracteres"),telefono:f.string().regex(/^[0-9]{9}$/,"El celular debe tener exactamente 9 dígitos").regex(/^[0-9]{9}$/,"El celular solo puede contener números")}),z=()=>{const[x,p]=a.useState(!1),[L,E]=a.useState(!1),[d,b]=a.useState({nombre:"",email:"",telefono:""}),[l,i]=a.useState({}),[j,y]=a.useState(!1),[N,m]=a.useState(""),S=a.useRef(0),h=a.useRef(!1),u=a.useRef(!1),g=a.useRef(null),w=n=>{const{name:s,value:o}=n.target;b({...d,[s]:o}),l[s]&&i(t=>({...t,[s]:""}))},A=async n=>{n.preventDefault(),i({}),m("");const s=k.safeParse(d);if(!s.success){const o={};s.error.errors.forEach(t=>{const r=t.path[0];o[r]=t.message}),i(o);return}y(!0);try{const o=new FormData;o.append("name",s.data.nombre),o.append("email",s.data.email),o.append("celular",s.data.telefono);const t=await fetch(C(R.endpoints.clientes.create),{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:o});if(t.type==="opaque"||t.url!==C(R.endpoints.clientes.create))throw new Error("Error de configuración del servidor. Por favor contacta al administrador.");let r;try{const c=await t.text();if(!c)throw new Error("Respuesta vacía del servidor");r=JSON.parse(c)}catch(c){throw console.error("[ScrollModal] Error parsing response:",c),console.error("[ScrollModal] Response status:",t.status),console.error("[ScrollModal] Response headers:",t.headers),new Error("Error al procesar la respuesta del servidor")}if(!t.ok){if(t.status===422&&r.errors){const c={};r.errors.name&&(c.nombre=Array.isArray(r.errors.name)?r.errors.name[0]:r.errors.name),r.errors.email&&(c.email=Array.isArray(r.errors.email)?r.errors.email[0]:r.errors.email),r.errors.celular&&(c.telefono=Array.isArray(r.errors.celular)?r.errors.celular[0]:r.errors.celular),i(c);return}throw new Error(r.message||`Error ${t.status}: ${t.statusText}`)}m("✅ Información enviada con éxito"),b({nombre:"",email:"",telefono:""}),setTimeout(()=>{v(),m("")},2e3)}catch(o){console.error("[ScrollModal] Error:",o),o.name==="TypeError"&&(o.message.includes("fetch")||o.message.includes("CORS"))?i({general:"Error de conexión con el servidor. Por favor intenta nuevamente."}):o.message.includes("configuración del servidor")?i({general:"Error de configuración del servidor. Contacta al administrador."}):i({general:o.message||"Error desconocido al enviar la información."})}finally{y(!1)}};a.useEffect(()=>{const n=s=>{g.current&&!g.current.contains(s.target)&&v()};return x&&document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[x]),a.useEffect(()=>{const n=()=>{p(!0),u.current=!0};return window.addEventListener("open-scroll-modal",n),()=>window.removeEventListener("open-scroll-modal",n)},[]),a.useEffect(()=>{const n=()=>{const s=window.scrollY,o=s<S.current?"up":"down";if(S.current=s,window.innerHeight+window.scrollY>=document.body.offsetHeight&&(h.current=!0),h.current&&o==="up"&&!u.current){const r=parseInt(localStorage.getItem(M)||"0",10);if(Date.now()-r<D)return;p(!0),u.current=!0,h.current=!1}};return window.addEventListener("scroll",n),()=>window.removeEventListener("scroll",n)},[]);const v=()=>{E(!0),setTimeout(()=>{p(!1),E(!1),localStorage.setItem(M,Date.now().toString()),u.current=!1,b({nombre:"",email:"",telefono:""}),i({}),m("")},300)};return x?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center px-4 modal-overlay",children:e.jsxs("div",{ref:g,className:`rounded-2xl bg-white flex flex-col sm:flex-row overflow-hidden shadow-lg w-[90%] max-w-[600px] sm:max-w-3xl relative ${L?"animate-slideOut":"animate-slideIn"}`,children:[e.jsx("div",{className:"hidden sm:block sm:w-1/2",children:e.jsx("img",{src:O.src,alt:"Asesoría",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"w-full sm:w-1/2 bg-[#293296] text-white relative p-8",children:[e.jsx("button",{onClick:v,"aria-label":"Cerrar modal",className:"absolute top-2 right-2 bg-white text-black rounded-full w-8 h-8 flex items-center justify-center hover:bg-gray-200 transition-colors cursor-pointer",children:"✕"}),e.jsxs("div",{className:"text-white mb-6",children:[e.jsx("p",{className:"text-2xl italic",children:"Gana"}),e.jsxs("p",{className:"text-7xl font-bold ",children:["10",e.jsx("span",{className:"text-6xl font-semibold",children:"%"})," ",e.jsx("span",{className:"text-5xl font-semibold italic",children:"dto."})]}),e.jsx("p",{className:"text-2xl",children:"en tu compra"})]}),e.jsxs("form",{onSubmit:A,className:"flex flex-col gap-1 mt-4",children:[e.jsx("label",{className:"text-lg font-bold",children:"Nombre"}),e.jsx("input",{name:"nombre",type:"text",value:d.nombre,onChange:w,className:`w-full px-4 py-2 rounded-full bg-white text-black mb-1 ${l.nombre?"border-2 border-red-500":""}`,placeholder:"Ingresa tu nombre"}),l.nombre&&e.jsx("p",{className:"text-red-400 text-sm mb-2",children:l.nombre}),e.jsx("label",{className:"text-lg font-bold",children:"Teléfono"}),e.jsx("input",{type:"tel",name:"telefono",value:d.telefono,onChange:w,className:`w-full px-4 py-2 rounded-full bg-white text-black mb-1 ${l.telefono?"border-2 border-red-500":""}`,placeholder:"Ej: 987654321",maxLength:9}),l.telefono&&e.jsx("p",{className:"text-red-400 text-sm mb-2",children:l.telefono}),e.jsx("label",{className:"text-lg font-bold",children:"Correo"}),e.jsx("input",{type:"email",name:"email",value:d.email,onChange:w,className:`w-full px-4 py-2 rounded-full bg-white text-black mb-1 ${l.email?"border-2 border-red-500":""}`,placeholder:"ejemplo@correo.com"}),l.email&&e.jsx("p",{className:"text-red-400 text-sm mb-2",children:l.email}),l.general&&e.jsx("div",{className:"bg-red-500/20 border border-red-500 rounded-lg p-3 mb-3",children:e.jsx("p",{className:"text-red-300 text-sm",children:l.general})}),N&&e.jsx("div",{className:"bg-green-500/20 border border-green-500 rounded-lg p-3 mb-3",children:e.jsx("p",{className:"text-green-300 text-sm",children:N})}),e.jsx("button",{type:"submit",disabled:j,className:"w-full bg-[#172649] text-white text-2xl border py-3 rounded-lg font-bold hover:bg-[#1a2954] transition-colors mt-8 disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Enviando...":"Cotiza ahora"})]})]})]})}):null};export{z as default};
