import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as x}from"./index.ai7qpRr1.js";import{h as v}from"./httpService.BWjNqOJ0.js";import{c as S}from"./config.CT_CG-Xn.js";class I{async getAllBlogs(){try{return await v.get(S.endpoints.blogs.list)}catch(r){throw console.error("[BlogService] Error obteniendo blogs:",r),r}}async getBlogById(r){try{return await v.get(S.endpoints.blogs.detail(r))}catch(t){throw console.error("[BlogService] Error obteniendo blog:",t),t}}async getBlogByLink(r){try{return await v.get(`/api/blogs/link/${r}`)}catch(t){throw console.error("[BlogService] Error obteniendo blog por link:",t),t}}async createBlog(r){try{const t=this.buildFormData(r);return await v.authenticatedPostFormData(S.endpoints.blogs.create,t)}catch(t){throw console.error("[BlogService] Error creando blog:",t),t}}async updateBlog(r,t){try{const o=this.buildFormData(t);return await v.authenticatedPutFormData(`/api/blog/${r}`,o)}catch(o){throw console.error("[BlogService] Error actualizando blog:",o),o}}async deleteBlog(r){try{return await v.authenticatedDelete(`/api/blogs/${r}`)}catch(t){throw console.error("[BlogService] Error eliminando blog:",t),t}}buildFormData(r){const t=new FormData;return t.append("titulo",r.titulo),t.append("link",r.link),r.producto_id&&r.producto_id!==""&&t.append("producto_id",r.producto_id),t.append("parrafo",r.parrafo),t.append("descripcion",r.descripcion),r.imagen_principal&&t.append("imagen_principal",r.imagen_principal),t.append("titulo_blog",r.titulo_blog||""),t.append("subtitulo_beneficio",r.subtitulo_beneficio||""),t.append("url_video",r.url_video||""),t.append("titulo_video",r.titulo_video||""),r.imagenes&&r.imagenes.length>0&&r.imagenes.forEach((o,i)=>{o.url_imagen&&(t.append(`imagenes[${i}][imagen]`,o.url_imagen),t.append(`imagenes[${i}][parrafo]`,o.parrafo_imagen||""))}),t}generateLinkFromTitle(r){return r.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim()}}const _=new I;function M(){const[y,r]=x.useState([]),[t,o]=x.useState(!0),[i,b]=x.useState(null),h=async()=>{try{o(!0),b(null);const c=await _.getAllBlogs();r(c.data)}catch(c){b(c instanceof Error?c.message:"Error desconocido al obtener blogs"),console.error("Error en useBlogs:",c)}finally{o(!1)}},d=async()=>{await h()};return x.useEffect(()=>{h()},[]),{blogs:y,loading:t,error:i,refetch:d}}function L(){const[y,r]=x.useState(!1),[t,o]=x.useState(null);return{loading:y,error:t,createBlog:async c=>{try{return r(!0),o(null),(await _.createBlog(c)).data}catch(a){const n=a instanceof Error?a.message:"Error desconocido al crear el blog";return o(n),console.error("Error creando blog:",a),null}finally{r(!1)}},updateBlog:async(c,a)=>{try{return r(!0),o(null),(await _.updateBlog(c,a)).data}catch(n){const f=n instanceof Error?n.message:"Error desconocido al actualizar el blog";return o(f),console.error("Error actualizando blog:",n),null}finally{r(!1)}},deleteBlog:async c=>{try{return r(!0),o(null),await _.deleteBlog(c),!0}catch(a){const n=a instanceof Error?a.message:"Error desconocido al eliminar el blog";return o(n),console.error("Error eliminando blog:",a),!1}finally{r(!1)}},clearError:()=>o(null)}}class C{static MAX_FILE_SIZE=10*1024*1024;static ALLOWED_MIME_TYPES=["image/jpeg","image/jpg","image/png","image/webp"];static validateImage(r){return r?this.ALLOWED_MIME_TYPES.includes(r.type)?r.size>this.MAX_FILE_SIZE?{valid:!1,error:`El archivo es demasiado grande. Tamaño máximo: ${this.formatFileSize(this.MAX_FILE_SIZE)}`}:{valid:!0}:{valid:!1,error:`Tipo de archivo no permitido. Use: ${this.ALLOWED_MIME_TYPES.join(", ")}`}:{valid:!1,error:"No se ha seleccionado ningún archivo"}}static formatFileSize(r){if(r===0)return"0 Bytes";const t=1024,o=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(r)/Math.log(t));return parseFloat((r/Math.pow(t,i)).toFixed(2))+" "+o[i]}static createPreviewUrl(r){return r&&r.type.startsWith("image/")?URL.createObjectURL(r):null}static revokePreviewUrl(r){r&&URL.revokeObjectURL(r)}static async resizeImage(r,t=1920,o=1080,i=.8){return new Promise((b,h)=>{const d=document.createElement("canvas"),c=d.getContext("2d"),a=new Image;a.onload=()=>{let{width:n,height:f}=a;if(n>t||f>o){const u=Math.min(t/n,o/f);n*=u,f*=u}d.width=n,d.height=f,c?.drawImage(a,0,0,n,f),d.toBlob(u=>{if(u){const m=new File([u],r.name,{type:r.type,lastModified:Date.now()});b(m)}else h(new Error("Error al redimensionar la imagen"))},r.type,i)},a.onerror=()=>h(new Error("Error al cargar la imagen")),a.src=URL.createObjectURL(r)})}static generateUniqueFileName(r){const t=Date.now(),o=Math.random().toString(36).substring(2,15),i=r.split(".").pop();return`${t}_${o}.${i}`}static async extractImageMetadata(r){return new Promise((t,o)=>{const i=new Image;i.onload=()=>{t({width:i.naturalWidth,height:i.naturalHeight,size:r.size,type:r.type,name:r.name})},i.onerror=()=>o(new Error("Error al cargar la imagen")),i.src=URL.createObjectURL(r)})}}const F=({isOpen:y,onClose:r,blogToEdit:t,onSuccess:o})=>{const{createBlog:i,updateBlog:b,loading:h,error:d,clearError:c}=L(),[a,n]=x.useState({titulo:"",link:"",producto_id:"",parrafo:"",descripcion:"",imagen_principal:null,titulo_blog:"",subtitulo_beneficio:"",url_video:"",titulo_video:"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]}),[f,u]=x.useState(!1);x.useEffect(()=>{t&&(n({titulo:t.titulo,link:t.link,producto_id:t.producto_id.toString(),parrafo:t.parrafo,descripcion:t.descripcion,imagen_principal:null,titulo_blog:t.tituloBlog||"",subtitulo_beneficio:t.subTituloBlog||"",url_video:t.videoBlog||"",titulo_video:t.tituloVideoBlog||"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]}),u(!0))},[t]),x.useEffect(()=>{a.titulo&&!f&&n(s=>({...s,link:_.generateLinkFromTitle(a.titulo)}))},[a.titulo,f]);const m=s=>{const{name:l,value:g}=s.target;l==="titulo"&&u(!1),l==="link"&&u(!0),n(p=>({...p,[l]:g}))},B=s=>{const{name:l,files:g}=s.target;if(g&&g[0]){const p=g[0],w=C.validateImage(p);if(!w.valid){alert(w.error);return}n(k=>({...k,[l]:p}))}},N=(s,l,g)=>{if(l==="url_imagen"&&g instanceof File){const p=C.validateImage(g);if(!p.valid){alert(p.error);return}}n(p=>({...p,imagenes:p.imagenes?.map((w,k)=>k===s?{...w,[l]:g}:w)||[]}))},E=async s=>{if(s.preventDefault(),c(),!a.titulo||!a.link||!a.parrafo||!a.descripcion){alert("Por favor, completa todos los campos obligatorios.");return}if(!a.titulo_blog||!a.subtitulo_beneficio||!a.url_video||!a.titulo_video){alert("Por favor, completa todos los campos de información adicional del blog.");return}if(!t&&!a.imagen_principal){alert("Por favor, selecciona una imagen principal.");return}if(!a.imagenes||a.imagenes.length===0||!a.imagenes[0].url_imagen){alert("Por favor, selecciona al menos una imagen adicional.");return}try{let l=null;t?l=await b(t.id,a):l=await i(a),l&&(o?.(l),j())}catch(l){console.error("Error al guardar el blog:",l)}},j=()=>{n({titulo:"",link:"",producto_id:"",parrafo:"",descripcion:"",imagen_principal:null,titulo_blog:"",subtitulo_beneficio:"",url_video:"",titulo_video:"",imagenes:[{url_imagen:null,parrafo_imagen:""},{url_imagen:null,parrafo_imagen:""}]}),u(!1),c(),r()};return y?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:t?"Editar Blog":"Crear Nuevo Blog"}),e.jsx("button",{onClick:j,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),d&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:d}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título *"}),e.jsx("input",{type:"text",name:"titulo",value:a.titulo,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Link (URL amigable) *"}),e.jsx("input",{type:"text",name:"link",value:a.link,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID del Producto (opcional)"}),e.jsx("input",{type:"number",name:"producto_id",value:a.producto_id,onChange:m,placeholder:"Deja vacío si no tienes productos aún",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Puedes asociar este blog a un producto específico (opcional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Párrafo *"}),e.jsx("textarea",{name:"parrafo",value:a.parrafo,onChange:m,required:!0,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción *"}),e.jsx("textarea",{name:"descripcion",value:a.descripcion,onChange:m,required:!0,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Imagen Principal ",!t&&"*"]}),e.jsx("input",{type:"file",name:"imagen_principal",onChange:B,accept:"image/*",required:!t,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título del Blog *"}),e.jsx("input",{type:"text",name:"titulo_blog",value:a.titulo_blog,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subtítulo *"}),e.jsx("input",{type:"text",name:"subtitulo_beneficio",value:a.subtitulo_beneficio,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL del Video *"}),e.jsx("input",{type:"url",name:"url_video",value:a.url_video,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título del Video *"}),e.jsx("input",{type:"text",name:"titulo_video",value:a.titulo_video,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-3",children:"Imágenes Adicionales * (Al menos 1 requerida)"}),a.imagenes?.map((s,l)=>e.jsxs("div",{className:"border border-gray-200 rounded-md p-4 mb-4",children:[e.jsxs("h4",{className:"text-md font-medium text-gray-600 mb-2",children:["Imagen ",l+1]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Archivo de Imagen ",l===0?"*":""]}),e.jsx("input",{type:"file",accept:"image/*",required:l===0,onChange:g=>{const p=g.target.files?.[0];p&&N(l,"url_imagen",p)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Párrafo de la Imagen"}),e.jsx("textarea",{value:s.parrafo_imagen,onChange:g=>N(l,"parrafo_imagen",g.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]},l))]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:j,className:"px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Guardando...":t?"Actualizar":"Crear"})]})]})]})})}):null},P=()=>{const{blogs:y,loading:r,error:t,refetch:o}=M(),{deleteBlog:i,loading:b}=L(),[h,d]=x.useState(!1),[c,a]=x.useState(null),[n,f]=x.useState(""),u=y.filter(s=>s.titulo.toLowerCase().includes(n.toLowerCase())||s.descripcion.toLowerCase().includes(n.toLowerCase())),m=s=>{a(s),d(!0)},B=async s=>{window.confirm("¿Estás seguro de que quieres eliminar este blog?")&&await i(s)&&o()},N=()=>{d(!1),a(null)},E=s=>{o()},j=s=>new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"});return r?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t?e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:["Error cargando blogs: ",t]}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Gestión de Blogs"}),e.jsx("button",{onClick:()=>d(!0),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Crear Nuevo Blog"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Buscar blogs...",value:n,onChange:s=>f(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:u.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:n?"No se encontraron blogs que coincidan con tu búsqueda.":"No hay blogs disponibles."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Imagen"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Título"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("img",{src:s.imagenPrincipal,alt:s.titulo,className:"h-16 w-16 rounded-lg object-cover"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.titulo}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",s.id]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:s.descripcion})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:j(s.created_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>m(s),className:"text-blue-600 hover:text-blue-900 bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded",children:"Editar"}),e.jsx("button",{onClick:()=>B(s.id),disabled:b,className:"text-red-600 hover:text-red-900 bg-red-100 hover:bg-red-200 px-3 py-1 rounded disabled:opacity-50",children:b?"Eliminando...":"Eliminar"}),e.jsx("a",{href:`/blogs/${s.id}`,target:"_blank",rel:"noopener noreferrer",className:"text-green-600 hover:text-green-900 bg-green-100 hover:bg-green-200 px-3 py-1 rounded",children:"Ver"})]})})]},s.id))})]})})}),e.jsx(F,{isOpen:h,onClose:N,blogToEdit:c,onSuccess:E})]})},D=()=>e.jsx("div",{children:e.jsx(P,{})});export{D as default};
