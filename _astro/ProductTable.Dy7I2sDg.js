import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{a as P,F as q}from"./index.yBaegBIJ.js";import{r as d}from"./index.ai7qpRr1.js";import{S as h}from"./sweetalert2.esm.all.B0Dix5B2.js";import{I as i}from"./Input.7eyBNoVA.js";import{g as E,c as S}from"./config.DAMyqOaI.js";import"./iconBase.CsihB_xR.js";const V=({children:a,isOpen:b,onClose:u,title:l,form:c,btnText:m})=>b?e.jsx("div",{className:"flex items-center justify-center fixed inset-0  bg-black/40 ",children:e.jsxs("div",{className:"relative bg-white px-3 py-4 rounded-xl max-w-5xl sm:min-w-2xl mx-auto",children:[l&&e.jsx("h2",{className:"text-2xl font-bold mb-4 pl-3",children:l}),e.jsx("button",{onClick:u,className:"absolute top-4 right-7 cursor-pointer text-2xl bg-white rounded-full",children:"✕"}),e.jsx("div",{className:"overflow-y-auto max-h-[700px] px-3",children:a}),e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-auto space-x-2 mt-4 col-span-2",children:[e.jsx("button",{type:"submit",form:c,className:"bg-blue-600 text-white font-semibold px-5 py-2 rounded-lg hover:bg-blue-700 transition duration-200 cursor-pointer",children:m}),e.jsx("button",{onClick:u,className:"bg-gray-300 text-gray-800 font-semibold px-5 py-2 rounded-lg hover:bg-gray-400 transition duration-200 cursor-pointer",children:"Cancelar"})]})})]})}):null,O=({initialData:a,onSubmit:b,isEditing:u})=>{const[l,c]=d.useState(a?.imagenes||[]),[m,j]=d.useState([]),[y,w]=d.useState(""),[g,r]=d.useState(a?.relacionados||[]),p=()=>{y.trim()&&(r([...g,y.trim()]),w(""))},f=t=>{r(g.filter(s=>s!==t))},N=t=>{c(l.filter(s=>s.id!==t)),j([...m,t])},[o,x]=d.useState([{file:null,alt:""}]),k=(t,s)=>{const n=[...o];n[t].file=s,x(n)},I=(t,s)=>{const n=[...o];n[t].alt=s,x(n)},A=()=>{const t=o[o.length-1];t.file&&t.alt.trim()&&x([...o,{file:null,alt:""}])},T=async t=>{t.preventDefault();const s=new FormData(t.currentTarget);o.forEach((v,C)=>{v.file&&(s.append(`imagenes[${C}]`,v.file),s.append(`textos_alt[${C}]`,v.alt))});const n={color:s.get("color"),material:s.get("material")};s.append("especificaciones",JSON.stringify(n)),g.forEach((v,C)=>{s.append(`relacionados[${C}]`,v)}),u&&s.append("_method","PUT"),m.length>0&&s.append("imagenes_a_eliminar",JSON.stringify(m)),await b(s)};return e.jsxs("form",{id:"eliminentechno3",onSubmit:T,className:"grid max-sm:grid-cols-1 grid-cols-2 gap-5",children:[e.jsx(i,{label:"Nombre",name:"nombre",defaultValue:a?.nombre,required:!0}),e.jsx(i,{label:"Título",name:"titulo",defaultValue:a?.titulo,required:!0}),e.jsx(i,{label:"Subtítulo",name:"subtitulo",defaultValue:a?.subtitulo,required:!0}),e.jsx(i,{label:"Lema",name:"lema",defaultValue:a?.lema,required:!0}),e.jsx(i,{label:"Descripción",type:"textarea",rows:3,name:"descripcion",defaultValue:a?.descripcion,className:"col-span-2",required:!0}),e.jsx(i,{label:"Stock",type:"number",name:"stock",defaultValue:a?.stock,required:!0}),e.jsx(i,{label:"Precio",type:"number",name:"precio",defaultValue:a?.precio,required:!0}),e.jsx(i,{label:"Sección",name:"seccion",defaultValue:a?.seccion,required:!0}),e.jsx(i,{label:"Link",name:"link",defaultValue:a?.link,required:!0}),e.jsx(i,{label:"Color",name:"color",defaultValue:a?.especificaciones.color,required:!0}),e.jsx(i,{label:"Material",name:"material",defaultValue:a?.especificaciones.material,required:!0}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"font-medium text-gray-700",children:"Relacionados (IDs)"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("input",{type:"text",placeholder:"Ingresa el ID del producto relacionado.",value:y,onChange:t=>w(t.target.value),className:"border border-gray-300 px-3 py-2 rounded-md w-full text-sm"}),e.jsx("button",{type:"button",onClick:p,className:"bg-green-500 text-white px-3 py-2 rounded-md hover:bg-green-600 text-sm",children:"Agregar"})]}),e.jsx("div",{className:"flex flex-wrap mt-2 gap-2",children:g.map((t,s)=>e.jsxs("span",{className:"bg-gray-200 text-gray-800 px-3 py-1 rounded-full text-sm flex items-center gap-2",children:[t,e.jsx("button",{type:"button",onClick:()=>f(t),className:"text-red-500 hover:text-red-700 font-bold",children:"×"})]},s))})]}),e.jsx("label",{className:"font-medium col-span-2 text-gray-700 mt-3",children:"Imagenes"}),e.jsx("div",{className:"col-span-2",children:l.length===0?e.jsx("div",{className:"text-center text-gray-500 italic py-8",children:u?"No hay imágenes registradas para este producto.":"Agrega imagenes para este producto."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:l.map(t=>e.jsxs("div",{className:"flex flex-col items-center p-4 bg-white rounded-xl shadow-md border hover:shadow-lg transition duration-300",children:[e.jsx("img",{src:`https://apiyuntas.yuntaspublicidad.com${t.url_imagen}`,alt:t.texto_alt_SEO,className:"w-32 h-32 object-cover rounded-lg mb-2"}),e.jsx("span",{className:"text-center text-gray-700 text-sm mb-2",children:t.texto_alt_SEO}),e.jsx("button",{type:"button",onClick:()=>N(t.id),className:"bg-red-100 text-red-600 text-xs px-3 py-1 rounded-full hover:bg-red-200 transition",children:"Eliminar"})]},t.id))})}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[o.map((t,s)=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 p-2 bg-white rounded-xl shadow-sm border border-gray-300",children:[e.jsx("div",{className:"relative w-full sm:w-2/1",children:e.jsx("input",{type:"file",accept:"image/*",name:"imagenes",onChange:n=>k(s,n.target.files?.[0]||null),className:`file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 
               file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 
               hover:file:bg-blue-100 text-sm text-gray-600 rounded-md w-full file:cursor-pointer cursor-pointer`})}),e.jsx("input",{type:"text",placeholder:"Texto ALT",name:"textos_alt",value:t.alt,onChange:n=>I(s,n.target.value),className:"border border-gray-300 px-3 py-2 rounded-md w-full text-sm"})]},s)),e.jsx("button",{type:"button",onClick:A,className:"inline-block px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100 transition mt-2 cursor-pointer",children:"+ Agregar otra imagen"})]})]})};function M(){const[a,b]=d.useState([]),[u,l]=d.useState(!1),[c,m]=d.useState(void 0),j=async()=>{const r=E(S.endpoints.productos.list),f=await(await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}})).json();b(f)},y=async r=>{const p=E(S.endpoints.productos.delete(r)),f=localStorage.getItem("token");if((await h.fire({title:"¿Estás seguro?",text:"¡Esta acción no se puede deshacer!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)try{const o=await fetch(p,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`}}),x=await o.json();o.ok?(h.fire("¡Eliminado!",x.message,"success"),j()):h.fire("Error",x.message,"error")}catch{h.fire("Error","No se pudo eliminar el producto.","error")}},w=r=>{m(r),l(!0)},g=async function(r){const p=E(S.endpoints.productos.create),f=localStorage.getItem("token");try{const N=c?E(S.endpoints.productos.update(c.id)):p,o=await fetch(N,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${f}`},body:r}),x=await o.json();o.ok?(h.fire({title:`${x.message}`,icon:"success"}),l(!1),j()):h.fire({title:`${x.message}`,icon:"error"})}catch{h.fire({title:"Hubo un error al insertar el producto",icon:"error"})}};return d.useEffect(()=>(u?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[u]),d.useEffect(()=>{j()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-row gap-4",children:e.jsx("button",{onClick:()=>{m(void 0),l(!0)},className:"mt-4 bg-blue-950 hover:bg-blue-800 text-white text-lg px-10 py-1.5 rounded-full flex items-center gap-2",children:"Añadir Producto"})}),e.jsxs("table",{className:"w-full border-separate border-spacing-2",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-950 text-white",children:[e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"ID"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"NOMBRE"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"SECCION"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"PRECIO"}),e.jsx("th",{className:"px-4 py-2 rounded-xl",children:"ACCIÓN"})]})}),e.jsx("tbody",{children:a.map((r,p)=>e.jsxs("tr",{className:`text-center ${p%2===0?"bg-gray-100":"bg-gray-300"}`,children:[e.jsx("td",{className:"p-2 font-bold rounded-xl",children:r.id}),e.jsx("td",{className:"p-2 font-bold rounded-xl",children:r.nombre}),e.jsx("td",{className:"p-2 font-bold rounded-xl",children:r.seccion}),e.jsx("td",{className:"p-2 font-bold rounded-xl",children:r.precio}),e.jsx("td",{className:"p-2 rounded-xl",children:e.jsxs("div",{className:"flex justify-center gap-5 rounded-xl",children:[e.jsx("button",{onClick:()=>w(r),className:"text-green-600 hover:text-green-800 transition cursor-pointer",title:"Confirmar",children:e.jsx(P,{size:18})}),e.jsx("button",{onClick:()=>y(r.id),className:"text-red-600 hover:text-red-800 transition cursor-pointer",title:"Eliminar",children:e.jsx(q,{size:18})})]})})]},r.id))})]}),e.jsx(V,{isOpen:u,onClose:()=>{l(!1),m(void 0)},title:c?"Editar Datos":"Ingresar Datos",form:"eliminentechno3",btnText:c?"Guardar Cambios":"Añadir",children:e.jsx(O,{initialData:c,onSubmit:g,isEditing:!!c})})]})}export{M as default};
