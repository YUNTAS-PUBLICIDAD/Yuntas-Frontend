import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as h,R as A}from"./index.ai7qpRr1.js";import{d as he,l as xe}from"./index.C5s5t-Qp.js";import{g as G,c as J}from"./config.DqK_gEEU.js";import{S as se}from"./sweetalert2.esm.all.B0Dix5B2.js";import{T as ve}from"./TableContainer.BXE2yXaj.js";import{d as we,S as _e,c as je,P as le,A as Ee}from"./autoplay.C5Y-zvcZ.js";import"./iconBase.CsihB_xR.js";const ye=({isOpen:a,setIsOpen:e,blogToEdit:r,onSuccess:n})=>{const[g,c]=h.useState([]),[x,w]=h.useState(""),[s,P]=h.useState(!1),[u,v]=h.useState(!1),[N,I]=h.useState(null),[O,d]=h.useState(null),[p,i]=h.useState(""),[_,l]=h.useState(!1),[y,j]=h.useState(""),S={producto_id:"",subtitulo:"",link:"",meta_titulo:"",meta_descripcion:"",imagen_principal:null,text_alt_principal:"",alt_imagen_card:"",imagenes_secundarias:[null,null,null],alt_imagenes_secundarias:["","",""],parrafos:["","",""],url_video:""},[o,C]=h.useState(S);h.useEffect(()=>{if(a)if(r){const m=r.producto_id?.toString()||"";C({producto_id:m,subtitulo:r.subtitulo||"",link:r.link||"",meta_titulo:r.etiqueta?.meta_titulo||"",meta_descripcion:r.etiqueta?.meta_descripcion||"",imagen_principal:null,text_alt_principal:r.text_alt_principal||"",alt_imagen_card:r.alt_imagen_card||"",imagenes_secundarias:[null,null,null],alt_imagenes_secundarias:[r.imagenes?.[0]?.text_alt||"",r.imagenes?.[1]?.text_alt||"",r.imagenes?.[2]?.text_alt||""],parrafos:[r.parrafos?.[0]?.parrafo||"",r.parrafos?.[1]?.parrafo||"",r.parrafos?.[2]?.parrafo||""],url_video:r.url_video||""}),w(r.nombre_producto||"")}else C(S),w("")},[a,r]),h.useEffect(()=>{(async()=>{if(a){P(!0);try{const f=localStorage.getItem("token"),E=await fetch(G(J.endpoints.productos.all),{method:"GET",headers:{Authorization:`Bearer ${f}`,Accept:"application/json","Content-Type":"application/json"}});if(!E.ok)throw new Error(`HTTP error! status: ${E.status}`);const k=await E.json();k.success&&Array.isArray(k.data)?c(k.data):Array.isArray(k)?c(k):c([])}catch(f){console.error("Error al obtener productos:",f),c([]),alert("❌ Error al cargar los productos. Por favor, intenta de nuevo.")}finally{P(!1)}}})()},[a]);const b=m=>{C({...o,[m.target.name]:m.target.value})},q=m=>{C({...o,[m.target.name]:m.target.value})},R=(m,f)=>{m.target.files?.[0]&&C({...o,[f]:m.target.files[0]})},T=(m,f)=>{const E=[...o.imagenes_secundarias];E[f]=m.target.files?.[0]||null,C({...o,imagenes_secundarias:E})},H=(m,f)=>{const E=[...o.alt_imagenes_secundarias];E[f]=m.target.value,C({...o,alt_imagenes_secundarias:E})},Z=(m,f)=>{const E=[...o.parrafos];E[f]=m.target.value,C({...o,parrafos:E})},Q=m=>{const f=document.getElementById(`parrafo-${m}`);if(!f)return;const E=f.selectionStart,k=f.selectionEnd;if(E===k){se.fire("Selecciona texto","Selecciona una palabra o frase antes de insertar el enlace.","warning");return}const B=f.value.substring(E,k);I(m),d({start:E,end:k}),i(B),v(!0)},ee=()=>{if(N===null||O===null||!y.trim())return;const m=o.parrafos[N],f=`<a href="${y}" target="_blank" rel="noopener noreferrer">${p}</a>`,E=m.slice(0,O.start)+f+m.slice(O.end),k=[...o.parrafos];k[N]=E,C({...o,parrafos:k}),I(null),d(null),i(""),j(""),v(!1)},te=m=>{const f=document.getElementById(`parrafo-${m}`);if(!f)return;const E=f.selectionStart,k=f.selectionEnd,B=f.value.substring(E,k);if(!B){se.fire("Selecciona texto","Selecciona una palabra o frase para enlazar a un producto.","warning");return}I(m),d({start:E,end:k}),i(B),l(!0)},ae=m=>{if(N===null||O===null)return;const f=o.parrafos[N],k=`<a href="/products/producto/?link=${m.link}" style="color: blue; text-decoration: underline;">${p}</a>`,B=f.slice(0,O.start)+k+f.slice(O.end),$=[...o.parrafos];$[N]=B,C({...o,parrafos:$}),I(null),d(null),i(""),l(!1)},L=()=>{e(!1),I(null),d(null),i(""),v(!1),l(!1),j(""),C(S)},z=async m=>{m.preventDefault();const f=!!r;if(!o.producto_id)return alert("⚠️ Debe seleccionar un producto.");if(!o.subtitulo.trim())return alert("⚠️ El subtítulo es obligatorio.");if(!f&&!o.imagen_principal)return alert("⚠️ La imagen principal es obligatoria para crear.");const E=o.parrafos.filter(B=>B.trim());if(E.length===0)return alert("⚠️ Debe haber al menos un párrafo con contenido.");const k=/^[a-z0-9]+(?:-[a-z0-9]+)*$/;if(o.link&&!k.test(o.link))return alert("⚠️ El link debe ser URL-friendly (solo minúsculas, guiones y números).");try{P(!0);const B=localStorage.getItem("token"),$=new FormData;$.append("producto_id",o.producto_id),$.append("subtitulo",o.subtitulo),$.append("url_video",o.url_video),o.link?.trim()&&$.append("link",o.link.trim());const re={meta_titulo:o.meta_titulo?.trim()||"",meta_descripcion:o.meta_descripcion?.trim()||""};(re.meta_titulo||re.meta_descripcion)&&$.append("etiqueta",JSON.stringify(re)),o.text_alt_principal?.trim()&&$.append("text_alt_principal",o.text_alt_principal.trim()),o.alt_imagen_card?.trim()&&$.append("alt_imagen_card",o.alt_imagen_card.trim()),o.imagen_principal&&$.append("imagen_principal",o.imagen_principal),o.imagenes_secundarias.filter(D=>D!==null).forEach(D=>$.append("imagenes[]",D)),o.alt_imagenes_secundarias.forEach((D,V)=>{(o.imagenes_secundarias[V]!==null||f&&D.trim())&&$.append("alt_imagenes[]",D.trim())}),E.forEach(D=>$.append("parrafos[]",D.trim()));const ge=f?G(J.endpoints.blogs.update(r.id)):G(J.endpoints.blogs.create);f&&$.append("_method","PUT");const X=await fetch(ge,{method:"POST",body:$,headers:{Authorization:`Bearer ${B}`,Accept:"application/json"}});let M;try{M=await X.json()}catch{M=await X.text()}if(X.ok)alert(`✅ Blog ${f?"actualizado":"creado"} correctamente.`),L(),n?.();else if(M.errors){let D=`❌ Errores de validación:
`;Object.keys(M.errors).forEach(V=>{const be=Array.isArray(M.errors[V])?M.errors[V]:[M.errors[V]];D+=`• ${V}: ${be.join(", ")}
`}),alert(D)}else alert(`❌ Error (${X.status}): ${M.message||JSON.stringify(M)}`)}catch(B){console.error("❌ Error en la solicitud:",B),alert("❌ Error en la conexión con el servidor.")}finally{P(!1)}};return a?t.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:t.jsxs("div",{className:"bg-white text-black px-4 sm:px-6 md:px-8 py-6 rounded-lg max-h-[90vh] w-full max-w-5xl mx-2 overflow-y-auto",children:[t.jsx("h2",{className:"text-2xl font-bold mb-6 text-center md:text-left",children:r?"Editar Blog":"Añadir Blog"}),t.jsxs("form",{onSubmit:z,encType:"multipart/form-data",className:"space-y-8",children:[t.jsxs("div",{className:"bg-blue-50 p-4 sm:p-6 rounded-lg border border-blue-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"Información Principal & SEO"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"col-span-1 md:col-span-4",children:[t.jsxs("label",{className:"block mb-2 font-medium",children:["Producto ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("select",{name:"producto_id",value:o.producto_id,onChange:q,required:!0,className:"w-full bg-white text-black p-2 rounded-md border border-gray-300",disabled:s,children:[t.jsx("option",{value:"",children:s?"Cargando productos...":"-- Selecciona un producto --"}),g.map(m=>t.jsx("option",{value:m.id.toString(),children:m.nombre||`Producto ${m.id}`},m.id))]}),x&&t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Producto seleccionado: ",t.jsx("strong",{children:x})]})]}),t.jsxs("div",{className:"col-span-1 md:col-span-2",children:[t.jsxs("label",{className:"block font-medium mb-1",children:["Subtítulo ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{name:"subtitulo",value:o.subtitulo,onChange:b,className:"w-full border border-gray-300 rounded px-3 py-2",required:!0})]}),t.jsxs("div",{className:"col-span-1 md:col-span-2",children:[t.jsx("label",{className:"block font-medium mb-1",children:"Meta título"}),t.jsx("input",{type:"text",name:"meta_titulo",value:o.meta_titulo||"",onChange:b,placeholder:"Título optimizado para SEO",className:"w-full border border-gray-300 rounded px-3 py-2"})]}),t.jsxs("div",{className:"col-span-1 md:col-span-2",children:[t.jsx("label",{className:"block font-medium mb-1",children:"Meta descripción"}),t.jsx("input",{type:"text",name:"meta_descripcion",value:o.meta_descripcion||"",onChange:b,placeholder:"Descripción optimizada para SEO",className:"w-full border border-gray-300 rounded px-3 py-2"})]}),t.jsxs("div",{className:"col-span-1 md:col-span-4",children:[t.jsx("label",{className:"block font-medium mb-1",children:"Link (URL amigable)"}),t.jsx("input",{type:"text",name:"link",value:o.link,onChange:b,placeholder:"ejemplo: mi-blog-post",className:"w-full border border-gray-300 rounded px-3 py-2"})]})]})]}),t.jsxs("div",{className:"bg-green-50 p-4 sm:p-6 rounded-lg border border-green-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-4",children:"Imágenes"}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"border border-green-400 rounded p-4",children:[t.jsxs("label",{className:"block font-medium mb-2",children:["Imagen Principal ",!r&&t.jsx("span",{className:"text-red-500",children:"*"})]}),r?.imagen_principal&&t.jsx("img",{src:r.imagen_principal,alt:o.text_alt_principal||"Imagen principal",className:"w-full h-48 sm:h-64 object-cover rounded mb-4 border"}),t.jsx("input",{type:"file",accept:"image/*",onChange:m=>R(m,"imagen_principal"),className:"w-full file:py-2 file:px-3 file:border-0 file:bg-green-100 file:text-green-700 hover:file:bg-green-200"}),t.jsx("input",{type:"text",name:"text_alt_principal",placeholder:"Texto ALT para SEO",value:o.text_alt_principal,onChange:b,className:"mt-2 w-full border border-gray-300 rounded px-3 py-2"})]}),t.jsxs("div",{className:"border border-green-400 rounded p-4",children:[t.jsx("label",{className:"block font-semibold mb-4",children:"Imágenes Secundarias"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:o.imagenes_secundarias.map((m,f)=>t.jsxs("div",{className:"flex flex-col items-center",children:[r?.imagenes?.[f]?.ruta_imagen&&t.jsx("img",{src:r.imagenes[f].ruta_imagen,alt:o.alt_imagenes_secundarias[f]||`Imagen secundaria #${f+1}`,className:"w-full h-32 object-cover rounded mb-2 border"}),t.jsx("input",{type:"file",accept:"image/*",onChange:E=>T(E,f),className:"w-full file:py-2 file:px-3 file:border-0 file:bg-green-100 file:text-green-700 hover:file:bg-green-200"}),t.jsx("input",{type:"text",placeholder:`Texto ALT imagen secundaria #${f+1}`,value:o.alt_imagenes_secundarias[f],onChange:E=>H(E,f),className:"w-full border border-gray-300 rounded px-3 py-2 mt-2"})]},f))})]})]})]}),t.jsxs("div",{className:"bg-purple-50 p-4 sm:p-6 rounded-lg border border-purple-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-4",children:"Video"}),t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL del Video *"}),t.jsx("input",{type:"url",name:"url_video",value:o.url_video,onChange:b,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{className:"bg-yellow-50 p-4 sm:p-6 rounded-lg border border-yellow-200",children:[t.jsxs("h3",{className:"text-lg font-semibold text-yellow-800 mb-4",children:["Párrafos ",t.jsx("span",{className:"text-red-500",children:"*"})]}),o.parrafos.map((m,f)=>t.jsxs("div",{className:"relative mb-6",children:[t.jsx("textarea",{id:`parrafo-${f}`,value:m,onChange:E=>Z(E,f),className:"w-full border border-gray-300 rounded px-3 py-2 pr-20",rows:4,placeholder:`Párrafo ${f+1} (opcional)`}),t.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[t.jsx("button",{type:"button",onClick:()=>Q(f),className:"bg-blue-500 hover:bg-blue-700 text-white p-2 rounded-full shadow-lg transition",children:"🔗"}),t.jsx("button",{type:"button",onClick:()=>te(f),className:"bg-green-500 hover:bg-green-700 text-white p-2 rounded-full shadow-lg transition",children:"🛒"})]})]},f))]}),t.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4",children:[t.jsx("button",{type:"button",onClick:L,className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",disabled:s,children:"Cancelar"}),t.jsx("button",{type:"submit",disabled:s,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded disabled:opacity-50",children:s?"Procesando...":r?"Actualizar":"Crear"})]})]}),u&&t.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-[60]",children:t.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[t.jsx("h3",{className:"text-lg font-bold mb-4",children:"Insertar Enlace"}),t.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Texto seleccionado: ",t.jsxs("strong",{children:['"',p,'"']})]}),t.jsx("input",{type:"url",value:y,onChange:m=>j(m.target.value),placeholder:"https://ejemplo.com",className:"w-full border border-gray-300 rounded px-3 py-2 mb-4",required:!0}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:()=>v(!1),className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",children:"Cancelar"}),t.jsx("button",{type:"button",onClick:ee,disabled:!y.trim(),className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-300 text-white px-4 py-2 rounded",children:"Insertar"})]})]})}),_&&t.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-[60]",children:t.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[t.jsx("h3",{className:"text-lg font-bold mb-4",children:"Enlazar a Producto"}),t.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Texto seleccionado: ",t.jsxs("strong",{children:['"',p,'"']})]}),t.jsxs("select",{onChange:m=>{const f=parseInt(m.target.value),E=g.find(k=>k.id===f);E&&ae(E)},className:"w-full border border-gray-300 rounded px-3 py-2 mb-4",children:[t.jsx("option",{value:"",children:"-- Seleccionar producto --"}),g.map(m=>t.jsx("option",{value:m.id,children:m.nombre},m.id))]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{type:"button",onClick:()=>l(!1),className:"bg-gray-300 hover:bg-gray-400 px-4 py-2 rounded",children:"Cancelar"})})]})})]})}):null},oe=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopedSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideNextClass","slidePrevClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function F(a){return typeof a=="object"&&a!==null&&a.constructor&&Object.prototype.toString.call(a).slice(8,-1)==="Object"&&!a.__swiper__}function U(a,e){const r=["__proto__","constructor","prototype"];Object.keys(e).filter(n=>r.indexOf(n)<0).forEach(n=>{typeof a[n]>"u"?a[n]=e[n]:F(e[n])&&F(a[n])&&Object.keys(e[n]).length>0?e[n].__swiper__?a[n]=e[n]:U(a[n],e[n]):a[n]=e[n]})}function ce(a){return a===void 0&&(a={}),a.navigation&&typeof a.navigation.nextEl>"u"&&typeof a.navigation.prevEl>"u"}function de(a){return a===void 0&&(a={}),a.pagination&&typeof a.pagination.el>"u"}function ue(a){return a===void 0&&(a={}),a.scrollbar&&typeof a.scrollbar.el>"u"}function pe(a){a===void 0&&(a="");const e=a.split(" ").map(n=>n.trim()).filter(n=>!!n),r=[];return e.forEach(n=>{r.indexOf(n)<0&&r.push(n)}),r.join(" ")}function Se(a){return a===void 0&&(a=""),a?a.includes("swiper-wrapper")?a:`swiper-wrapper ${a}`:"swiper-wrapper"}function Ne(a){let{swiper:e,slides:r,passedParams:n,changedParams:g,nextEl:c,prevEl:x,scrollbarEl:w,paginationEl:s}=a;const P=g.filter(b=>b!=="children"&&b!=="direction"&&b!=="wrapperClass"),{params:u,pagination:v,navigation:N,scrollbar:I,virtual:O,thumbs:d}=e;let p,i,_,l,y,j,S,o;g.includes("thumbs")&&n.thumbs&&n.thumbs.swiper&&u.thumbs&&!u.thumbs.swiper&&(p=!0),g.includes("controller")&&n.controller&&n.controller.control&&u.controller&&!u.controller.control&&(i=!0),g.includes("pagination")&&n.pagination&&(n.pagination.el||s)&&(u.pagination||u.pagination===!1)&&v&&!v.el&&(_=!0),g.includes("scrollbar")&&n.scrollbar&&(n.scrollbar.el||w)&&(u.scrollbar||u.scrollbar===!1)&&I&&!I.el&&(l=!0),g.includes("navigation")&&n.navigation&&(n.navigation.prevEl||x)&&(n.navigation.nextEl||c)&&(u.navigation||u.navigation===!1)&&N&&!N.prevEl&&!N.nextEl&&(y=!0);const C=b=>{e[b]&&(e[b].destroy(),b==="navigation"?(e.isElement&&(e[b].prevEl.remove(),e[b].nextEl.remove()),u[b].prevEl=void 0,u[b].nextEl=void 0,e[b].prevEl=void 0,e[b].nextEl=void 0):(e.isElement&&e[b].el.remove(),u[b].el=void 0,e[b].el=void 0))};g.includes("loop")&&e.isElement&&(u.loop&&!n.loop?j=!0:!u.loop&&n.loop?S=!0:o=!0),P.forEach(b=>{if(F(u[b])&&F(n[b]))U(u[b],n[b]),(b==="navigation"||b==="pagination"||b==="scrollbar")&&"enabled"in n[b]&&!n[b].enabled&&C(b);else{const q=n[b];(q===!0||q===!1)&&(b==="navigation"||b==="pagination"||b==="scrollbar")?q===!1&&C(b):u[b]=n[b]}}),P.includes("controller")&&!i&&e.controller&&e.controller.control&&u.controller&&u.controller.control&&(e.controller.control=u.controller.control),g.includes("children")&&r&&O&&u.virtual.enabled&&(O.slides=r,O.update(!0)),g.includes("children")&&r&&u.loop&&(o=!0),p&&d.init()&&d.update(!0),i&&(e.controller.control=u.controller.control),_&&(e.isElement&&(!s||typeof s=="string")&&(s=document.createElement("div"),s.classList.add("swiper-pagination"),s.part.add("pagination"),e.el.appendChild(s)),s&&(u.pagination.el=s),v.init(),v.render(),v.update()),l&&(e.isElement&&(!w||typeof w=="string")&&(w=document.createElement("div"),w.classList.add("swiper-scrollbar"),w.part.add("scrollbar"),e.el.appendChild(w)),w&&(u.scrollbar.el=w),I.init(),I.updateSize(),I.setTranslate()),y&&(e.isElement&&((!c||typeof c=="string")&&(c=document.createElement("div"),c.classList.add("swiper-button-next"),c.innerHTML=e.hostEl.constructor.nextButtonSvg,c.part.add("button-next"),e.el.appendChild(c)),(!x||typeof x=="string")&&(x=document.createElement("div"),x.classList.add("swiper-button-prev"),x.innerHTML=e.hostEl.constructor.prevButtonSvg,x.part.add("button-prev"),e.el.appendChild(x))),c&&(u.navigation.nextEl=c),x&&(u.navigation.prevEl=x),N.init(),N.update()),g.includes("allowSlideNext")&&(e.allowSlideNext=n.allowSlideNext),g.includes("allowSlidePrev")&&(e.allowSlidePrev=n.allowSlidePrev),g.includes("direction")&&e.changeDirection(n.direction,!1),(j||o)&&e.loopDestroy(),(S||o)&&e.loopCreate(),e.update()}function Ce(a,e){a===void 0&&(a={}),e===void 0&&(e=!0);const r={on:{}},n={},g={};U(r,we),r._emitClasses=!0,r.init=!1;const c={},x=oe.map(s=>s.replace(/_/,"")),w=Object.assign({},a);return Object.keys(w).forEach(s=>{typeof a[s]>"u"||(x.indexOf(s)>=0?F(a[s])?(r[s]={},g[s]={},U(r[s],a[s]),U(g[s],a[s])):(r[s]=a[s],g[s]=a[s]):s.search(/on[A-Z]/)===0&&typeof a[s]=="function"?e?n[`${s[2].toLowerCase()}${s.substr(3)}`]=a[s]:r.on[`${s[2].toLowerCase()}${s.substr(3)}`]=a[s]:c[s]=a[s])}),["navigation","pagination","scrollbar"].forEach(s=>{r[s]===!0&&(r[s]={}),r[s]===!1&&delete r[s]}),{params:r,passedParams:g,rest:c,events:n}}function Pe(a,e){let{el:r,nextEl:n,prevEl:g,paginationEl:c,scrollbarEl:x,swiper:w}=a;ce(e)&&n&&g&&(w.params.navigation.nextEl=n,w.originalParams.navigation.nextEl=n,w.params.navigation.prevEl=g,w.originalParams.navigation.prevEl=g),de(e)&&c&&(w.params.pagination.el=c,w.originalParams.pagination.el=c),ue(e)&&x&&(w.params.scrollbar.el=x,w.originalParams.scrollbar.el=x),w.init(r)}function Ie(a,e,r,n,g){const c=[];if(!e)return c;const x=s=>{c.indexOf(s)<0&&c.push(s)};if(r&&n){const s=n.map(g),P=r.map(g);s.join("")!==P.join("")&&x("children"),n.length!==r.length&&x("children")}return oe.filter(s=>s[0]==="_").map(s=>s.replace(/_/,"")).forEach(s=>{if(s in a&&s in e)if(F(a[s])&&F(e[s])){const P=Object.keys(a[s]),u=Object.keys(e[s]);P.length!==u.length?x(s):(P.forEach(v=>{a[s][v]!==e[s][v]&&x(s)}),u.forEach(v=>{a[s][v]!==e[s][v]&&x(s)}))}else a[s]!==e[s]&&x(s)}),c}const Oe=a=>{!a||a.destroyed||!a.params.virtual||a.params.virtual&&!a.params.virtual.enabled||(a.updateSlides(),a.updateProgress(),a.updateSlidesClasses(),a.parallax&&a.params.parallax&&a.params.parallax.enabled&&a.parallax.setTranslate())};function Y(){return Y=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(a[n]=r[n])}return a},Y.apply(this,arguments)}function fe(a){return a.type&&a.type.displayName&&a.type.displayName.includes("SwiperSlide")}function me(a){const e=[];return A.Children.toArray(a).forEach(r=>{fe(r)?e.push(r):r.props&&r.props.children&&me(r.props.children).forEach(n=>e.push(n))}),e}function ke(a){const e=[],r={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return A.Children.toArray(a).forEach(n=>{if(fe(n))e.push(n);else if(n.props&&n.props.slot&&r[n.props.slot])r[n.props.slot].push(n);else if(n.props&&n.props.children){const g=me(n.props.children);g.length>0?g.forEach(c=>e.push(c)):r["container-end"].push(n)}else r["container-end"].push(n)}),{slides:e,slots:r}}function Ae(a,e,r){if(!r)return null;const n=u=>{let v=u;return u<0?v=e.length+u:v>=e.length&&(v=v-e.length),v},g=a.isHorizontal()?{[a.rtlTranslate?"right":"left"]:`${r.offset}px`}:{top:`${r.offset}px`},{from:c,to:x}=r,w=a.params.loop?-e.length:0,s=a.params.loop?e.length*2:e.length,P=[];for(let u=w;u<s;u+=1)u>=c&&u<=x&&P.push(e[n(u)]);return P.map((u,v)=>A.cloneElement(u,{swiper:a,style:g,key:`slide-${v}`}))}function K(a,e){return typeof window>"u"?h.useEffect(a,e):h.useLayoutEffect(a,e)}const ie=h.createContext(null),Le=h.createContext(null),ne=h.forwardRef(function(a,e){let{className:r,tag:n="div",wrapperTag:g="div",children:c,onSwiper:x,...w}=a===void 0?{}:a,s=!1;const[P,u]=h.useState("swiper"),[v,N]=h.useState(null),[I,O]=h.useState(!1),d=h.useRef(!1),p=h.useRef(null),i=h.useRef(null),_=h.useRef(null),l=h.useRef(null),y=h.useRef(null),j=h.useRef(null),S=h.useRef(null),o=h.useRef(null),{params:C,passedParams:b,rest:q,events:R}=Ce(w),{slides:T,slots:H}=ke(c),Z=()=>{O(!I)};Object.assign(C.on,{_containerClasses(L,z){u(z)}});const Q=()=>{Object.assign(C.on,R),s=!0;const L={...C};if(delete L.wrapperClass,i.current=new _e(L),i.current.virtual&&i.current.params.virtual.enabled){i.current.virtual.slides=T;const z={cache:!1,slides:T,renderExternal:N,renderExternalUpdate:!1};U(i.current.params.virtual,z),U(i.current.originalParams.virtual,z)}};p.current||Q(),i.current&&i.current.on("_beforeBreakpoint",Z);const ee=()=>{s||!R||!i.current||Object.keys(R).forEach(L=>{i.current.on(L,R[L])})},te=()=>{!R||!i.current||Object.keys(R).forEach(L=>{i.current.off(L,R[L])})};h.useEffect(()=>()=>{i.current&&i.current.off("_beforeBreakpoint",Z)}),h.useEffect(()=>{!d.current&&i.current&&(i.current.emitSlidesClasses(),d.current=!0)}),K(()=>{if(e&&(e.current=p.current),!!p.current)return i.current.destroyed&&Q(),Pe({el:p.current,nextEl:y.current,prevEl:j.current,paginationEl:S.current,scrollbarEl:o.current,swiper:i.current},C),x&&x(i.current),()=>{i.current&&!i.current.destroyed&&i.current.destroy(!0,!1)}},[]),K(()=>{ee();const L=Ie(b,_.current,T,l.current,z=>z.key);return _.current=b,l.current=T,L.length&&i.current&&!i.current.destroyed&&Ne({swiper:i.current,slides:T,passedParams:b,changedParams:L,nextEl:y.current,prevEl:j.current,scrollbarEl:o.current,paginationEl:S.current}),()=>{te()}}),K(()=>{Oe(i.current)},[v]);function ae(){return C.virtual?Ae(i.current,T,v):T.map((L,z)=>A.cloneElement(L,{swiper:i.current,swiperSlideIndex:z}))}return A.createElement(n,Y({ref:p,className:pe(`${P}${r?` ${r}`:""}`)},q),A.createElement(Le.Provider,{value:i.current},H["container-start"],A.createElement(g,{className:Se(C.wrapperClass)},H["wrapper-start"],ae(),H["wrapper-end"]),ce(C)&&A.createElement(A.Fragment,null,A.createElement("div",{ref:j,className:"swiper-button-prev"}),A.createElement("div",{ref:y,className:"swiper-button-next"})),ue(C)&&A.createElement("div",{ref:o,className:"swiper-scrollbar"}),de(C)&&A.createElement("div",{ref:S,className:"swiper-pagination"}),H["container-end"]))});ne.displayName="Swiper";const W=h.forwardRef(function(a,e){let{tag:r="div",children:n,className:g="",swiper:c,zoom:x,lazy:w,virtualIndex:s,swiperSlideIndex:P,...u}=a===void 0?{}:a;const v=h.useRef(null),[N,I]=h.useState("swiper-slide"),[O,d]=h.useState(!1);function p(y,j,S){j===v.current&&I(S)}K(()=>{if(typeof P<"u"&&(v.current.swiperSlideIndex=P),e&&(e.current=v.current),!(!v.current||!c)){if(c.destroyed){N!=="swiper-slide"&&I("swiper-slide");return}return c.on("_slideClass",p),()=>{c&&c.off("_slideClass",p)}}}),K(()=>{c&&v.current&&!c.destroyed&&I(c.getSlideClasses(v.current))},[c]);const i={isActive:N.indexOf("swiper-slide-active")>=0,isVisible:N.indexOf("swiper-slide-visible")>=0,isPrev:N.indexOf("swiper-slide-prev")>=0,isNext:N.indexOf("swiper-slide-next")>=0},_=()=>typeof n=="function"?n(i):n,l=()=>{d(!0)};return A.createElement(r,Y({ref:v,className:pe(`${N}${g?` ${g}`:""}`),"data-swiper-slide-index":s,onLoad:l},u),x&&A.createElement(ie.Provider,{value:i},A.createElement("div",{className:"swiper-zoom-container","data-swiper-zoom":typeof x=="number"?x:void 0},_(),w&&!O&&A.createElement("div",{className:"swiper-lazy-preloader"}))),!x&&A.createElement(ie.Provider,{value:i},_(),w&&!O&&A.createElement("div",{className:"swiper-lazy-preloader"})))});W.displayName="SwiperSlide";function $e(a){let{swiper:e,extendParams:r,on:n,emit:g}=a;r({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),e.navigation={nextEl:null,prevEl:null};const c=d=>(Array.isArray(d)?d:[d]).filter(p=>!!p);function x(d){let p;return d&&typeof d=="string"&&e.isElement&&(p=e.el.querySelector(d),p)?p:(d&&(typeof d=="string"&&(p=[...document.querySelectorAll(d)]),e.params.uniqueNavElements&&typeof d=="string"&&p.length>1&&e.el.querySelectorAll(d).length===1&&(p=e.el.querySelector(d))),d&&!p?d:p)}function w(d,p){const i=e.params.navigation;d=c(d),d.forEach(_=>{_&&(_.classList[p?"add":"remove"](...i.disabledClass.split(" ")),_.tagName==="BUTTON"&&(_.disabled=p),e.params.watchOverflow&&e.enabled&&_.classList[e.isLocked?"add":"remove"](i.lockClass))})}function s(){const{nextEl:d,prevEl:p}=e.navigation;if(e.params.loop){w(p,!1),w(d,!1);return}w(p,e.isBeginning&&!e.params.rewind),w(d,e.isEnd&&!e.params.rewind)}function P(d){d.preventDefault(),!(e.isBeginning&&!e.params.loop&&!e.params.rewind)&&(e.slidePrev(),g("navigationPrev"))}function u(d){d.preventDefault(),!(e.isEnd&&!e.params.loop&&!e.params.rewind)&&(e.slideNext(),g("navigationNext"))}function v(){const d=e.params.navigation;if(e.params.navigation=je(e,e.originalParams.navigation,e.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(d.nextEl||d.prevEl))return;let p=x(d.nextEl),i=x(d.prevEl);Object.assign(e.navigation,{nextEl:p,prevEl:i}),p=c(p),i=c(i);const _=(l,y)=>{l&&l.addEventListener("click",y==="next"?u:P),!e.enabled&&l&&l.classList.add(...d.lockClass.split(" "))};p.forEach(l=>_(l,"next")),i.forEach(l=>_(l,"prev"))}function N(){let{nextEl:d,prevEl:p}=e.navigation;d=c(d),p=c(p);const i=(_,l)=>{_.removeEventListener("click",l==="next"?u:P),_.classList.remove(...e.params.navigation.disabledClass.split(" "))};d.forEach(_=>i(_,"next")),p.forEach(_=>i(_,"prev"))}n("init",()=>{e.params.navigation.enabled===!1?O():(v(),s())}),n("toEdge fromEdge lock unlock",()=>{s()}),n("destroy",()=>{N()}),n("enable disable",()=>{let{nextEl:d,prevEl:p}=e.navigation;if(d=c(d),p=c(p),e.enabled){s();return}[...d,...p].filter(i=>!!i).forEach(i=>i.classList.add(e.params.navigation.lockClass))}),n("click",(d,p)=>{let{nextEl:i,prevEl:_}=e.navigation;i=c(i),_=c(_);const l=p.target;if(e.params.navigation.hideOnClick&&!_.includes(l)&&!i.includes(l)){if(e.pagination&&e.params.pagination&&e.params.pagination.clickable&&(e.pagination.el===l||e.pagination.el.contains(l)))return;let y;i.length?y=i[0].classList.contains(e.params.navigation.hiddenClass):_.length&&(y=_[0].classList.contains(e.params.navigation.hiddenClass)),g(y===!0?"navigationShow":"navigationHide"),[...i,..._].filter(j=>!!j).forEach(j=>j.classList.toggle(e.params.navigation.hiddenClass))}});const I=()=>{e.el.classList.remove(...e.params.navigation.navigationDisabledClass.split(" ")),v(),s()},O=()=>{e.el.classList.add(...e.params.navigation.navigationDisabledClass.split(" ")),N()};Object.assign(e.navigation,{enable:I,disable:O,update:s,init:v,destroy:N})}const He=()=>{const[a,e]=h.useState([]),[r,n]=h.useState(1),g=5,[c,x]=h.useState({current_page:1,last_page:1,per_page:g,total:0}),[w,s]=h.useState(null),[P,u]=h.useState(!0),[v,N]=h.useState(!1),I=async(l=1)=>{u(!0);try{const y=localStorage.getItem("token"),j=await fetch(`${G(J.endpoints.blogs.list)}?page=${l}&per_page=${g}`,{headers:{Authorization:`Bearer ${y}`,Accept:"application/json"}});if(!j.ok)throw new Error(`HTTP error! status: ${j.status}`);const S=await j.json();S.success&&S.data&&Array.isArray(S.data.data)?(e(S.data.data),x({current_page:S.data.current_page??l,last_page:S.data.last_page,per_page:S.data.per_page,total:S.data.total})):e([])}catch(y){console.error("❌ Error al cargar datos:",y),e([])}finally{u(!1)}};h.useEffect(()=>{I(r)},[r]);const O=l=>{l>=1&&l<=c.last_page&&n(l)},d=async l=>{const y=localStorage.getItem("token");if(window.confirm("¿Estás seguro de que deseas eliminar este blog?"))try{const S=await fetch(G(J.endpoints.blogs.delete(l)),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`}});if(S.ok)I(r),alert("✅ Blog eliminado exitosamente");else{const o=await S.json().catch(()=>({}));alert(`❌ Error al eliminar el blog: ${o.message||"Error desconocido"}`)}}catch{alert("❌ Error al conectar con el servidor")}},p=l=>l?l.startsWith("http")?l:`https://apiyuntas.yuntaspublicidad.com${l}`:"/placeholder-image.jpg",i=(l,y=50)=>l?l.length>y?l.substring(0,y)+"...":l:"",_=()=>{s(null),N(!0)};return t.jsxs("div",{className:"overflow-x-auto p-2 sm:p-4",children:[t.jsxs(ve,{tableType:"blogs",exportData:a,onAddNew:_,children:[t.jsx("thead",{className:"hidden md:table-header-group",children:t.jsx("tr",{className:"bg-blue-950 text-white",children:["ID","PRODUCTO","SUBTÍTULO","IMAGEN","FECHA","ACCIÓN"].map(l=>t.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:l},l))})}),t.jsx("tbody",{children:P?t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-500 block md:table-cell",children:"Cargando blogs..."})}):a.length>0?a.map((l,y)=>t.jsxs("tr",{className:`md:table-row block md:mb-0 mb-6 rounded-xl shadow-md overflow-hidden border ${y%2===0?"bg-white":"bg-gray-50"}`,children:[t.jsx("td",{"data-label":"ID",className:"block md:table-cell px-4 py-2 border-b font-bold before:content-['ID'] before:font-semibold before:block md:before:hidden",children:l.id}),t.jsx("td",{"data-label":"Producto",className:"block md:table-cell px-4 py-2 border-b font-semibold before:content-['Producto'] before:font-semibold before:block md:before:hidden",children:i(l.nombre_producto||"Sin nombre",30)}),t.jsx("td",{"data-label":"Subtítulo",className:"block md:table-cell px-4 py-2 border-b before:content-['Subtítulo'] before:font-semibold before:block md:before:hidden",children:i(l.subtitulo,40)}),t.jsxs("td",{"data-label":"Imagen",className:"block md:table-cell px-4 py-2 border-b border-gray-200 relative md:static before:content-['Imagen'] before:font-semibold before:block md:before:hidden",children:[t.jsx("div",{className:"block md:hidden w-full",children:t.jsxs(ne,{modules:[$e,le],spaceBetween:10,slidesPerView:1,pagination:{clickable:!0},navigation:!0,className:"w-full max-w-[320px] rounded-lg shadow-md",children:[t.jsx(W,{children:t.jsx("img",{src:p(l.imagen_principal),alt:l.nombre_producto||"Blog",className:"w-full h-48 object-cover rounded-lg"})}),l.imagenes?.map((j,S)=>t.jsx(W,{children:t.jsx("img",{src:p(j.ruta_imagen),alt:j.text_alt||"Imagen extra",className:"w-full h-48 object-cover rounded-lg"})},S))]})}),t.jsx("div",{className:"hidden md:block w-full",children:!l.imagenes||l.imagenes.length===0?t.jsx("img",{src:p(l.imagen_principal),alt:l.nombre_producto||"Blog",className:"w-full max-w-[120px] h-20 object-cover rounded-lg shadow-md",onError:j=>{const S=j.target;S.src="/placeholder-image.jpg"}}):t.jsxs(ne,{modules:[le,Ee],spaceBetween:10,slidesPerView:1,loop:l.imagenes.length>=3,rewind:l.imagenes.length===2,autoplay:{delay:2e3,disableOnInteraction:!1},pagination:{clickable:!0},className:"w-full max-w-[120px] h-20 rounded-lg shadow-md",children:[t.jsx(W,{children:t.jsx("img",{src:p(l.imagen_principal),alt:l.nombre_producto||"Blog",className:"w-full h-20 object-cover rounded-lg",onError:j=>{const S=j.target;S.src="/placeholder-image.jpg"}})}),l.imagenes.map((j,S)=>t.jsx(W,{children:t.jsx("img",{src:p(j.ruta_imagen),alt:j.text_alt||"Imagen extra",className:"w-full h-20 object-cover rounded-lg",onError:o=>{const C=o.target;C.src="/placeholder-image.jpg"}})},S))]})})]}),t.jsx("td",{"data-label":"Fecha",className:"block md:table-cell px-4 py-2 border-b text-sm before:content-['Fecha'] before:font-semibold before:block md:before:hidden",children:l.created_at?new Date(l.created_at).toLocaleDateString("es-ES"):"N/A"}),t.jsx("td",{"data-label":"Acción",className:"block md:table-cell px-4 py-3 border-b before:content-['Acción'] before:font-semibold before:block md:before:hidden",children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-3 mt-2 sm:mt-0",children:[t.jsxs("button",{className:"flex items-center justify-center gap-2 p-2 text-red-600 hover:text-red-800 transition bg-red-100 rounded-lg shadow-sm",title:"Eliminar",onClick:()=>d(l.id),children:[t.jsx(he,{size:18}),t.jsx("span",{className:"md:hidden font-medium",children:"Borrar"})]}),t.jsxs("button",{className:"flex items-center justify-center gap-2 p-2 text-yellow-600 hover:text-yellow-800 transition bg-yellow-100 rounded-lg shadow-sm",title:"Editar",onClick:()=>{s(l),N(!0)},children:[t.jsx(xe,{size:18}),t.jsx("span",{className:"md:hidden font-medium",children:"Editar"})]})]})})]},l.id)):t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-500",children:"No hay blogs disponibles"})})})]}),c.last_page>1&&t.jsxs("div",{className:"flex flex-wrap justify-center items-center mt-4 gap-2",children:[t.jsx("button",{onClick:()=>O(r-1),disabled:r===1,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-800 transition-colors",children:"Anterior"}),Array.from({length:c.last_page},(l,y)=>{const j=y+1;return t.jsx("button",{onClick:()=>O(j),className:`px-3 py-2 rounded-md ${r===j?"bg-blue-950 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:j},j)}),t.jsx("button",{onClick:()=>O(r+1),disabled:r===c.last_page,className:"px-4 py-2 bg-blue-950 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-800 transition-colors",children:"Siguiente"})]}),t.jsx("button",{onClick:_,className:"mt-4 mb-6 bg-blue-950 hover:bg-blue-800 text-white text-lg px-8 sm:px-10 py-2 rounded-full w-full sm:w-auto",children:"Añadir Blog"}),t.jsx(ye,{isOpen:v,setIsOpen:N,blogToEdit:w,onSuccess:()=>{s(null),N(!1),I(r)}})]})};export{He as default};
