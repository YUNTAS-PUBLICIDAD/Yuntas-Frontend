import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.ai7qpRr1.js";import{c as S}from"./index.C2rrZm7j.js";import{G as T}from"./iconBase.CsihB_xR.js";import{T as D}from"./TableContainer.b9hjZr1F.js";function A(t){return T({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",strokeWidth:"2",d:"M1.7507,16.0022 C3.3517,20.0982 7.3367,23.0002 11.9997,23.0002 C18.0747,23.0002 22.9997,18.0752 22.9997,12.0002 M22.2497,7.9982 C20.6487,3.9012 16.6627,1.0002 11.9997,1.0002 C5.9247,1.0002 0.9997,5.9252 0.9997,12.0002 M8.9997,16.0002 L0.9997,16.0002 L0.9997,24.0002 M22.9997,0.0002 L22.9997,8.0002 L14.9997,8.0002"},child:[]}]})(t)}const j=()=>{const t=()=>{const n=localStorage.getItem("token");if(!n)throw new Error("No se encontró el token");return n};return{addCliente:async n=>{const a=t(),r=await fetch("https://apiyuntas.yuntaspublicidad.com/api/v1/clientes",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(n)});if(!r.ok)throw new Error("Error al agregar cliente");return(await r.json()).data},updateCliente:async(n,a)=>{const c=t(),r=`https://apiyuntas.yuntaspublicidad.com/api/v1/clientes/${n}`,x=await fetch(r,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(a)});if(!x.ok)throw new Error("Error al actualizar cliente");return(await x.json()).data},deleteCliente:async n=>{const a=t(),c=`https://apiyuntas.yuntaspublicidad.com/api/v1/clientes/${n}`,r=await fetch(c,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!r.ok)throw new Error("Error al eliminar cliente");return await r.json()}}},I=(t,o)=>{const[s,u]=i.useState({name:"",celular:"",email:"",seccion:"",created_at:""}),[n,a]=i.useState(!1),{addCliente:c,updateCliente:r}=j();i.useEffect(()=>{t?(u({name:t.name,celular:t.celular,email:t.email,seccion:t.seccion,created_at:t.created_at}),a(!0)):(f(),a(!1))},[t]);const x=d=>{u({...s,[d.target.name]:d.target.value})},h=async d=>{d.preventDefault();const{name:m,celular:p,email:b}=s;if(!m.trim()||!p.trim()||!b.trim()){alert("⚠️ Todos los campos son obligatorios.");return}if(!/^\d+$/.test(p)){alert("⚠️ El teléfono solo debe contener números.");return}try{n?(await r(t.id,{name:m,celular:p,email:b}),alert(" Cliente actualizado correctamente")):(await c({name:m,celular:p,email:b}),alert(" Cliente registrado exitosamente")),o?.(),f()}catch(g){console.error("❌ Error en la operación:",g),alert(`❌ Error: ${g.message||"Error desconocido"}`)}},f=()=>{u({name:"",celular:"",email:"",seccion:"",created_at:""}),a(!1)};return{formData:s,handleChange:x,handleSubmit:h}},M=({isOpen:t,setIsOpen:o,cliente:s,onRefetch:u})=>{const{formData:n,handleChange:a,handleSubmit:c}=I(s,()=>{u(),o(!1)});return t?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{style:{backgroundColor:"#528FC2"},className:"text-white px-10 py-8 rounded-4xl w-3/5",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:s?"EDITAR CLIENTE":"AÑADIR CLIENTE"}),e.jsxs("form",{onSubmit:c,className:"grid grid-cols-2 gap-4 gap-x-12",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Nombres"}),e.jsx("input",{type:"text",name:"name",value:n.name,onChange:a,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Teléfono"}),e.jsx("input",{type:"text",name:"celular",value:n.celular,onChange:a,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block",children:"Gmail"}),e.jsx("input",{type:"email",name:"email",value:n.email,onChange:a,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Sección"}),e.jsx("input",{type:"text",name:"seccion",value:n.seccion,onChange:a,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Fecha"}),e.jsx("input",{type:"text",name:"fecha",value:n.created_at,onChange:a,required:!0,className:"w-full bg-white outline-none p-2 rounded-md text-black"})]}),e.jsxs("div",{className:"flex gap-2 mt-8 col-span-2",children:[e.jsx("button",{type:"submit",style:{backgroundColor:"#98D8DF"},className:"px-10 py-1 rounded-full text-lg text-white hover:opacity-90 transition",children:s?"Guardar cambios":"Añadir cliente"}),e.jsx("button",{onClick:()=>o(!1),type:"button",className:"px-10 bg-gray-400 py-1 rounded-full text-lg hover:bg-gray-500",children:"Cancelar"})]})]})]})}):null},F=({isOpen:t,setIsOpen:o,clienteId:s,onRefetch:u})=>{const{deleteCliente:n}=j(),[a,c]=i.useState(!1),r=async()=>{try{c(!0),await n(s),u(),o(!1)}catch(x){console.error("Error al eliminar cliente:",x),alert("No se pudo eliminar el cliente")}finally{c(!1)}};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg max-w-md w-full text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"¿Eliminar cliente?"}),e.jsx("p",{className:"text-gray-700 mb-6",children:"Esta acción es permanente y no se puede deshacer."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:r,disabled:a,className:"bg-red-600 text-white px-5 py-2 rounded-lg hover:bg-red-700 disabled:opacity-50",children:a?"Eliminando...":"Eliminar"}),e.jsx("button",{onClick:()=>o(!1),className:"bg-gray-200 text-gray-800 px-5 py-2 rounded-lg hover:bg-gray-300",children:"Cancelar"})]})]})}):null},z=(t,o=1)=>{const[s,u]=i.useState([]),[n,a]=i.useState(1),[c,r]=i.useState(!0),[x,h]=i.useState(null);return i.useEffect(()=>{(async()=>{r(!0),h(null);try{const d=localStorage.getItem("token");if(!d)throw new Error("No se encontró el token de autenticación");const m=await fetch("https://apiyuntas.yuntaspublicidad.com/api/v1/clientes",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}});if(!m.ok)throw new Error(`Error al obtener clientes: ${m.statusText}`);const p=await m.json();console.log("🚀 Datos obtenidos:",p.data);const b=p.data||[];console.log("🚀 Clientes obtenidos:",b);const g=Math.ceil(p.total/10)||1;u(b),a(g)}catch(d){console.error("🚨 Error en fetchClientes:",d),h(d instanceof Error?d.message:"Ocurrió un error desconocido")}finally{r(!1)}})()},[t,o]),{clientes:s,totalPages:n,loading:c,error:x}},L=({currentPage:t,totalPages:o,onPageChange:s})=>e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx("button",{onClick:()=>s(t-1),disabled:t===1,className:"pagination-btn",children:"Anterior"}),e.jsxs("span",{className:"text-gray-700 font-bold",children:["Página ",t," de ",o]}),e.jsx("button",{onClick:()=>s(t+1),disabled:t===o,className:"pagination-btn",children:"Siguiente"})]}),_=()=>{const[t,o]=i.useState(!1),[s,u]=i.useState(1),{clientes:n,totalPages:a,loading:c,error:r}=z(t,s),[x,h]=i.useState(!1),[f,d]=i.useState(null),[m,p]=i.useState(!1),[b,g]=i.useState(null);if(c)return e.jsx("p",{className:"text-center text-gray-500",children:"Cargando datos..."});if(r)return e.jsxs("p",{className:"text-center text-red-500",children:["Error: ",r]});const y=()=>o(l=>!l),N=l=>{d(l),h(!0)},C=()=>{d(null),h(!0)},w=l=>{g(l),p(!0)},E=()=>{y(),h(!1)};return e.jsxs("div",{className:"overflow-x-auto p-4",children:[e.jsxs(D,{tableType:"seguimiento",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:"ID"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:"Gmail"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:"Teléfono"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:"Sección"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:"Fecha"}),e.jsx("th",{className:"px-4 py-2 bg-cyan-400 text-white uppercase text-xs font-bold rounded-md",children:"Acción"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-4 text-gray-500",children:"No hay clientes disponibles."})}):n.map((l,k)=>{const v=k%2===0?"bg-[#d9d9d9]":"bg-[#d9d9d94d]";return e.jsxs("tr",{className:`text-center ${v}`,children:[e.jsx("td",{className:"px-4 py-2 font-bold rounded-xl border border-gray-300",children:l.id}),e.jsx("td",{className:"px-4 py-2 font-bold rounded-xl border border-gray-300",children:l.name}),e.jsx("td",{className:"px-4 py-2 rounded-xl border border-gray-300",children:l.email}),e.jsx("td",{className:"px-4 py-2 font-bold rounded-xl border border-gray-300",children:l.celular}),e.jsx("td",{className:"px-4 py-2 font-bold rounded-xl border border-gray-300",children:l.seccion||"N/A"}),e.jsx("td",{className:"px-4 py-2 font-bold rounded-xl border border-gray-300",children:l.created_at}),e.jsx("td",{className:"px-4 py-2 rounded-xl border border-gray-300",children:e.jsxs("div",{className:"flex justify-center gap-2 rounded-xl p-1",children:[e.jsx("button",{className:"p-2 text-red-600 hover:text-red-800 transition",title:"Eliminar",onClick:()=>w(l.id),children:e.jsx(S,{size:18})}),e.jsx("button",{className:"p-2 text-green-600 hover:text-green-800 transition",title:"Editar",onClick:()=>N(l),children:e.jsx(A,{size:18})})]})})]},l.id)})})]}),e.jsx("button",{className:"mt-4 ml-2 p-2 pl-4 bg-blue-900 text-white rounded-lg",onClick:C,children:"Agregar Cliente"}),e.jsx(M,{isOpen:x,setIsOpen:h,cliente:f,onRefetch:E}),b!==null&&e.jsx(F,{isOpen:m,setIsOpen:p,clienteId:b,onRefetch:y}),e.jsx(L,{currentPage:s,totalPages:a,onPageChange:l=>u(l)})]})};export{_ as default};
